<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<title>è›å…‰ãƒšãƒ³ PRO | SEOæ–‡æ¡ˆæ•¸ä½å·¥å…·</title>
<meta name="description" content="æ—¥ç³»æ¥µç°¡ SEO æ–‡æ¡ˆå·¥å…·ã€‚æ”¯æ´ PWA é›¢ç·šå¯«ä½œã€Google Docs æ ¼å¼ç„¡ç¸«è²¼ä¸Šã€é—œéµå­—å¯†åº¦æª¢æ¸¬ã€‚">
<meta name="robots" content="index, follow">
<meta property="og:title" content="è›å…‰ãƒšãƒ³ PRO">
<meta property="og:description" content="è®“å¯«ä½œå›æ­¸å„ªé›…çš„æ•¸ä½æ–‡å…·ã€‚">

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#F9F8F4">
<link rel="apple-touch-icon" href="icon-192.png">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512' fill='none'><circle cx='256' cy='256' r='256' fill='%23F9F8F4'/><path d='M256 86C256 86 160 190 160 310C160 380 200 426 256 426C312 426 352 380 352 310C352 190 256 86 256 86Z' stroke='%232B4B65' stroke-width='24' stroke-linecap='round' stroke-linejoin='round'/><path d='M256 180V320' stroke='%232B4B65' stroke-width='24' stroke-linecap='round'/><circle cx='256' cy='370' r='24' fill='%23BF1E33'/></svg>">

<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Shippori+Mincho:wght@500;700&family=Zen+Kaku+Gothic+New:wght@300;400;500;700&display=swap" rel="stylesheet">

<script>
  // æ™ºæ…§å³éµé˜²è­· (ä¿ç•™ç·¨è¼¯å€å³éµåŠŸèƒ½)
  document.addEventListener('contextmenu', e => {
    const isEditable = e.target.closest('textarea, input, [contenteditable="true"]');
    if (isEditable) return; 
    e.preventDefault();     
  });
  // ç¦æ­¢å¦å­˜ï¼Œå…è¨± F12
  document.addEventListener('keydown', e => {
    if((e.ctrlKey && ['s','S','u','U'].includes(e.key))){ e.preventDefault(); }
  });
  // PWA
  if ('serviceWorker' in navigator) {
     window.addEventListener('load', () => { navigator.serviceWorker.register('./sw.js').catch(e => console.log('SW Fail')); });
  }
</script>

<style>
  :root {
    --bg-canvas: #F9F8F4; --bg-sidebar: #FFFFFF; --border-color: #E0E0E0;
    --c-ink: #333333; --c-sub: #666666; --c-accent: #2B4B65; --c-highlight: #BF1E33;
    --font-serif: 'Shippori Mincho', serif; --font-sans: 'Zen Kaku Gothic New', sans-serif; --font-editor: 'Noto Sans TC', sans-serif;
    --shadow-soft: 0 4px 20px rgba(0,0,0,0.04);
  }
  [data-theme="dark"] {
    --bg-canvas: #1A1A1A; --bg-sidebar: #242424; --border-color: #333;
    --c-ink: #E0E0E0; --c-sub: #999; --c-accent: #8AB4D6; --c-highlight: #FF6B6B;
  }

  body { background: var(--bg-canvas); color: var(--c-ink); font-family: var(--font-sans); height: 100vh; overflow: hidden; display: flex; flex-direction: column; }
  
  /* é›œèªŒç¶²æ ¼èƒŒæ™¯ */
  .bg-grid { position: fixed; inset: 0; background-image: linear-gradient(#E5E5E5 1px, transparent 1px), linear-gradient(90deg, #E5E5E5 1px, transparent 1px); background-size: 24px 24px; opacity: 0.3; pointer-events: none; z-index: -1; }
  [data-theme="dark"] .bg-grid { opacity: 0.05; }

  /* æ²è»¸ç¾åŒ– */
  .custom-scroll::-webkit-scrollbar { width: 4px; height: 4px; }
  .custom-scroll::-webkit-scrollbar-thumb { background: #DDD; border-radius: 2px; }
  [data-theme="dark"] .custom-scroll::-webkit-scrollbar-thumb { background: #444; }

  /* å·¦å´å´é‚Šæ¬„ */
  .sidebar { background: var(--bg-sidebar); border-right: 1px solid var(--border-color); display: flex; flex-direction: column; z-index: 20; box-shadow: var(--shadow-soft); }
  .sidebar-header { font-family: var(--font-serif); letter-spacing: 0.05em; color: var(--c-ink); }
  
  /* è¼¸å…¥æ¡†æ¨£å¼ */
  .input-area { width: 100%; background: var(--bg-canvas); border: 1px solid var(--border-color); border-radius: 4px; padding: 12px; font-size: 14px; font-family: var(--font-sans); resize: none; outline: none; transition: 0.2s; line-height: 1.6; }
  .input-area:focus { border-color: var(--c-accent); background: var(--bg-sidebar); }

  /* å³å´é è¦½å€ (ç·¨è¼¯æ ¸å¿ƒ) */
  .preview-container { flex: 1; display: flex; flex-direction: column; position: relative; overflow: hidden; }
  
  /* é•·æ¢å½¢å·¥å…·åˆ— (Ribbon Bar) */
  .toolbar { 
    background: var(--bg-sidebar); border-bottom: 1px solid var(--border-color); 
    padding: 8px 16px; display: flex; align-items: center; gap: 12px; 
    overflow-x: auto; white-space: nowrap; z-index: 30;
    box-shadow: 0 2px 10px rgba(0,0,0,0.02);
  }
  .tool-btn { 
    display: flex; align-items: center; justify-content: center; 
    height: 32px; min-width: 32px; padding: 0 8px; border-radius: 4px; 
    color: var(--c-sub); font-size: 13px; font-family: var(--font-serif); font-weight: 500;
    cursor: pointer; transition: 0.2s; border: 1px solid transparent; 
  }
  .tool-btn:hover { background: var(--bg-canvas); color: var(--c-accent); border-color: var(--border-color); }
  .tool-btn svg { width: 16px; height: 16px; stroke-width: 1.5; }
  .tool-sep { width: 1px; height: 20px; background: var(--border-color); flex-shrink: 0; }
  
  .color-dot { width: 18px; height: 18px; border-radius: 50%; cursor: pointer; border: 2px solid var(--bg-sidebar); box-shadow: 0 0 0 1px var(--border-color); transition: 0.2s; flex-shrink: 0; }
  .color-dot:hover { transform: scale(1.2); }

  /* ç·¨è¼¯ç´™å¼µ (Paper) */
  .editor-paper { 
    width: 100%; max-width: 800px; min-height: 100%; margin: 0 auto; 
    background: var(--bg-sidebar); padding: 60px 80px 100px 80px; 
    outline: none; font-family: var(--font-editor); 
    font-size: 12pt; line-height: 1.0; /* ğŸŸ¢ å–®è¡Œè¡Œè· (User Request) */
    color: var(--c-ink); text-align: justify; 
  }
  
  /* å€å¡Šæ¨£å¼ (Block Styles) */
  .editor-paper p { margin-bottom: 1em; line-height: 1.6; /* é–±è®€æ™‚ä¿æŒèˆ’é©ï¼Œè¤‡è£½æ™‚æœƒè¢«å¼·åˆ¶æ”¹ç‚º1.0 */ }
  .editor-paper h2 { 
    font-family: var(--font-editor); font-size: 18pt; font-weight: 700; color: var(--c-accent); 
    border-bottom: 1px solid #DDD; padding-bottom: 6px; margin: 24px 0 12px 0; line-height: 1.2;
  }
  .editor-paper h3 { 
    font-family: var(--font-editor); font-size: 14pt; font-weight: 700; color: var(--c-ink); 
    border-left: 4px solid var(--c-highlight); padding-left: 10px; margin: 18px 0 10px 0; line-height: 1.2;
  }

  /* åº•éƒ¨ç‹€æ…‹åˆ— */
  .stats-bar { background: var(--bg-sidebar); border-top: 1px solid var(--border-color); padding: 8px 20px; font-size: 11px; color: var(--c-sub); display: flex; justify-content: space-between; align-items: center; }

  /* æ‰‹æ©Ÿç‰ˆé©é… */
  @media (max-width: 768px) {
    .sidebar { display: none; } /* æ‰‹æ©Ÿé è¨­éš±è—å·¦å´ */
    .editor-paper { padding: 30px 20px; }
    .toolbar { padding: 8px 10px; gap: 8px; }
    .mobile-tab-bar { display: flex; }
  }
  @media (min-width: 769px) { .mobile-tab-bar { display: none; } }
  
  .mobile-tab-bar { position: fixed; bottom: 0; left: 0; right: 0; height: 50px; background: var(--bg-sidebar); border-top: 1px solid var(--border-color); z-index: 50; justify-content: space-around; align-items: center; }
  .tab-btn { flex: 1; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 10px; color: var(--c-sub); }
  .tab-btn.active { color: var(--c-highlight); font-weight: bold; }
</style>
</head>
<body>
  <div class="bg-grid"></div>

  <header class="h-12 md:hidden flex items-center justify-between px-4 bg-[var(--bg-sidebar)] border-b border-[var(--border-color)] sticky top-0 z-40">
    <div class="flex items-center gap-2 font-serif text-[var(--c-ink)]">
      <svg class="w-5 h-5" viewBox="0 0 512 512" fill="none" stroke="currentColor" stroke-width="20"><circle cx="256" cy="256" r="236"/><path d="M256 100v200M180 300h152"/></svg>
      <span>è›å…‰ãƒšãƒ³</span>
    </div>
    <button onclick="App.UI.toggleTheme()" class="text-[var(--c-sub)]"><svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg></button>
  </header>

  <div class="flex-1 flex overflow-hidden relative">
    
    <aside id="tabInput" class="sidebar w-full md:w-[320px] lg:w-[360px] custom-scroll overflow-y-auto p-5 hidden md:flex flex-col h-full">
      <div class="sidebar-header flex items-center gap-3 mb-6">
        <svg class="w-8 h-8 text-[var(--c-accent)]" viewBox="0 0 512 512" fill="none" stroke="currentColor" stroke-width="20"><circle cx="256" cy="256" r="236"/><path d="M256 100v200M180 300h152"/></svg>
        <div>
          <h1 class="text-lg font-bold">è›å…‰ãƒšãƒ³ <span class="text-xs text-[var(--c-highlight)] font-sans">PRO</span></h1>
          <p class="text-[9px] tracking-widest opacity-60">DIGITAL STATIONERY v5.0</p>
        </div>
      </div>

      <div class="flex-1 flex flex-col gap-4">
        <div>
          <div class="flex justify-between items-baseline mb-2">
            <h3 class="font-serif font-bold text-sm border-l-2 border-[var(--c-accent)] pl-2">åŸæ–‡è¼¸å…¥ (Input)</h3>
            <button onclick="App.Core.restore()" class="text-[10px] text-blue-500 hover:underline">é‚„åŸ</button>
          </div>
          <textarea id="sourceText" class="input-area h-64" placeholder="è«‹åœ¨æ­¤è²¼ä¸Šæ–‡ç« ..."></textarea>
        </div>

        <div>
          <h3 class="font-serif font-bold text-sm border-l-2 border-[var(--c-highlight)] pl-2 mb-2">SEO é—œéµå­—</h3>
          <textarea id="kwList" class="input-area h-20 mb-2" placeholder="é—œéµå­— (ä¸€è¡Œä¸€å€‹)"></textarea>
          <div id="densityPanel" class="flex flex-wrap gap-2 text-xs"></div>
        </div>
      </div>

      <div class="mt-6 space-y-2">
        <button onclick="App.AI.generate()" class="w-full py-2 bg-indigo-600 text-white rounded shadow-sm hover:bg-indigo-700 transition flex items-center justify-center gap-2 text-sm font-serif">
          âœ¨ AI æ¨™é¡Œå»ºè­°
        </button>
        <button onclick="App.Core.forceSync()" class="w-full py-2 bg-[var(--c-accent)] text-white rounded shadow-sm hover:opacity-90 transition text-sm font-serif">
          âŸ³ ä¸€éµæ¨™è¨» (Sync to Editor)
        </button>
        <button onclick="App.Core.copyToDocs()" class="w-full py-2 border border-[var(--c-highlight)] text-[var(--c-highlight)] rounded hover:bg-red-50 transition text-sm">
          ğŸ“‹ è¤‡è£½åˆ° Docs (æ ¼å¼é–å®š)
        </button>
        <div class="flex gap-2 mt-2">
           <button onclick="App.Storage.clear('all')" class="flex-1 py-1 text-xs text-gray-400 border border-gray-200 rounded hover:text-red-500">é‡ç½®</button>
           <button onclick="App.Storage.downloadBackup()" class="flex-1 py-1 text-xs text-gray-400 border border-gray-200 rounded hover:text-blue-500">å‚™ä»½</button>
        </div>
      </div>
    </aside>

    <main id="tabPreview" class="preview-wrapper bg-[var(--bg-canvas)] w-full flex flex-col h-full">
      
      <div class="toolbar custom-scroll">
        <div class="flex items-center gap-1">
          <button onclick="document.execCommand('undo')" class="tool-btn" title="Undo"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M3 7v6h6"/><path d="M21 17a9 9 0 00-9-9 9 9 0 00-6 2.3L3 13"/></svg></button>
          <button onclick="document.execCommand('redo')" class="tool-btn" title="Redo"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M21 7v6h-6"/><path d="M3 17a9 9 0 019-9 9 9 0 016 2.3l6 3.7"/></svg></button>
        </div>
        <div class="tool-sep"></div>
        
        <div class="flex items-center gap-1">
          <button onclick="App.Format.cmd('formatBlock','h2')" class="tool-btn font-bold text-lg" title="H2 ç« ç¯€">H2</button>
          <button onclick="App.Format.cmd('formatBlock','h3')" class="tool-btn font-bold text-base" title="H3 å­é¡Œ">H3</button>
          <button onclick="App.Format.cmd('formatBlock','p')" class="tool-btn" title="å…§æ–‡">P</button>
        </div>
        <div class="tool-sep"></div>

        <select onchange="App.Format.size(this.value)" class="h-8 border border-[var(--border-color)] rounded text-xs bg-[var(--bg-sidebar)] px-1 outline-none">
          <option value="10pt">10</option>
          <option value="11pt">11</option>
          <option value="12pt" selected>12</option>
          <option value="14pt">14</option>
          <option value="18pt">18</option>
        </select>
        <div class="tool-sep"></div>

        <div class="flex gap-2 px-1">
          <div onclick="App.Format.color('#333333')" class="color-dot bg-[#333333]" title="å¢¨è‰²"></div>
          <div onclick="App.Format.color('#2B4B65')" class="color-dot bg-[#2B4B65]" title="è—é‰„"></div>
          <div onclick="App.Format.color('#BF1E33')" class="color-dot bg-[#BF1E33]" title="èŒœè‰²"></div>
          <div onclick="App.Format.color('#2F5D50')" class="color-dot bg-[#2F5D50]" title="åƒæ­²ç¶ "></div>
          <div onclick="App.Format.color('#6A4C9C')" class="color-dot bg-[#6A4C9C]" title="äº¬ç´«"></div>
        </div>
        <div class="tool-sep"></div>

        <div class="flex gap-2 px-1">
          <div onclick="App.Format.highlight('#F0DC70')" class="color-dot bg-[#F0DC70]" title="åˆˆå®‰"></div>
          <div onclick="App.Format.highlight('#F5B199')" class="color-dot bg-[#F5B199]" title="æ¡ƒè‰²"></div>
          <div onclick="App.Format.highlight('#A0D8EF')" class="color-dot bg-[#A0D8EF]" title="ç©ºè‰²"></div>
          <div onclick="App.Format.highlight('#C6Eac5')" class="color-dot bg-[#C6Eac5]" title="è–„ç¶ "></div>
          <div onclick="App.Format.highlight('#E0C8F2')" class="color-dot bg-[#E0C8F2]" title="è—¤è‰²"></div>
        </div>
        <div class="tool-sep"></div>

        <button onclick="App.Format.remove()" class="tool-btn" title="æ¸…é™¤æ ¼å¼">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M18 6L6 18M6 6l12 12"/></svg>
        </button>
      </div>

      <div class="editor-container custom-scroll">
        <div id="editor" contenteditable="true" class="editor-paper shadow-lg" spellcheck="false"></div>
      </div>

      <div class="stats-bar">
        <div class="flex gap-4">
          <span>å­—æ•¸: <b id="countTotal" class="text-[var(--c-accent)]">0</b></span>
          <span id="selCountGroup" class="opacity-50">é¸å–: <b id="countSel">0</b></span>
        </div>
        <button id="btnPunc" onclick="App.UI.togglePunctuation()" class="flex items-center gap-1 text-xs px-2 py-1 rounded border border-[var(--border-color)] hover:bg-gray-100">
          <span class="w-2 h-2 rounded-full bg-green-500" id="puncDot"></span> å«æ¨™é»
        </button>
      </div>
    </main>
  </div>

  <nav class="mobile-tab-bar">
    <button onclick="App.UI.switchMobileTab('input')" class="tab-btn active" id="tabBtnInput">
      <svg class="w-5 h-5 mb-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
      ç·¨è¼¯
    </button>
    <button onclick="App.UI.switchMobileTab('preview')" class="tab-btn" id="tabBtnPreview">
      <svg class="w-5 h-5 mb-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
      é è¦½
    </button>
  </nav>

  <script>
    /* æ ¸å¿ƒé‚è¼¯ v5.0 */
    const Config = {
        titles: (kw) => [`${kw}æ‡¶äººåŒ…ï¼š2025æœ€æ–°æ”»ç•¥`, `ç‚ºä»€éº¼${kw}é€™éº¼å—æ­¡è¿ï¼Ÿ`, `${kw}å®Œå…¨è§£æï¼šæ–°æ‰‹å¿…çœ‹`],
        defaultHTML: '<p>è«‹åœ¨å·¦å´è¼¸å…¥æ–‡å­—...</p>'
    };

    const Dom = {
        source: document.getElementById('sourceText'),
        kw: document.getElementById('kwList'),
        editor: document.getElementById('editor'),
        countTotal: document.getElementById('countTotal'),
        countSel: document.getElementById('countSel'),
        puncDot: document.getElementById('puncDot')
    };

    const App = {
        state: { isAutoSync: true, includePunctuation: true },
        
        Init: () => {
            if(localStorage.getItem('fluo_src')) Dom.source.value = localStorage.getItem('fluo_src');
            if(localStorage.getItem('fluo_kw')) Dom.kw.value = localStorage.getItem('fluo_kw');
            
            // åˆå§‹åŒ–åŒæ­¥
            App.Core.runSync();

            // äº‹ä»¶ç›£è½
            Dom.source.addEventListener('input', () => { App.state.isAutoSync=true; App.Core.runSync(); });
            Dom.kw.addEventListener('input', () => { App.Core.runSync(); });
            Dom.editor.addEventListener('input', () => { 
                App.state.isAutoSync = false; // å³å´ç·¨è¼¯å¾Œï¼Œæš«åœå·¦å´åŒæ­¥ï¼Œé¿å…è¦†è“‹
                App.UI.updateStats();
            });
            document.addEventListener('selectionchange', App.UI.updateStats);
        },

        Core: {
            // ğŸŸ¢ æ ¸å¿ƒåŒæ­¥ï¼šç¢ºä¿æ¯ä¸€è¡Œéƒ½æ˜¯ç¨ç«‹çš„ <p>ï¼Œè§£æ±ºæ•´ç¯‡è®Š H2 çš„å•é¡Œ
            runSync: () => {
                if(!App.state.isAutoSync) return;
                
                const raw = Dom.source.value;
                const kws = Dom.kw.value.split('\n').filter(k => k.trim());
                
                // 1. è½‰ç¾© HTML
                let safeText = raw.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
                
                // 2. é—œéµå­—æ¨™è¨» (Highlight)
                kws.forEach(k => {
                    if(k) safeText = safeText.replace(new RegExp(k, 'gi'), `<b style="color:#BF1E33">${k}</b>`);
                });

                // 3. åˆ†æ®µè™•ç†ï¼šå°‡ \n è½‰ç‚º <p> åŒ…è£¹
                const paragraphs = safeText.split('\n').map(line => {
                    return line.trim() ? `<p>${line}</p>` : '<p><br></p>';
                }).join('');

                Dom.editor.innerHTML = paragraphs || Config.defaultHTML;
                
                // Save
                localStorage.setItem('fluo_src', raw);
                localStorage.setItem('fluo_kw', Dom.kw.value);
                App.UI.updateStats();
            },

            restore: () => {
                if(confirm('ç¢ºå®šé‚„åŸï¼Ÿé€™æœƒè¦†è“‹ç›®å‰çš„ä¿®æ”¹ã€‚')) {
                    Dom.source.value = Dom.editor.innerText;
                    App.state.isAutoSync = true;
                    App.Core.runSync();
                }
            },

            // ğŸŸ¢ è¤‡è£½åˆ° Docsï¼šå¼·åˆ¶å–®è¡Œè¡Œè·èˆ‡æ¨£å¼
            copyToDocs: async () => {
                const wrapper = document.createElement('div');
                // Google Docs é—œéµæ¨£å¼ï¼š12pt, å–®è¡Œè¡Œè·(1.0), æ­£é»‘é«”
                wrapper.style.cssText = "font-family: 'Noto Sans TC', sans-serif; font-size: 12pt; line-height: 1.0; color: #333; background: white;";
                
                const clone = Dom.editor.cloneNode(true);
                
                // éæ­·æ‰€æœ‰å­å…ƒç´ ï¼Œå¼·åˆ¶å¯«å…¥ Inline Style (Docs æ‰åƒå¾—åˆ°)
                const applyStyle = (node) => {
                    if (node.nodeType === 1) { // Element
                        // ä¿ç•™åŸæœ‰é¡è‰²èˆ‡ç²—é«”ï¼Œä½†å¼·åˆ¶è¡Œé«˜
                        node.style.lineHeight = "1.0";
                        node.style.marginBottom = "12pt"; // æ®µè½é–“è·ç”¨ margin æ¨¡æ“¬
                        
                        if (node.tagName === 'H2') {
                            node.style.fontSize = "18pt";
                            node.style.fontWeight = "bold";
                            node.style.color = "#2B4B65";
                            node.style.borderBottom = "1px solid #DDD";
                            node.style.lineHeight = "1.2";
                        }
                        if (node.tagName === 'H3') {
                            node.style.fontSize = "14pt";
                            node.style.fontWeight = "bold";
                            node.style.color = "#333";
                            node.style.borderLeft = "4px solid #BF1E33";
                            node.style.paddingLeft = "8px";
                            node.style.lineHeight = "1.2";
                        }
                    }
                    node.childNodes.forEach(applyStyle);
                };
                applyStyle(clone);
                
                wrapper.innerHTML = clone.innerHTML;

                try {
                    const blobHtml = new Blob([wrapper.outerHTML], {type: 'text/html'});
                    const blobText = new Blob([Dom.editor.innerText], {type: 'text/plain'});
                    await navigator.clipboard.write([new ClipboardItem({'text/html': blobHtml, 'text/plain': blobText})]);
                    alert('âœ¨ å·²è¤‡è£½ï¼è²¼ä¸Š Google Docs å³å¯å‘ˆç¾å®Œç¾æ ¼å¼ã€‚');
                } catch(e) {
                    alert('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•å…¨é¸è¤‡è£½ã€‚');
                }
            },
            
            forceSync: () => { App.state.isAutoSync=true; App.Core.runSync(); }
        },

        Format: {
            cmd: (c, v) => {
                document.execCommand(c, false, v);
                App.state.isAutoSync = false; 
                App.UI.updateStats();
            },
            // å­—ç´šè™•ç† (ä½¿ç”¨ span é¿å…ç ´å£å€å¡Š)
            size: (pt) => {
                const sel = window.getSelection();
                if(sel.isCollapsed) return alert('è«‹å…ˆé¸å–æ–‡å­—');
                
                // ä½¿ç”¨ CSS class æˆ– style æ³¨å…¥
                const span = document.createElement('span');
                span.style.fontSize = pt;
                
                if (sel.rangeCount) {
                    const range = sel.getRangeAt(0);
                    range.surroundContents(span);
                }
                App.state.isAutoSync = false;
            },
            color: (c) => App.Format.cmd('foreColor', c),
            highlight: (c) => { document.execCommand('hiliteColor', false, c) || document.execCommand('backColor', false, c); App.state.isAutoSync=false; },
            remove: () => { App.Format.cmd('removeFormat'); App.Format.cmd('backColor', 'transparent'); }
        },

        UI: {
            updateStats: () => {
                const text = Dom.editor.innerText || '';
                const clean = App.state.includePunctuation ? text : text.replace(/[^\w\u4e00-\u9fa5]/g, '');
                Dom.countTotal.innerText = clean.replace(/[\n\r]/g, '').length;
                
                const sel = window.getSelection().toString();
                Dom.countSel.innerText = App.state.includePunctuation ? sel.length : sel.replace(/[^\w\u4e00-\u9fa5]/g, '').length;
            },
            togglePunctuation: () => {
                App.state.includePunctuation = !App.state.includePunctuation;
                Dom.puncDot.className = App.state.includePunctuation ? "w-2 h-2 rounded-full bg-green-500" : "w-2 h-2 rounded-full bg-gray-300";
                App.UI.updateStats();
            },
            switchMobileTab: (tab) => {
                const input = document.getElementById('tabInput');
                const preview = document.getElementById('tabPreview');
                const btnInput = document.getElementById('tabBtnInput');
                const btnPreview = document.getElementById('tabBtnPreview');
                
                if(tab === 'input') {
                    input.classList.remove('hidden'); input.classList.add('flex');
                    preview.classList.add('hidden'); preview.classList.remove('flex');
                    btnInput.classList.add('active'); btnPreview.classList.remove('active');
                } else {
                    input.classList.add('hidden'); input.classList.remove('flex');
                    preview.classList.remove('hidden'); preview.classList.add('flex');
                    btnInput.classList.remove('active'); btnPreview.classList.add('active');
                }
            },
            toggleTheme: () => {
               const isDark = document.body.getAttribute('data-theme') === 'dark';
               document.body.setAttribute('data-theme', isDark ? 'light' : 'dark');
            }
        },
        
        AI: {
            generate: () => {
                const kw = Dom.kw.value.split('\n')[0] || 'æ‚¨çš„ä¸»é¡Œ';
                alert(`ğŸ’¡ AI æ¨™é¡Œå»ºè­°ï¼š\n\n1. ${kw}æ‡¶äººåŒ…ï¼š2025æœ€æ–°æ”»ç•¥\n2. ç‚ºä»€éº¼${kw}é€™éº¼å—æ­¡è¿ï¼Ÿ\n3. ${kw}å®Œå…¨è§£æï¼šæ–°æ‰‹å¿…çœ‹`);
            },
            close: () => document.getElementById('aiModal').style.display = 'none'
        }
    };

    document.addEventListener('DOMContentLoaded', App.Init);
    window.App = App;
  </script>
</body>
</html>
