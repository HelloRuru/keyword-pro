<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>è›å…‰ãƒšãƒ³ PRO - SEOæ–‡æ¡ˆæ•¸ä½å·¥å…·</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>âœ’ï¸</text></svg>">
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Shippori+Mincho:wght@500;700;900&family=Zen+Kaku+Gothic+New:wght@300;400;500;700&display=swap" rel="stylesheet">

<style>
  /* --- ğŸŸ¢ è‰²ç¥¨ç³»çµ± (Wairo Palette Extended) --- */
  :root {
    --bg-canvas: #F9F8F4;
    --bg-sidebar: #FFFFFF;
    
    /* æ–‡å­—è‰²ç¥¨ (5è‰²) */
    --c-ink: #303133;      /* å¢¨ */
    --c-iron: #2B4B65;     /* è—é‰„ */
    --c-crimson: #BF1E33;  /* çœŸç´… */
    --c-forest: #2F5D50;   /* åƒæ­²ç¶  (æ–°å¢) */
    --c-purple: #6A4C9C;   /* äº¬ç´« (æ–°å¢) */
    
    /* è¢å…‰ç­†è‰²ç¥¨ (5è‰²) */
    --hl-yellow: #F0DC70;  /* åˆˆå®‰ */
    --hl-pink: #F5B199;    /* ä¸€æ–¤æŸ“ */
    --hl-blue: #A0D8EF;    /* ç©ºè‰² (æ–°å¢) */
    --hl-green: #C6Eac5;   /* è£æŸ³ (æ–°å¢) */
    --hl-purple: #E0C8F2;  /* è—¤è‰² (æ–°å¢) */

    --font-ui: 'Zen Kaku Gothic New', sans-serif;
    --font-serif: 'Shippori Mincho', serif;
    --font-docs: 'Noto Sans TC', sans-serif; /* Google Docs Target */

    --noise: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.03'/%3E%3C/svg%3E");
  }

  /* --- åŸºç¤è¨­å®š --- */
  body {
    background-color: var(--bg-canvas);
    color: var(--c-ink);
    font-family: var(--font-ui);
    height: 100vh; overflow: hidden; display: flex; flex-direction: column;
  }
  .bg-noise { position: fixed; inset: 0; background-image: var(--noise); pointer-events: none; z-index: -1; }
  .font-serif { font-family: var(--font-serif); }
  
  /* è‡ªå®šç¾©æ²è»¸ */
  .custom-scroll::-webkit-scrollbar { width: 6px; }
  .custom-scroll::-webkit-scrollbar-track { background: transparent; }
  .custom-scroll::-webkit-scrollbar-thumb { background: #E0E0E0; border-radius: 3px; }
  .custom-scroll::-webkit-scrollbar-thumb:hover { background: #CCC; }

  /* --- å·¦å´ï¼šè¼¸å…¥å€ (Sidebar) --- */
  .sidebar-container {
    background: var(--bg-sidebar); border-right: 1px solid #EBEBEB;
    display: flex; flex-direction: column; z-index: 20;
    box-shadow: 2px 0 10px rgba(0,0,0,0.02);
  }

  .section-title {
    font-family: var(--font-serif); font-weight: 800; color: var(--c-ink);
    font-size: 0.95rem; letter-spacing: 0.05em; margin-bottom: 0.8rem;
    display: flex; align-items: center; gap: 8px;
    position: relative; padding-left: 12px;
  }
  .section-title::before {
    content: ''; position: absolute; left: 0; top: 15%; bottom: 15%;
    width: 3px; background: var(--c-iron); border-radius: 2px;
  }
  .section-title.accent::before { background: var(--c-crimson); }
  .section-title.sub::before { background: #999; }

  .input-field {
    width: 100%; background: #FAFAFA;
    border: 1px solid #EEE; border-radius: 6px;
    padding: 12px; font-size: 14px; color: var(--c-ink); line-height: 1.6;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); resize: none; outline: none;
    font-family: var(--font-ui);
  }
  .input-field:focus { 
    background: #FFF; border-color: var(--c-iron); 
    box-shadow: 0 4px 12px rgba(43, 75, 101, 0.08); 
  }

  /* --- é—œéµå­—å¯†åº¦é¢æ¿ --- */
  .density-panel {
    background: #F8F9FA; border: 1px solid #EEE; border-radius: 6px;
    padding: 8px; margin-bottom: 15px; max-height: 100px; overflow-y: auto;
    display: flex; flex-wrap: wrap; gap: 6px;
  }
  .kw-tag {
    font-size: 11px; padding: 2px 8px; border-radius: 4px;
    background: white; border: 1px solid #E0E0E0; color: #666;
    display: flex; align-items: center; gap: 4px;
    font-family: var(--font-ui); font-weight: 500;
  }
  .kw-tag .count { font-weight: 800; color: var(--c-iron); }
  .kw-tag.missing { border-color: #FECACA; background: #FFF5F5; color: #C9171E; }
  .kw-tag.good { border-color: #C6F6D5; background: #F0FFF4; color: #276749; }

  /* --- å³å´ï¼šé è¦½å€ (Editor) --- */
  .preview-wrapper {
    flex: 1; display: flex; flex-direction: column; 
    background: var(--bg-canvas); position: relative;
    overflow-y: auto; scroll-behavior: smooth;
  }
  
  .editor-paper {
    width: 100%; max-width: 820px; 
    min-height: 100%; 
    margin: 0 auto; 
    background: #FFFFFF; 
    padding: 60px 80px 100px 80px; 
    box-shadow: 0 0 40px rgba(0,0,0,0.03);
    outline: none;
    /* ğŸŸ¢ Google Docs Target Style */
    font-family: var(--font-docs);
    font-size: 12pt; 
    line-height: 1.0; /* å–®è¡Œè¡Œè· */
    color: var(--c-ink);
    letter-spacing: 0.02em; text-align: justify;
  }
  
  /* H2, H3 Style Mapping */
  .editor-paper h2 { 
    font-family: var(--font-docs); font-size: 18pt; font-weight: 700; color: var(--c-iron); 
    border-bottom: 1px solid #E0E0E0; padding-bottom: 8px; margin: 24px 0 16px 0;
  }
  .editor-paper h3 { 
    font-family: var(--font-docs); font-size: 14pt; font-weight: 700; color: var(--c-ink);
    border-left: 4px solid var(--c-crimson); padding-left: 10px; margin: 20px 0 12px 0;
  }
  .editor-paper p { margin-bottom: 12pt; }

  /* --- å·¥å…·åˆ— (Toolbar) --- */
  .toolbar-sticky {
    position: sticky; top: 0; z-index: 40;
    background: rgba(249, 248, 244, 0.95); backdrop-filter: blur(8px);
    border-bottom: 1px solid rgba(0,0,0,0.05);
    display: flex; justify-content: center; padding: 8px;
  }
  .toolbar-inner {
    display: flex; align-items: center; gap: 4px; 
    background: white; padding: 4px 8px; border-radius: 8px;
    border: 1px solid #EAEAEA; box-shadow: 0 4px 15px rgba(0,0,0,0.04);
    flex-wrap: wrap; justify-content: center;
  }
  
  .btn-tool {
    height: 30px; padding: 0 10px; border-radius: 4px;
    font-size: 12px; font-family: var(--font-serif); color: #555;
    transition: all 0.2s; cursor: pointer; border: 1px solid transparent;
    display: flex; align-items: center; justify-content: center;
  }
  .btn-tool:hover { background: #F2F2F2; color: var(--c-iron); }
  .divider { width: 1px; height: 16px; background: #EEE; margin: 0 6px; }

  /* è‰²ç¥¨é» */
  .color-dot { 
    width: 18px; height: 18px; border-radius: 50%; border: 2px solid #FFF; 
    box-shadow: 0 0 0 1px #DDD; cursor: pointer; transition: all 0.2s; 
  }
  .color-dot:hover { transform: scale(1.15); z-index: 10; }

  /* ğŸŸ¢ ä¸‹æ‹‰é¸å–®/æŒ‰éˆ•ç¾¤çµ„å„ªåŒ– */
  .tool-group { display: flex; align-items: center; gap: 4px; }
  select.tool-select {
    height: 30px; border: 1px solid #DDD; border-radius: 4px;
    font-size: 12px; padding: 0 4px; color: #555; background: #FFF; outline: none; cursor: pointer;
    font-family: var(--font-docs);
  }
  select.tool-select:hover { border-color: var(--c-iron); }

  /* --- å´é‚Šæ¬„æŒ‰éˆ• --- */
  .btn-primary {
    width: 100%; background: var(--c-crimson); color: white; border: none; 
    padding: 12px; border-radius: 6px; 
    font-family: var(--font-serif); letter-spacing: 0.1em; font-weight: 700;
    cursor: pointer; box-shadow: 0 4px 12px rgba(191, 30, 51, 0.3); 
    transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px;
    font-size: 14px;
  }
  .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 6px 16px rgba(191, 30, 51, 0.4); }
  
  .btn-secondary {
    flex: 1; background: white; border: 1px solid #DDD; color: #666;
    padding: 8px; border-radius: 6px; font-size: 12px; cursor: pointer; transition: 0.2s;
    display: flex; justify-content: center; align-items: center; gap: 4px;
  }
  .btn-secondary:hover { border-color: var(--c-iron); color: var(--c-iron); background: #F9F9F9; }

  .clear-options {
    display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 6px; margin-top: 6px;
  }

  /* --- RWD --- */
  @media (max-width: 768px) {
    .sidebar-container, .preview-wrapper { width: 100% !important; height: auto; }
    #sectionInput { height: calc(100vh - 120px); }
    .editor-paper { padding: 30px 20px; min-height: 80vh; }
    .toolbar-sticky { overflow-x: auto; justify-content: flex-start; padding-left: 12px; }
    .mobile-hidden { display: none !important; }
  }
  @media (min-width: 769px) {
    .mobile-nav { display: none; }
  }

  .sync-badge {
    position: fixed; bottom: 20px; right: 20px; 
    background: white; border: 1px solid #E0E0E0; padding: 6px 12px;
    border-radius: 30px; font-size: 11px; font-weight: 500; color: #888;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08); display: flex; align-items: center; gap: 6px;
    z-index: 50; transition: all 0.3s;
  }
  .sync-badge.active { border-color: #C6F6D5; color: #2F855A; background: #F0FFF4; }
</style>
</head>
<body>
  <div class="bg-noise"></div>

  <header class="h-14 flex md:hidden items-center px-4 bg-white border-b z-50 justify-between sticky top-0">
    <span class="font-serif font-bold text-lg text-gray-800">è›å…‰ãƒšãƒ³ <span class="text-xs font-sans text-red-600">PRO</span></span>
  </header>

  <div class="flex-1 flex flex-col md:flex-row overflow-hidden relative h-screen">
    
    <aside id="sectionInput" class="sidebar-container w-full md:w-[360px] custom-scroll overflow-y-auto">
      <div class="p-5 flex flex-col min-h-full">
          
          <div class="hidden md:flex items-center gap-2 mb-6 select-none">
            <span class="text-2xl">âœ’ï¸</span>
            <div>
              <h1 class="font-serif font-bold text-lg text-[#303133] tracking-widest leading-none">è›å…‰ãƒšãƒ³ <span class="text-xs font-sans text-[#BF1E33]">PRO</span></h1>
              <p class="text-[9px] text-gray-400 tracking-[0.2em] mt-1">DOCS DRAFTING TOOL v3.0</p>
            </div>
          </div>

          <div class="mb-4">
            <div class="flex justify-between items-end mb-2">
              <div class="section-title mb-0">åŸæ–‡è¼¸å…¥</div>
              <button onclick="restoreFromPreview()" class="text-[10px] text-blue-600 hover:underline flex items-center gap-1" title="å°‡é è¦½å€æ–‡å­—åå‘åŒæ­¥å›æ­¤è™•">
                 ğŸ”„ é‚„åŸ(å¾é è¦½)
              </button>
            </div>
            <textarea id="sourceText" class="input-field min-h-[220px]" placeholder="åœ¨æ­¤è¼¸å…¥æ–‡ç« ...&#10;ç·¨è¼¯å¾Œæœƒè‡ªå‹•åŒæ­¥è‡³å³å´é è¦½ã€‚"></textarea>
          </div>
          
          <div class="mb-4 flex-1">
             <div class="section-title accent">SEO é—œéµå­—</div>
             <textarea id="kwList" class="input-field h-20 mb-2" placeholder="é—œéµå­— (æ¯è¡Œä¸€å€‹)..."></textarea>
             
             <div id="densityPanel" class="density-panel custom-scroll">
                <span class="text-xs text-gray-400 w-full text-center py-2">ç­‰å¾…è¼¸å…¥...</span>
             </div>
          </div>

          <div class="mt-auto pb-4">
            <button onclick="forceSync()" class="btn-primary mb-3">
              <span>âš¡ ä¸€éµæ¨™è¨» (Sync & Check)</span>
            </button>
            
            <button onclick="copyToClipboard()" class="btn-secondary w-full mb-3 !text-[#BF1E33] !border-[#BF1E33]/30 !bg-red-50 hover:!bg-red-100">
              ğŸ“‹ è¤‡è£½åˆ° Docs (æ ¼å¼æœ€ä½³åŒ–)
            </button>

            <div class="section-title sub text-xs mt-4">æ¸…ç©ºé¸é …</div>
            <div class="clear-options">
              <button onclick="clearData('source')" class="btn-secondary text-[10px]">æ¸…ç©ºåŸæ–‡</button>
              <button onclick="clearData('kw')" class="btn-secondary text-[10px]">æ¸…ç©ºé—œéµå­—</button>
              <button onclick="clearData('all')" class="btn-secondary text-[10px] !text-red-500 hover:bg-red-50">å…¨éƒ¨é‡ç½®</button>
            </div>
            
            <div class="text-center mt-6 text-[9px] text-gray-300 font-sans">
              Â© 2025 Gem Apex Architect.
            </div>
          </div>
      </div>
    </aside>

    <main id="sectionPreview" class="preview-wrapper mobile-hidden custom-scroll">
      
      <div class="toolbar-sticky">
        <div class="toolbar-inner">
          <div class="tool-group">
            <button onclick="document.execCommand('undo')" class="btn-tool" title="å¾©åŸ (Ctrl+Z)">â†©</button>
            <button onclick="document.execCommand('redo')" class="btn-tool" title="é‡åš (Ctrl+Y)">â†ª</button>
          </div>
          <div class="divider"></div>

          <div class="tool-group">
             <button onclick="execCmd('formatBlock','h2')" class="btn-tool font-bold" title="æ¨™é¡Œ H2">H2</button>
             <button onclick="execCmd('formatBlock','h3')" class="btn-tool font-bold" title="æ¨™é¡Œ H3">H3</button>
             <button onclick="execCmd('formatBlock','p')" class="btn-tool" title="å…§æ–‡ P">P</button>
          </div>
          <div class="divider"></div>

          <div class="tool-group">
            <select onchange="changeFontSize(this.value)" class="tool-select" title="å­—ç´šèª¿æ•´">
              <option value="10pt">10</option>
              <option value="11pt">11</option>
              <option value="12pt" selected>12</option>
              <option value="14pt">14</option>
              <option value="18pt">18</option>
            </select>
          </div>
          <div class="divider"></div>
          
          <div class="tool-group px-1">
            <div onclick="applyColor('#303133')" class="color-dot" style="background:var(--c-ink)" title="å¢¨"></div>
            <div onclick="applyColor('#2B4B65')" class="color-dot" style="background:var(--c-iron)" title="è—é‰„"></div>
            <div onclick="applyColor('#BF1E33')" class="color-dot" style="background:var(--c-crimson)" title="çœŸç´…"></div>
            <div onclick="applyColor('#2F5D50')" class="color-dot" style="background:var(--c-forest)" title="åƒæ­²ç¶ "></div>
            <div onclick="applyColor('#6A4C9C')" class="color-dot" style="background:var(--c-purple)" title="äº¬ç´«"></div>
          </div>
          <div class="divider"></div>
          
          <div class="tool-group px-1">
            <div onclick="applyHighlight('#F0DC70')" class="color-dot" style="background:var(--hl-yellow)" title="åˆˆå®‰"></div>
            <div onclick="applyHighlight('#F5B199')" class="color-dot" style="background:var(--hl-pink)" title="ä¸€æ–¤æŸ“"></div>
            <div onclick="applyHighlight('#A0D8EF')" class="color-dot" style="background:var(--hl-blue)" title="ç©ºè‰²"></div>
            <div onclick="applyHighlight('#C6Eac5')" class="color-dot" style="background:var(--hl-green)" title="è£æŸ³"></div>
            <div onclick="applyHighlight('#E0C8F2')" class="color-dot" style="background:var(--hl-purple)" title="è—¤è‰²"></div>
          </div>

        </div>
      </div>

      <div id="editor" contenteditable="true" class="editor-paper" placeholder="é è¦½å…§å®¹..."></div>
      
    </main>
  </div>

  <div id="syncBadge" class="sync-badge active">
    <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
    <span>Ready</span>
  </div>

  <nav class="md:hidden fixed bottom-0 left-0 right-0 bg-white border-t h-14 flex z-50">
    <button onclick="switchTab('input')" class="flex-1 text-xs font-bold text-gray-500 hover:text-red-600 flex flex-col items-center justify-center">
      <span>âœï¸ ç·¨è¼¯</span>
    </button>
    <button onclick="switchTab('preview')" class="flex-1 text-xs font-bold text-gray-500 hover:text-red-600 flex flex-col items-center justify-center">
      <span>ğŸ‘ï¸ é è¦½</span>
    </button>
  </nav>

  <script>
    // --- Config & State ---
    const source = document.getElementById('sourceText');
    const kwInput = document.getElementById('kwList');
    const editor = document.getElementById('editor');
    const densityPanel = document.getElementById('densityPanel');
    const syncBadge = document.getElementById('syncBadge');
    
    let isAutoSync = true;
    let saveTimer = null;
    let syncTimer = null;

    // --- Init ---
    window.addEventListener('DOMContentLoaded', () => {
      if(localStorage.getItem('fluo_src')) source.value = localStorage.getItem('fluo_src');
      if(localStorage.getItem('fluo_kw')) kwInput.value = localStorage.getItem('fluo_kw');
      
      const cachedHtml = localStorage.getItem('fluo_html');
      if(cachedHtml) {
        editor.innerHTML = cachedHtml;
        // Check consistency
        if(editor.innerText.replace(/\n/g,'').trim() !== source.value.replace(/\n/g,'').trim()) {
           isAutoSync = false;
           updateBadge('Manual Mode', false);
        }
      } else {
        runSyncLogic(true);
      }
      analyzeDensity();
    });

    // --- Core Logic: Sync (One-Way: Source -> Editor) ---
    function runSyncLogic(silent = false) {
      if(!isAutoSync) return;
      
      let text = source.value;
      if(!text) { if(!silent) editor.innerHTML = ''; return; }

      const rawKws = kwInput.value.split('\n');
      const uniqueKws = [...new Set(rawKws.map(k => k.trim()).filter(k => k))];

      // Escape HTML
      let html = text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");

      // Highlight Logic (Case Insensitive)
      uniqueKws.forEach(kw => {
        const regex = new RegExp(`(${escapeRegExp(kw)})`, 'gi');
        // ä½¿ç”¨ span style ç¢ºä¿ copy åˆ° Docs æ™‚å¸¶æœ‰æ¨£å¼
        html = html.replace(regex, `<span style="color: #BF1E33; font-weight: 700;">$1</span>`);
      });

      // Paragraphs
      const paragraphs = html.split(/\n\s*\n/).map(p => {
        if(!p.trim()) return '';
        // é è¨­æ¨£å¼æ³¨å…¥
        return `<p style="margin-bottom: 12pt;">${p.replace(/\n/g, '<br>')}</p>`;
      }).join('');

      editor.innerHTML = paragraphs;
      analyzeDensity();
      triggerSave();
    }

    // --- Reverse Sync: Editor -> Source ---
    function restoreFromPreview() {
       if(confirm('å°‡é è¦½å€çš„æ–‡å­—å…§å®¹é‚„åŸåˆ°è¼¸å…¥æ¡†ï¼Ÿ\n(é€™æœƒä¿ç•™æ–‡å­—ï¼Œä½†å¯èƒ½æœƒé‡ç½®è¼¸å…¥æ¡†çš„æ’ç‰ˆ)')) {
          source.value = editor.innerText;
          // é‡æ–°åŸ·è¡Œä¸€æ¬¡ Sync ç¢ºä¿ç‹€æ…‹ä¸€è‡´
          forceSync(); 
       }
    }

    // --- Density Analyzer ---
    function analyzeDensity() {
      const text = source.value; // åˆ†æåŸå§‹æ–‡æœ¬è¼ƒæº–ç¢º
      const totalLen = text.length;
      if(totalLen === 0) { densityPanel.innerHTML = '<span class="text-xs text-gray-400">ç„¡å…§å®¹</span>'; return; }

      const rawKws = kwInput.value.split('\n').filter(k => k.trim());
      const uniqueKws = [...new Set(rawKws.map(k => k.trim()))];
      
      if(uniqueKws.length === 0) { densityPanel.innerHTML = '<span class="text-xs text-gray-400">ç„¡é—œéµå­—</span>'; return; }

      let html = '';
      uniqueKws.forEach(kw => {
        const regex = new RegExp(escapeRegExp(kw), 'gi');
        const matches = text.match(regex);
        const count = matches ? matches.length : 0;
        const density = ((count * kw.length / totalLen) * 100).toFixed(1);
        
        let statusClass = '';
        if(count === 0) statusClass = 'missing';
        else if(density > 0.5 && density < 5) statusClass = 'good';

        html += `<div class="kw-tag ${statusClass}">
          ${kw} <span class="count">${count}</span> <span style="font-size:9px; opacity:0.7">(${density}%)</span>
        </div>`;
      });
      densityPanel.innerHTML = html;
    }

    function escapeRegExp(string) {
      return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    }

    // --- Event Listeners ---
    function handleInput() {
      if(isAutoSync) {
        clearTimeout(syncTimer);
        syncTimer = setTimeout(() => runSyncLogic(true), 500);
      } else {
        analyzeDensity();
      }
      triggerSave();
    }
    source.addEventListener('input', handleInput);
    kwInput.addEventListener('input', handleInput);

    editor.addEventListener('input', () => {
      // åªè¦ä½¿ç”¨è€…åœ¨ç·¨è¼¯å€æ‰“å­—ï¼Œå°±é–å®šè‡ªå‹•åŒæ­¥ï¼Œé¿å…è¦†è“‹
      if(isAutoSync) {
        isAutoSync = false;
        updateBadge('Manual Mode', false);
      }
      triggerSave();
    });

    // --- Persistence ---
    function triggerSave() {
      updateBadge('Saving...', true);
      clearTimeout(saveTimer);
      saveTimer = setTimeout(() => {
        localStorage.setItem('fluo_src', source.value);
        localStorage.setItem('fluo_kw', kwInput.value);
        localStorage.setItem('fluo_html', editor.innerHTML);
        updateBadge('All Saved', true);
      }, 800);
    }

    function updateBadge(text, isActive) {
      syncBadge.innerHTML = `<span class="w-2 h-2 rounded-full ${isActive ? 'bg-green-500' : 'bg-orange-400'}"></span> ${text}`;
      syncBadge.className = `sync-badge ${isActive ? 'active' : ''}`;
    }

    // --- Actions ---
    function forceSync() {
      isAutoSync = true;
      updateBadge('Sync Active', true);
      runSyncLogic();
      if(window.innerWidth < 768) switchTab('preview');
    }

    function clearData(type) {
       let msg = '';
       if(type==='source') msg = 'ç¢ºå®šæ¸…ç©ºåŸæ–‡ï¼Ÿ';
       if(type==='kw') msg = 'ç¢ºå®šæ¸…ç©ºé—œéµå­—ï¼Ÿ';
       if(type==='all') msg = 'ç¢ºå®šé‡ç½®æ‰€æœ‰å…§å®¹ï¼Ÿ(ç„¡æ³•å¾©åŸ)';
       
       if(confirm(msg)) {
          if(type === 'source' || type === 'all') source.value = '';
          if(type === 'kw' || type === 'all') kwInput.value = '';
          if(type === 'all') {
             editor.innerHTML = '';
             localStorage.clear();
          }
          forceSync();
       }
    }

    // --- Google Docs Style Baking (The Special Sauce) ---
    async function copyToClipboard() {
      const wrapper = document.createElement('div');
      
      // ğŸŸ¢ æ ¸å¿ƒï¼šå¼·åˆ¶æ³¨å…¥ Google Docs å–œæ­¡çš„æ¨£å¼
      // Noto Sans TC, 12pt, Single Spacing (line-height: 1.0)
      const baseStyle = "font-family: 'Noto Sans TC', sans-serif; font-size: 12pt; line-height: 1.0; color: #303133; text-align: justify;";
      wrapper.style.cssText = baseStyle;
      
      const clone = editor.cloneNode(true);
      
      // éæ­·æ‰€æœ‰ç¯€é»ï¼Œå°‡ CSS Class è½‰æ›ç‚º Inline Style
      const recursiveApply = (node) => {
         if(node.nodeType === 1) { // Element
            // H2
            if(node.tagName === 'H2') {
               node.style.cssText = "font-family: 'Noto Sans TC', sans-serif; font-size: 18pt; font-weight: 700; color: #2B4B65; border-bottom: 1px solid #E0E0E0; padding-bottom: 8px; margin-top: 24px; margin-bottom: 16px; line-height: 1.2;";
            }
            // H3
            else if(node.tagName === 'H3') {
               node.style.cssText = "font-family: 'Noto Sans TC', sans-serif; font-size: 14pt; font-weight: 700; color: #303133; border-left: 4px solid #BF1E33; padding-left: 10px; margin-top: 20px; margin-bottom: 12px; line-height: 1.2;";
            }
            // P
            else if(node.tagName === 'P') {
               // ç¢ºä¿ P ç¹¼æ‰¿ Base Style ä¸¦ä¸”æœ‰é–“è·
               node.style.cssText = baseStyle + " margin-bottom: 12pt;";
            }
         }
         node.childNodes.forEach(recursiveApply);
      };
      recursiveApply(clone);

      wrapper.innerHTML = clone.innerHTML;

      try {
        const htmlBlob = new Blob([wrapper.outerHTML], {type: 'text/html'});
        const textBlob = new Blob([editor.innerText], {type: 'text/plain'});
        await navigator.clipboard.write([new ClipboardItem({'text/html': htmlBlob, 'text/plain': textBlob})]);
        
        // Visual Feedback
        const originalBtn = document.querySelector('.btn-primary'); // å€Ÿç”¨æŒ‰éˆ•ç‰¹æ•ˆ
        alert('âœ¨ å®Œç¾è¤‡è£½ï¼\nå·²é‡å° Google Docs å„ªåŒ–ï¼š\n1. Noto Sans TC å­—é«”\n2. 12pt å­—ç´š\n3. å–®è¡Œè¡Œè·');
      } catch(e) {
        alert('è¤‡è£½å—é˜»ï¼Œè«‹æ‰‹å‹•å…¨é¸è¤‡è£½ (Ctrl+A -> Ctrl+C)ã€‚');
      }
    }

    // --- Formatting Tools ---
    function execCmd(cmd, val) {
      document.execCommand(cmd, false, val);
      if(isAutoSync) { isAutoSync = false; updateBadge('Manual Mode', false); }
    }
    
    function changeFontSize(pt) {
       // é€é span åŒ…è£¹ä¾†æ”¹è®Šå­—é«”å¤§å° (æ¯” font tag æ›´å¥½æ§åˆ¶)
       // é€™è£¡ä½¿ç”¨ä¸€å€‹æŠ€å·§ï¼šå…ˆç”¨ insertHTML æ’å…¥å¸¶æ¨£å¼çš„ span
       const selection = window.getSelection();
       if (!selection.isCollapsed) {
          const range = selection.getRangeAt(0);
          const span = document.createElement("span");
          span.style.fontSize = pt;
          range.surroundContents(span);
       } else {
          // å¦‚æœæ²’æœ‰é¸å–æ–‡å­—ï¼Œé€™æ˜¯ä¸€å€‹æ¯”è¼ƒè¤‡é›œçš„æ¡ˆä¾‹ï¼Œç°¡å–®èµ·è¦‹æç¤ºç”¨æˆ¶
          alert('è«‹å…ˆé¸å–æ–‡å­—å†èª¿æ•´å­—ç´š');
       }
       if(isAutoSync) { isAutoSync = false; updateBadge('Manual Mode', false); }
    }

    function applyColor(hex) {
      execCmd('foreColor', hex);
    }
    
    function applyHighlight(hex) {
      if(!document.execCommand('hiliteColor', false, hex)) {
         document.execCommand('backColor', false, hex);
      }
      if(isAutoSync) { isAutoSync = false; updateBadge('Manual Mode', false); }
    }

    // --- Mobile ---
    function switchTab(tab) {
      const input = document.getElementById('sectionInput');
      const preview = document.getElementById('sectionPreview');
      if(tab === 'input') {
        input.classList.remove('mobile-hidden');
        preview.classList.add('mobile-hidden');
      } else {
        input.classList.add('mobile-hidden');
        preview.classList.remove('mobile-hidden');
      }
    }
  </script>
</body>
</html>
