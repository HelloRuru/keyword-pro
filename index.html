<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>關鍵字螢光筆 Pro - SEO 寫手數位工具</title>
  
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23374B6D' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='m12 19 7-7 3 3-7 7-3-3Z'/%3E%3Cpath d='m18 13-1.5-7.5L2 2l3.5 14.5L13 18l5-5Z'/%3E%3Cpath d='m2 2 5 2.25'/%3E%3Cpath d='m11 4 2 1.5'/%3E%3C/svg%3E">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=Noto+Serif+JP:wght@400;600;900&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  
  <style>
    /* --- Design Tokens --- */
    :root {
      --bg-paper: #F9F8F4;      
      --bg-backdrop: #EBEAE4;   
      --text-primary: #2C2C2C;  
      --color-indigo: #374B6D;  
      --color-red: #B93A32;     
      --border-line: #E0E0DE;
    }

    /* --- Core Layout Reset --- */
    html, body { 
      height: 100%; width: 100%; overflow: hidden; /* 鎖死外層，只允許內部滾動 */
      font-family: 'Noto Sans JP', sans-serif; 
      background-color: var(--bg-paper); 
      color: var(--text-primary); 
      margin: 0; padding: 0;
    }
    .serif-font { font-family: 'Noto Serif JP', serif; }

    /* App Shell */
    .app-container { 
      display: flex; flex-direction: column; height: 100vh; width: 100vw;
    }

    /* --- Components --- */
    
    /* Header */
    .header-area { 
      flex-shrink: 0; height: 60px; z-index: 50; background: var(--bg-paper); 
      display: flex; align-items: center; justify-content: space-between;
      border-bottom: 1px solid var(--border-line); padding: 0 20px;
    }

    /* Main Workspace */
    .main-workspace { 
      display: flex; flex: 1; overflow: hidden; position: relative; 
    }

    /* Left Sidebar */
    .sidebar-input { 
      width: 360px; height: 100%; background: #fff; border-right: 1px solid var(--border-line);
      display: flex; flex-direction: column; flex-shrink: 0; z-index: 20;
    }
    @media (max-width: 768px) { .sidebar-input { display: none; } }

    .input-group { flex: 1; display: flex; flex-direction: column; padding: 20px; border-bottom: 1px solid var(--border-line); overflow: hidden; }
    textarea.source-input { 
      flex: 1; width: 100%; resize: none; border: none; outline: none; 
      font-size: 14px; line-height: 1.6; color: #4b5563; background: transparent;
    }

    /* --- Right Preview Section (The Fix) --- */
    .preview-section { 
      flex: 1; 
      display: flex; 
      flex-direction: column; /* 垂直排列：工具列在上，畫布在下 */
      background-color: var(--bg-backdrop); 
      /* 紙張紋理 */
      background-image: radial-gradient(#ccc 1px, transparent 1px);
      background-size: 20px 20px;
      position: relative;
      overflow: hidden; /* 防止溢出到 body */
    }

    /* Toolbar (Fixed Top) */
    .inline-toolbar { 
      background: #fff; border-bottom: 1px solid rgba(0,0,0,0.06); 
      height: 48px; flex-shrink: 0; /* 不可壓縮 */
      padding: 0 20px; display: flex; align-items: center; gap: 10px; 
      box-shadow: 0 2px 8px rgba(0,0,0,0.03); z-index: 40;
    }

    /* 核心滾動區 (Scroll Container) */
    .scrollable-preview-area { 
      flex: 1; /* 佔滿剩餘空間 */
      overflow-y: auto; /* 唯一產生捲軸的地方 */
      overflow-x: hidden;
      display: block; /* 確保是 Block context */
      padding: 40px 0 300px 0; /* 底部預留 300px 空間，避免打字卡底 */
      text-align: center; /* 讓內部的 inline-block 居中 */
    }

    /* 自定義捲軸 */
    .scrollable-preview-area::-webkit-scrollbar { width: 8px; }
    .scrollable-preview-area::-webkit-scrollbar-thumb { background: #ccc; border-radius: 4px; }
    .scrollable-preview-area::-webkit-scrollbar-thumb:hover { background: var(--color-indigo); }

    /* 紙張本體 (The Paper) */
    .editor-paper { 
      display: inline-block; /* 配合 text-align: center 居中 */
      width: 90%; max-width: 800px; 
      min-height: 1000px; /* 最小高度 */
      height: auto !important; /* 強制：隨內容長高 */
      
      background: #FFFFFF; 
      padding: 80px 70px; /* 內部留白 */
      margin: 0 auto; /* 水平居中雙保險 */
      text-align: left; /* 內容靠左 */
      
      /* 排版規則 */
      white-space: pre-wrap;       /* 保留換行 */
      word-wrap: break-word;       /* 長字斷行 */
      overflow-wrap: break-word;   
      line-height: 2.2;            
      font-size: 17px; 
      color: #333;
      
      /* 陰影 */
      box-shadow: 0 4px 30px rgba(0,0,0,0.08);
      border-radius: 2px;
      position: relative;
    }
    
    @media (max-width: 768px) {
      .editor-paper { width: 95%; padding: 40px 20px; min-height: 600px; }
    }

    /* --- UI Elements --- */
    .icon-btn { padding: 6px; border-radius: 4px; color: #64748b; cursor: pointer; transition: 0.2s; display: flex; }
    .icon-btn:hover { background: #f1f5f9; color: var(--color-indigo); }
    
    .swatch-item { width: 22px; height: 22px; border-radius: 50%; border: 2px solid #fff; box-shadow: 0 0 0 1px #e2e8f0; cursor: pointer; }
    .swatch-item:hover { transform: scale(1.1); border-color: #cbd5e1; }

    .btn-primary { 
      width: 100%; padding: 10px; border-radius: 8px; 
      background: var(--color-red); color: white; font-weight: 700;
      display: flex; align-items: center; justify-content: center; gap: 8px; font-size: 13px;
      transition: 0.2s;
    }
    .btn-primary:hover { opacity: 0.9; }
    
    .status-bar { 
      height: 36px; background: #fff; border-top: 1px solid var(--border-line); 
      padding: 0 20px; font-size: 11px; color: #94a3b8; font-weight: 700; 
      display: flex; align-items: center; justify-content: space-between; flex-shrink: 0;
    }
    
    .divider { width: 1px; height: 18px; background: #e2e8f0; margin: 0 6px; }
    .label-header { font-size: 11px; font-weight: 700; color: var(--color-indigo); text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 10px; display: flex; align-items: center; gap: 6px; }
  </style>
</head>
<body class="app-container">

  <header class="header-area">
    <div class="flex items-center gap-3">
      <div class="w-8 h-8 border-2 border-[var(--color-indigo)] flex items-center justify-center rounded text-[var(--color-indigo)]">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m12 19 7-7 3 3-7 7-3-3Z"/><path d="m18 13-1.5-7.5L2 2l3.5 14.5L13 18l5-5Z"/></svg>
      </div>
      <h1 class="text-base font-black text-[var(--color-indigo)] tracking-[0.2em] serif-font">蛍光ペン PRO</h1>
    </div>
    <button onclick="copyToDocs()" class="px-4 py-1.5 border border-[var(--text-primary)] rounded-full text-[11px] font-bold hover:bg-[var(--text-primary)] hover:text-white transition-all tracking-widest">複製文案</button>
  </header>

  <main class="main-workspace">
    <div class="sidebar-input">
      <div class="input-group" style="flex: 2;">
        <div class="label-header">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><line x1="10" y1="9" x2="8" y2="9"/></svg>
          原文輸入 (Source)
        </div>
        <textarea id="sourceText" class="source-input" oninput="syncPreview()" placeholder="請在此貼上文章..."></textarea>
      </div>
      
      <div class="input-group bg-slate-50" style="flex: 1;">
        <div class="label-header">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg>
          SEO 關鍵字
        </div>
        <textarea id="kwList" oninput="runDensityAnalysis()" class="h-16 mb-2 text-sm bg-transparent border-b border-dashed border-slate-300 outline-none resize-none" placeholder="一行一個關鍵字..."></textarea>
        <div id="densityResults" class="flex-1 overflow-y-auto mb-2 space-y-1"></div>
        <button onclick="runAutoMark()" class="btn-primary">一鍵標註 (Auto Mark)</button>
        <button onclick="resetAll()" class="text-[10px] text-slate-400 mt-2 underline text-center w-full">清空重置</button>
      </div>
    </div>

    <div class="preview-section">
      <div class="inline-toolbar">
        <button onmousedown="event.preventDefault(); cmd('undo')" class="icon-btn"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 7v6h6"/><path d="M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"/></svg></button>
        <button onmousedown="event.preventDefault(); cmd('redo')" class="icon-btn"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 7v6h-6"/><path d="M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3L21 13"/></svg></button>
        
        <div class="divider"></div>
        
        <div class="flex items-center gap-1.5">
           <div class="swatch-item bg-[#2C2C2C]" onmousedown="event.preventDefault(); applyColor('#2C2C2C')"></div>
           <div class="swatch-item bg-[#B93A32]" onmousedown="event.preventDefault(); applyColor('#B93A32')"></div>
           <div class="swatch-item bg-[#374B6D]" onmousedown="event.preventDefault(); applyColor('#374B6D')"></div>
        </div>

        <div class="divider"></div>

        <div class="flex items-center gap-1.5">
          <div class="swatch-item bg-[#FEECEC]" onmousedown="event.preventDefault(); applyHilite('#FEECEC')"></div>
          <div class="swatch-item bg-[#FFF9C4]" onmousedown="event.preventDefault(); applyHilite('#FFF9C4')"></div>
          <div class="swatch-item bg-[#D1EAED]" onmousedown="event.preventDefault(); applyHilite('#D1EAED')"></div>
          <button onmousedown="event.preventDefault(); applyHilite('transparent')" class="icon-btn ml-1"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="4.93" y1="4.93" x2="19.07" y2="19.07"/></svg></button>
        </div>
        
        <div class="divider"></div>
        <button onmousedown="event.preventDefault(); applyRedBold()" class="border border-red-200 text-red-600 text-[10px] font-bold px-2 py-0.5 rounded-full hover:bg-red-50">重點</button>
      </div>

      <div class="scrollable-preview-area">
        <div id="editor" contenteditable="true" class="editor-paper serif-font" placeholder="開始寫作..."></div>
      </div>
      
      <footer class="status-bar">
        <div class="flex gap-4">
          <span>字數: <span id="totalCount" class="text-slate-900">0</span></span>
          <span>選取: <span id="selectCount" class="text-slate-900">0</span></span>
        </div>
        <div class="opacity-30">V4.0 Final</div>
      </footer>
    </div>
  </main>

  <script>
    // Logic Initialization
    const editor = document.getElementById('editor'); 
    const source = document.getElementById('sourceText');
    const totalCount = document.getElementById('totalCount'); 
    const selectCount = document.getElementById('selectCount');
    const kwListArea = document.getElementById('kwList'); 
    const densityResults = document.getElementById('densityResults');

    function cmd(command, value = null) {
      editor.focus();
      document.execCommand(command, false, value);
      updateCounts(); 
    }

    function applyColor(hex) { cmd('foreColor', hex); }
    function applyHilite(hex) {
      if (!document.execCommand('hiliteColor', false, hex)) {
        document.execCommand('backColor', false, hex); 
      }
      editor.focus();
    }

    function applyRedBold() {
      editor.focus();
      document.execCommand('bold');
      applyColor('#B93A32');
    }

    // Sync Logic
    function syncPreview() {
      editor.innerText = source.value; 
      updateCounts();
      runDensityAnalysis();
    }

    function updateCounts() {
      totalCount.innerText = editor.innerText.replace(/\s/g, '').length;
    }

    document.addEventListener('selectionchange', () => {
      const sel = window.getSelection().toString();
      selectCount.innerText = sel.replace(/\s/g, '').length;
    });

    // Analysis Logic
    function runDensityAnalysis() {
      const keywords = kwListArea.value.split('\n').filter(k => k.trim() !== "");
      const content = editor.innerText || "";
      const totalChars = content.length;
      
      densityResults.innerHTML = "";
      if (totalChars === 0 && keywords.length > 0) return;

      keywords.forEach(kw => {
        const regex = new RegExp(kw.trim(), 'gi');
        const count = (content.match(regex) || []).length;
        const density = ((count * kw.trim().length / totalChars) * 100).toFixed(1);
        
        let badgeClass = "bg-gray-100 text-gray-600";
        if (density > 0 && density <= 1) badgeClass = "bg-green-100 text-green-700";
        if (density > 1 && density <= 3) badgeClass = "bg-blue-100 text-blue-700";
        if (density > 3) badgeClass = "bg-red-100 text-red-700";

        const div = document.createElement('div');
        div.className = "flex justify-between items-center text-xs border-b border-gray-100 pb-1 pt-1";
        div.innerHTML = `
          <span class="text-slate-600 truncate mr-2 w-20" title="${kw}">${kw}</span>
          <span class="px-2 py-0.5 rounded-full ${badgeClass} font-mono font-bold">${density}%</span>
        `;
        densityResults.appendChild(div);
      });
    }

    function runAutoMark() {
      const list = kwListArea.value.split('\n').filter(t => t.trim() !== "");
      if (list.length === 0) return;

      let html = editor.innerText;
      html = html.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");

      list.forEach(kw => {
        const cleanKw = kw.trim().replace(/[.*+?^${}()|[\]\\]/g, '\\$&'); 
        const regex = new RegExp(`(${cleanKw})`, 'gi');
        html = html.replace(regex, `<span style="color:#B93A32; font-weight:bold; text-decoration: underline; text-decoration-style: dashed; text-decoration-color: #B93A32;">$1</span>`);
      });
      
      editor.innerHTML = html;
      updateCounts();
    }

    function resetAll() {
      if (confirm("確定要清空嗎？")) {
        source.value = ""; kwListArea.value = ""; editor.innerHTML = ""; densityResults.innerHTML = ""; updateCounts();
      }
    }

    async function copyToDocs() {
      const blobHtml = new Blob([editor.innerHTML], { type: 'text/html' });
      const blobText = new Blob([editor.innerText], { type: 'text/plain' });
      const data = [new ClipboardItem({ 'text/html': blobHtml, 'text/plain': blobText })];
      try { await navigator.clipboard.write(data); alert('✨ 已複製'); } catch (err) { alert('複製失敗'); }
    }

    source.value = ""; editor.focus();
  </script>
</body>
</html>
