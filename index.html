<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>è›å…‰ãƒšãƒ³ PRO - Kaoru Tsai 2025 Official</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Shippori+Mincho:wght@400;500;700&family=Zen+Kaku+Gothic+New:wght@300;400;500&display=swap" rel="stylesheet">
  
  <style>
    :root {
      /* è‰²ç¥¨ï¼šæ—¥ç³»æ–‡å…·é¢¨ (ç¶­æŒ V6.0 è¨­å®š) */
      --bg-canvas: #F5F4F0;       /* ç±³è‰²ç•«å¸ƒ */
      --bg-sidebar: #FCFCFA;      /* å´æ¬„ */
      --color-ink: #333333;       /* å¢¨ */
      --color-sub: #7A7A7A;       /* é‰›ç­†ç° */
      --color-accent: #A83636;    /* è˜‡èŠ³ç´… */
      --color-accent-hover: #8A2525;
      
      /* ç‹€æ…‹æŒ‡ç¤ºç‡ˆé¡è‰² */
      --status-saving: #D97706;   /* å„²å­˜ä¸­ (æ©˜) */
      --status-saved: #059669;    /* å·²å„²å­˜ (ç¶ ) */

      /* é™°å½±ç³»çµ± */
      --shadow-card: 0 2px 5px rgba(0,0,0,0.03), 0 1px 2px rgba(0,0,0,0.02);
      
      /* ç´‹ç† */
      --noise: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.04'/%3E%3C/svg%3E");
    }

    body {
      background-color: var(--bg-canvas);
      color: var(--color-ink);
      font-family: 'Zen Kaku Gothic New', sans-serif;
      height: 100vh; overflow: hidden;
    }
    .bg-noise { position: fixed; inset: 0; background-image: var(--noise); pointer-events: none; z-index: -1; }
    .font-serif { font-family: 'Shippori Mincho', serif; }

    /* ICON ç·šæ¢é¢¨æ ¼ */
    .icon-line {
      width: 18px; height: 18px;
      stroke-width: 1.5px;
      stroke: currentColor;
      fill: none;
      stroke-linecap: round; stroke-linejoin: round;
    }

    /* è¼¸å…¥æ¡†å„ªåŒ– */
    .input-field {
      width: 100%; background: #FFFFFF;
      border: 1px solid transparent; border-bottom: 1px dashed #CCC;
      padding: 12px; font-size: 14px; color: var(--color-ink);
      transition: all 0.3s ease; resize: none; border-radius: 4px;
    }
    .input-field:focus {
      background: #FFFFFF; border-bottom-color: var(--color-accent);
      box-shadow: 0 0 0 3px rgba(168, 54, 54, 0.05); outline: none;
    }

    /* å·¥å…·åˆ—æŒ‰éˆ• (ä¸­è‹±å°ç…§) */
    .btn-tile {
      display: flex; align-items: center; justify-content: center; gap: 4px;
      padding: 6px 10px; background: #FFFFFF;
      border: 1px solid #EAEAEA; border-radius: 6px;
      color: var(--color-sub);
      font-family: 'Zen Kaku Gothic New', sans-serif; /* æ”¹å›é»‘é«”ä»¥åˆ©é–±è®€ä¸­æ–‡ */
      font-size: 12px; font-weight: 500;
      cursor: pointer; box-shadow: var(--shadow-card);
      transition: all 0.2s; user-select: none;
    }
    .btn-tile:hover {
      transform: translateY(-2px); border-color: #D1D1D1;
      color: var(--color-ink); box-shadow: 0 4px 8px rgba(0,0,0,0.05);
    }
    /* è‹±æ–‡å°æ¨™ç±¤ */
    .sub-label { font-size: 9px; opacity: 0.6; font-family: 'Shippori Mincho', serif; margin-left: 2px; text-transform: uppercase; }

    /* ä¸»æŒ‰éˆ• */
    .btn-primary {
      width: 100%; background: var(--color-accent); color: white;
      border: none; padding: 12px; border-radius: 8px;
      font-family: 'Shippori Mincho', serif; letter-spacing: 0.05em; font-weight: bold;
      cursor: pointer; box-shadow: 0 4px 10px rgba(168, 54, 54, 0.2);
      transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px;
    }
    .btn-primary:hover { background: var(--color-accent-hover); transform: translateY(-1px); }

    /* æ¬¡è¦æŒ‰éˆ• */
    .btn-secondary {
      flex: 1; background: transparent; border: 1px solid #DDD;
      color: #666; padding: 8px; border-radius: 6px; font-size: 12px;
      cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 6px;
    }
    .btn-secondary:hover { border-color: #999; color: #333; background: white; }

    /* åˆ†éš”ç·š */
    .divider { width: 1px; height: 20px; background: #E0E0E0; margin: 0 6px; }

    /* ç·¨è¼¯ç´™å¼µ */
    .editor-paper {
      width: 100%; max-width: 820px; min-height: 100vh;
      background: #FFFFFF; padding: 80px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.04); outline: none;
      /* Docs Core */
      font-family: "Microsoft JhengHei", "å¾®è»Ÿæ­£é»‘é«”", sans-serif !important;
      font-size: 12pt !important; line-height: 2.0 !important; color: #333;
    }
    @media (max-width: 768px) { .editor-paper { padding: 40px 24px; } }

    /* è‰²ç¥¨ */
    .color-dot {
      width: 20px; height: 20px; border-radius: 50%; border: 2px solid white;
      box-shadow: 0 0 0 1px #EEE; cursor: pointer; transition: 0.2s;
    }
    .color-dot:hover { transform: scale(1.15); box-shadow: 0 0 0 1px #AAA; }

    /* æ³•å¾‹å®£å‘Š Footer */
    .legal-footer {
      font-size: 10px; color: #999; text-align: center;
      padding-top: 20px; border-top: 1px dashed #E0E0E0; margin-top: auto;
      font-family: 'Zen Kaku Gothic New', sans-serif;
    }

    /* Modal */
    .modal-backdrop {
      position: fixed; inset: 0; background: rgba(245, 244, 240, 0.9);
      backdrop-filter: blur(4px); z-index: 50; display: none;
      align-items: center; justify-content: center;
    }
    .modal-card {
      background: white; padding: 30px; border-radius: 12px;
      box-shadow: 0 20px 50px rgba(0,0,0,0.1); width: 320px;
      text-align: center; border: 1px solid #EEE;
    }
  </style>
</head>
<body class="flex flex-col md:flex-row">
  <div class="bg-noise"></div>

  <div id="resetModal" class="modal-backdrop" onclick="closeResetModal(event)">
    <div class="modal-card">
      <div class="w-12 h-12 bg-red-50 rounded-full flex items-center justify-center mx-auto mb-4 text-[#A83636]">
        <svg class="icon-line w-6 h-6" viewBox="0 0 24 24"><path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
      </div>
      <h3 class="font-serif font-bold text-lg mb-2 text-gray-800">ç¢ºèªæ¸…ç©ºè³‡æ–™ï¼Ÿ</h3>
      <p class="text-xs text-gray-500 mb-6">æ­¤å‹•ä½œå°‡æœƒæ¸…é™¤æ‰€æœ‰è‰ç¨¿èˆ‡è‡ªå‹•å„²å­˜çš„ç´€éŒ„ï¼Œç„¡æ³•å¾©åŸã€‚</p>
      
      <button onclick="execReset('source')" class="w-full py-3 mb-2 border rounded-lg text-sm hover:bg-gray-50 transition text-gray-600 flex justify-between px-4">
        <span>æ¸…é™¤åŸæ–‡è‰ç¨¿</span> <span class="text-xs text-gray-400">INPUT ONLY</span>
      </button>
      <button onclick="execReset('kw')" class="w-full py-3 mb-2 border rounded-lg text-sm hover:bg-gray-50 transition text-gray-600 flex justify-between px-4">
        <span>æ¸…é™¤é—œéµå­—åº«</span> <span class="text-xs text-gray-400">KW ONLY</span>
      </button>
      <button onclick="execReset('all')" class="w-full py-3 border border-red-200 bg-red-50 text-[#A83636] rounded-lg text-sm font-bold hover:bg-red-100 transition mt-2 flex justify-between px-4">
        <span>å…¨éƒ¨é‚„åŸ</span> <span class="text-xs opacity-70">RESET ALL</span>
      </button>
    </div>
  </div>

  <div id="toast" class="fixed top-8 left-1/2 -translate-x-1/2 bg-white border border-gray-200 text-gray-800 px-6 py-3 rounded-full shadow-lg text-sm font-medium opacity-0 transition-opacity z-50 flex items-center gap-3">
    <div id="toastIcon"></div>
    <span id="toastMsg">Action Completed</span>
  </div>

  <aside class="w-full md:w-[340px] bg-[var(--bg-sidebar)] border-r border-[#EAEAEA] flex flex-col z-20 flex-shrink-0 md:h-full shadow-[4px_0_20px_rgba(0,0,0,0.01)]">
    <div class="h-16 flex items-center px-6 border-b border-[#F0F0F0] bg-white justify-between">
       <span class="font-serif font-bold text-xl tracking-widest text-gray-800 flex items-center gap-2">
         <svg class="icon-line text-[#A83636]" viewBox="0 0 24 24"><path d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg>
         è›å…‰ãƒšãƒ³ <span class="text-xs bg-gray-100 px-1.5 py-0.5 rounded text-gray-500 font-sans tracking-normal">PRO</span>
       </span>
    </div>

    <div class="p-6 flex flex-col h-full overflow-y-auto">
       
       <div class="flex-1 flex flex-col min-h-[180px] mb-6">
         <div class="flex items-center gap-2 mb-2">
           <svg class="icon-line text-[#A83636]" viewBox="0 0 24 24"><path d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
           <span class="font-bold text-sm text-gray-600 tracking-wide">åŸæ–‡è¼¸å…¥</span>
           <span class="text-[10px] text-gray-400 font-serif">DRAFT</span>
         </div>
         <textarea id="sourceText" class="input-field h-full" placeholder="è«‹åœ¨æ­¤è²¼ä¸Šæ–‡ç« è‰ç¨¿... (ç³»çµ±å°‡è‡ªå‹•å„²å­˜)"></textarea>
       </div>

       <div class="h-[180px] flex flex-col flex-shrink-0 mb-6">
          <div class="flex items-center gap-2 mb-2">
            <svg class="icon-line text-[#A83636]" viewBox="0 0 24 24"><path d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path></svg>
            <span class="font-bold text-sm text-gray-600 tracking-wide">SEO é—œéµå­—</span>
            <span class="text-[10px] text-gray-400 font-serif">KEYWORDS</span>
          </div>
          <textarea id="kwList" class="input-field h-full" placeholder="æ¯è¡Œä¸€å€‹é—œéµå­—..."></textarea>
       </div>

       <div class="mt-auto">
         <button onclick="runAutoMark()" class="btn-primary mb-4">
           <svg class="icon-line" style="stroke: white;" viewBox="0 0 24 24"><path d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
           ä¸€éµæ³¨å…¥æ¨£å¼ <span class="text-[10px] opacity-70 font-normal">INJECT</span>
         </button>
         
         <div class="flex gap-3">
           <button onclick="downloadTxt()" class="btn-secondary">
             <svg class="icon-line w-3 h-3" viewBox="0 0 24 24"><path d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
             ä¸‹è¼‰ .txt
           </button>
           <button onclick="openResetModal()" class="btn-secondary hover:text-red-600 hover:border-red-200">
             <svg class="icon-line w-3 h-3" viewBox="0 0 24 24"><path d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
             æ¸…ç©ºé‡ç½®
           </button>
         </div>

         <div class="legal-footer">
            <p class="font-serif font-bold text-gray-400">Â© 2025 Kaoru Tsai.</p>
            <p class="scale-90 opacity-70">All Rights Reserved.</p>
         </div>
       </div>
    </div>
  </aside>

  <main class="flex-1 flex flex-col bg-[#F5F4F0] relative min-w-0">
    
    <header class="h-16 flex items-center px-6 flex-shrink-0 z-30 sticky top-0 bg-[#F5F4F0]/95 backdrop-blur border-b border-transparent transition-all" id="mainHeader">
      
      <div class="flex items-center gap-2 overflow-x-auto no-scrollbar">
        <button onclick="applyStyle('h1')" class="btn-tile" title="Heading 1">H1 <span class="sub-label">å¤§æ¨™</span></button>
        <button onclick="applyStyle('h2')" class="btn-tile" title="Heading 2">H2 <span class="sub-label">å‰¯æ¨™</span></button>
        <button onclick="applyStyle('p')" class="btn-tile" title="Paragraph">å…§æ–‡ <span class="sub-label">TEXT</span></button>
        
        <div class="divider"></div>
        
        <button onclick="applyStyle('red')" class="btn-tile text-[#A83636] border-[#FAD4D4] bg-[#FFF5F5]" title="Red Marker">
          <svg class="icon-line w-4 h-4" viewBox="0 0 24 24"><path d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg>
          <span class="font-bold">é‡é»</span>
        </button>

        <div class="divider"></div>

        <button onclick="execCmd('undo')" class="btn-tile" title="Undo">
           <svg class="icon-line w-4 h-4" viewBox="0 0 24 24"><path d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"></path></svg>
           <span class="hidden md:inline sub-label text-[10px] ml-1">å¾©åŸ</span>
        </button>
        <button onclick="execCmd('redo')" class="btn-tile" title="Redo">
           <svg class="icon-line w-4 h-4" viewBox="0 0 24 24"><path d="M21 10h-10a8 8 0 00-8 8v2M21 10l-6 6m6-6l-6-6"></path></svg>
           <span class="hidden md:inline sub-label text-[10px] ml-1">é‡åš</span>
        </button>

        <div class="divider"></div>

        <div class="flex items-center gap-2 px-2 flex-shrink-0">
          <div onclick="applyColor('#333333')" class="color-dot bg-[#333]" title="å¢¨è‰² (Black)"></div>
          <div onclick="applyColor('#192F60')" class="color-dot bg-[#192F60]" title="ç´ºé’ (Navy)"></div>
          <div onclick="applyColor('#B93A32')" class="color-dot bg-[#B93A32]" title="è˜‡èŠ³ (Red)"></div>
          <div class="w-px h-4 bg-gray-300 mx-1"></div>
          <div onclick="applyHighlight('#FFF2CC')" class="color-dot bg-[#FFF2CC]" title="é»ƒ (Yellow)"></div>
          <div onclick="applyHighlight('#FAD4D4')" class="color-dot bg-[#FAD4D4]" title="ç²‰ (Pink)"></div>
          <div onclick="applyHighlight('#D0E0E3')" class="color-dot bg-[#D0E0E3]" title="è— (Blue)"></div>
        </div>

        <div class="divider"></div>

        <button onclick="copyToDocs()" class="btn-tile text-[#333] font-bold border-gray-300 hover:bg-gray-800 hover:text-white transition-colors">
          <svg class="icon-line w-4 h-4" viewBox="0 0 24 24"><path d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path></svg>
          è¤‡è£½æ–‡æ¡ˆ
        </button>
      </div>
    </header>

    <div class="flex-1 overflow-y-auto flex flex-col items-center pb-20 scroll-smooth relative" id="scrollCanvas">
      
      <div id="editor" contenteditable="true" class="editor-paper mt-6 mb-6 text-justify rounded-sm" placeholder="è«‹åœ¨æ­¤é–‹å§‹æ’°å¯«æ–‡æ¡ˆ... (å³ä½¿é—œé–‰ç€è¦½å™¨ï¼Œå…§å®¹ä¹Ÿæœƒä¿ç•™)"></div>
      
      <div class="w-full max-w-[820px] flex justify-between items-center text-[11px] text-gray-400 mt-2 px-4">
         <div class="font-serif tracking-widest flex items-center gap-2">
           <span id="charCount">0 å­—</span>
           <span>|</span>
           <span id="saveStatus" class="flex items-center gap-1 transition-colors duration-300">
             <span class="w-2 h-2 rounded-full bg-gray-300"></span> æº–å‚™å°±ç·’
           </span>
         </div>
         
         <div class="font-serif tracking-wide opacity-50">
           Â© 2025 Kaoru Tsai. All Rights Reserved.
         </div>
      </div>

    </div>
  </main>

  <script>
    // --- æ ¸å¿ƒè®Šæ•¸ ---
    const editor = document.getElementById('editor');
    const source = document.getElementById('sourceText');
    const kwListArea = document.getElementById('kwList');
    const resetModal = document.getElementById('resetModal');
    const statusLabel = document.getElementById('saveStatus');

    // Docs ç›¸å®¹æ¨£å¼ (æš´åŠ›å¯«æ­»)
    const FONT_FAMILY = "font-family: 'Microsoft JhengHei', 'å¾®è»Ÿæ­£é»‘é«”', sans-serif;";
    const BASE_STYLE = `${FONT_FAMILY} font-size: 12pt; line-height: 2.0; color: #333;`;

    // ----------------------------------------------------
    // ğŸ’¾ 1. è‰ç¨¿è¨˜æ†¶ç³»çµ± (LocalStorage Engine)
    // ----------------------------------------------------
    
    // åˆå§‹åŒ–ï¼šè¼‰å…¥èˆŠè³‡æ–™
    window.addEventListener('DOMContentLoaded', () => {
      if(localStorage.getItem('fluo_draft_source')) source.value = localStorage.getItem('fluo_draft_source');
      if(localStorage.getItem('fluo_draft_kw')) kwListArea.value = localStorage.getItem('fluo_draft_kw');
      if(localStorage.getItem('fluo_draft_content')) {
         editor.innerHTML = localStorage.getItem('fluo_draft_content');
      } else {
         // è‹¥ç„¡å…§å®¹ï¼Œçµ¦é è¨­ç©ºè¡Œé˜²æ­¢æ ¼å¼è·‘æ‰
         if(!editor.innerText.trim()) editor.innerHTML = `<span style="${BASE_STYLE}"><br></span>`;
      }
      updateCounts();
    });

    // å„²å­˜é‚è¼¯ (Debounce é˜²æŠ–å‹•ï¼Œé¿å…æ¯æ‰“ä¸€å€‹å­—å°±å¯«ç¡¬ç¢Ÿ)
    let saveTimeout;
    function triggerSave() {
      updateStatus('saving');
      clearTimeout(saveTimeout);
      saveTimeout = setTimeout(() => {
        localStorage.setItem('fluo_draft_source', source.value);
        localStorage.setItem('fluo_draft_kw', kwListArea.value);
        localStorage.setItem('fluo_draft_content', editor.innerHTML);
        updateStatus('saved');
      }, 800); // 0.8ç§’å¾ŒåŸ·è¡Œå„²å­˜
    }

    // ç›£è½è¼¸å…¥äº‹ä»¶
    source.addEventListener('input', triggerSave);
    kwListArea.addEventListener('input', triggerSave);
    editor.addEventListener('input', () => {
      triggerSave();
      updateCounts();
    });

    // ç‹€æ…‹é¡¯ç¤ºæ›´æ–°
    function updateStatus(state) {
      if(state === 'saving') {
        statusLabel.innerHTML = `<span class="w-2 h-2 rounded-full bg-orange-500 animate-pulse"></span> å„²å­˜ä¸­...`;
        statusLabel.style.color = '#D97706';
      } else if (state === 'saved') {
        statusLabel.innerHTML = `<span class="w-2 h-2 rounded-full bg-green-600"></span> å·²å„²å­˜`;
        statusLabel.style.color = '#059669';
      }
    }

    // ----------------------------------------------------
    // ğŸ—‘ï¸ 2. é‡ç½®èˆ‡æ¨¡æ…‹æ¡† (Reset Logic)
    // ----------------------------------------------------
    function openResetModal() { resetModal.style.display = 'flex'; }
    function closeResetModal(e) { if (e.target === resetModal) resetModal.style.display = 'none'; }
    
    function execReset(mode) {
      if (mode === 'source') { 
        source.value = ""; 
        localStorage.removeItem('fluo_draft_source');
        showToast("success", "åŸæ–‡è‰ç¨¿å·²æ¸…é™¤"); 
      }
      else if (mode === 'kw') { 
        kwListArea.value = ""; 
        localStorage.removeItem('fluo_draft_kw');
        showToast("success", "é—œéµå­—å·²æ¸…é™¤"); 
      }
      else if (mode === 'all') { 
        // å†æ¬¡ç¢ºèªæ©Ÿåˆ¶å·²åœ¨ UI æ–‡å­—å‘ˆç¾ï¼Œé€™è£¡ç›´æ¥åŸ·è¡Œ
        source.value = ""; 
        kwListArea.value = ""; 
        editor.innerHTML = "";
        localStorage.clear(); // æ¸…ç©ºæ‰€æœ‰ localStorage
        showToast("success", "ç³»çµ±å·²å®Œå…¨é‡ç½®");
        updateStatus('saved'); // é‡ç½®ç‹€æ…‹
      }
      resetModal.style.display = 'none';
      updateCounts();
    }

    // ----------------------------------------------------
    // ğŸ“‹ 3. è¤‡è£½èˆ‡æç¤º (Copy & Toast)
    // ----------------------------------------------------
    async function copyToDocs() {
      const wrapper = document.createElement('div');
      wrapper.style.cssText = `${BASE_STYLE} background-color: white;`;
      wrapper.innerHTML = editor.innerHTML;
      
      // æ·±åº¦æ¸…æ½”ï¼šç¢ºä¿æ‰€æœ‰å­å…ƒç´ éƒ½æœ‰å­—é«”
      wrapper.querySelectorAll('*').forEach(el => { 
        if(!el.style.fontFamily) el.style.fontFamily = "'Microsoft JhengHei', 'å¾®è»Ÿæ­£é»‘é«”', sans-serif"; 
      });

      const blobHtml = new Blob([wrapper.outerHTML], {type: 'text/html'});
      const blobText = new Blob([editor.innerText], {type: 'text/plain'});
      const data = [new ClipboardItem({'text/html': blobHtml, 'text/plain': blobText})];

      try { 
        await navigator.clipboard.write(data); 
        showToast("success", "è¤‡è£½æˆåŠŸï¼å¯ç›´æ¥è²¼ä¸Š"); 
      } catch (e) { 
        showToast("error", "è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½"); 
      }
    }

    function showToast(type, msg) {
      const t = document.getElementById('toast');
      const icon = document.getElementById('toastIcon');
      const txt = document.getElementById('toastMsg');
      
      if (type === 'success') {
         icon.innerHTML = `<svg class="w-5 h-5 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>`;
      } else {
         icon.innerHTML = `<svg class="w-5 h-5 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>`;
      }
      
      txt.innerText = msg;
      t.style.opacity = '1'; t.style.top = '30px';
      setTimeout(() => { t.style.opacity = '0'; t.style.top = '24px'; }, 2500);
    }

    // ----------------------------------------------------
    // ğŸ¨ 4. ç·¨è¼¯å™¨åŠŸèƒ½ (Editor Core)
    // ----------------------------------------------------
    function execCmd(cmd) { document.execCommand(cmd, false, null); updateCounts(); triggerSave(); }

    function applyStyle(type) {
      const sel = window.getSelection();
      if (!sel.rangeCount) return;
      let css = "";
      switch(type) {
        case 'h1': css = `${FONT_FAMILY} font-size: 24pt; font-weight: bold; line-height: 1.5; color: #111; display: block; margin: 24px 0 12px 0;`; break;
        case 'h2': css = `${FONT_FAMILY} font-size: 18pt; font-weight: bold; line-height: 1.5; color: #222; display: block; margin: 20px 0 10px 0;`; break;
        case 'p': css = BASE_STYLE + " display: block; margin-bottom: 12px; font-weight: normal;"; break;
        case 'red': wrapSelection(`${FONT_FAMILY} color: #B93A32; font-weight: bold;`); return;
      }
      if(['h1','h2','p'].includes(type)) wrapSelection(css);
      updateCounts();
      triggerSave();
    }

    function applyColor(hex) { wrapSelection(`${FONT_FAMILY} color: ${hex};`); }
    function applyHighlight(hex) { wrapSelection(`${FONT_FAMILY} background-color: ${hex};`); }

    function wrapSelection(styleString) {
      const sel = window.getSelection();
      if (sel.rangeCount === 0 || sel.isCollapsed) { showToast("error", "è«‹å…ˆé¸å–æ–‡å­—ç¯„åœ"); return; }
      const range = sel.getRangeAt(0);
      const span = document.createElement('span');
      span.style.cssText = styleString;
      try { range.surroundContents(span); } 
      catch(e) { document.execCommand('styleWithCSS', false, true); }
      updateCounts();
      triggerSave();
    }

    function runAutoMark() {
      const kws = kwListArea.value.split('\n').filter(k => k.trim());
      let text = source.value;
      if(!text) { showToast("error", "è«‹å…ˆè¼¸å…¥åŸæ–‡è‰ç¨¿"); return; }
      
      text = text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
      kws.forEach(kw => {
        const regex = new RegExp(`(${kw})`, 'gi');
        text = text.replace(regex, `<span style="${FONT_FAMILY} color: #B93A32; font-weight: bold;">$1</span>`);
      });
      text = text.replace(/\n/g, '<br>');
      editor.innerHTML = `<span style="${BASE_STYLE}">${text}</span>`;
      
      showToast("success", "æ¨£å¼æ³¨å…¥å®Œæˆ");
      updateCounts();
      triggerSave();
    }

    function downloadTxt() {
      const blob = new Blob([editor.innerText], {type: "text/plain"});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = `draft_${new Date().toISOString().slice(0,10)}.txt`;
      a.click();
    }

    function updateCounts() {
      const txt = editor.innerText || "";
      document.getElementById('charCount').innerText = `${txt.length} å­— (å«æ¨™é»)`;
    }

    // Header Scroll Effect
    const header = document.getElementById('mainHeader');
    document.getElementById('scrollCanvas').addEventListener('scroll', function() {
       if (this.scrollTop > 10) { 
         header.style.borderBottomColor = '#E0E0E0'; 
         header.style.backgroundColor = 'rgba(245, 244, 240, 0.98)'; 
       } else { 
         header.style.borderBottomColor = 'transparent'; 
         header.style.backgroundColor = 'rgba(245, 244, 240, 0.9)'; 
       }
    });
  </script>
</body>
</html>
