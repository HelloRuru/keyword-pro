<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">

<title>ËõçÂÖâ„Éö„É≥ PRO | SEOÊñáÊ°àÊï∏‰ΩçÂ∑•ÂÖ∑</title>
<meta name="description" content="Â∞àÁÇ∫ÂÖßÂÆπÂâµ‰ΩúËÄÖË®≠Ë®àÁöÑÊó•Á≥ªÊï∏‰ΩçÊñáÊàøÂÖ∑„ÄÇ">
<meta name="robots" content="index, follow">
<meta property="og:title" content="ËõçÂÖâ„Éö„É≥ PRO">

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#F9F8F4">
<link rel="apple-touch-icon" href="icon-192.png">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512' fill='none'><path d='M256 86C256 86 160 190 160 310C160 380 200 426 256 426C312 426 352 380 352 310C352 190 256 86 256 86Z' stroke='%232B4B65' stroke-width='24' stroke-linecap='round' stroke-linejoin='round'/><path d='M256 180V320' stroke='%232B4B65' stroke-width='24' stroke-linecap='round'/><circle cx='256' cy='370' r='24' fill='%23BF1E33'/></svg>">

<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Shippori+Mincho:wght@500;700&family=Zen+Kaku+Gothic+New:wght@300;400;500;700&display=swap" rel="stylesheet">

<script>
  document.addEventListener('contextmenu', e => {
    const isEditable = e.target.closest('textarea, input, [contenteditable="true"]');
    if (isEditable) return; 
    e.preventDefault();     
  });
  document.addEventListener('keydown', e => {
    if((e.ctrlKey && ['s','S','u','U'].includes(e.key))){ e.preventDefault(); }
  });
  if ('serviceWorker' in navigator) {
     window.addEventListener('load', () => { navigator.serviceWorker.register('./sw.js').catch(e => console.log('SW Fail')); });
  }
</script>

<style>
  :root {
    --bg-canvas: #F9F8F4; --bg-sidebar: #FFFFFF; --border-color: #E0E0E0;
    --c-ink: #333333; --c-sub: #666666; --c-accent: #2B4B65; --c-highlight: #BF1E33;
    --font-serif: 'Shippori Mincho', serif; --font-sans: 'Zen Kaku Gothic New', sans-serif; --font-editor: 'Noto Sans TC', sans-serif;
  }
  [data-theme="dark"] {
    --bg-canvas: #1A1A1A; --bg-sidebar: #242424; --border-color: #444;
    --c-ink: #E0E0E0; --c-sub: #999; --c-accent: #8AB4D6; --c-highlight: #FF6B6B;
  }

  body { background: var(--bg-canvas); color: var(--c-ink); font-family: var(--font-sans); height: 100vh; height: 100dvh; overflow: hidden; display: flex; flex-direction: column; }
  .bg-grid { position: fixed; inset: 0; background-image: linear-gradient(#E5E5E5 1px, transparent 1px), linear-gradient(90deg, #E5E5E5 1px, transparent 1px); background-size: 24px 24px; opacity: 0.5; pointer-events: none; z-index: 0; }
  [data-theme="dark"] .bg-grid { opacity: 0.08; background-image: linear-gradient(#555 1px, transparent 1px), linear-gradient(90deg, #555 1px, transparent 1px); }
  .custom-scroll::-webkit-scrollbar { width: 4px; height: 4px; }
  .custom-scroll::-webkit-scrollbar-thumb { background: #CCC; border-radius: 2px; }

  .sidebar { background: var(--bg-sidebar); border-right: 1px solid var(--border-color); display: flex; flex-direction: column; z-index: 20; box-shadow: 2px 0 15px rgba(0,0,0,0.03); }
  .input-area { width: 100%; background: var(--bg-canvas); border: 1px solid var(--border-color); border-radius: 4px; padding: 12px; font-size: 14px; font-family: var(--font-sans); resize: none; outline: none; transition: 0.2s; line-height: 1.6; }
  .input-area:focus { border-color: var(--c-accent); background: #FFF; box-shadow: 0 2px 8px rgba(43, 75, 101, 0.1); }
  .density-panel { background: var(--bg-canvas); border: 1px solid var(--border-color); border-radius: 6px; padding: 8px; margin-bottom: 10px; max-height: 120px; overflow-y: auto; display: flex; flex-wrap: wrap; gap: 6px; }
  .kw-tag { font-size: 11px; padding: 2px 8px; border-radius: 4px; background: #FFF; border: 1px solid var(--border-color); color: var(--c-sub); display: flex; align-items: center; gap: 4px; cursor: default; }
  .kw-tag .count { font-weight: 800; color: var(--c-accent); }
  .kw-tag.good { border-color: #C6F6D5; background: #F0FFF4; color: #276749; }
  .kw-tag.missing { border-color: #FECACA; background: #FFF5F5; color: #C9171E; }

  .preview-container { flex: 1; display: flex; flex-direction: column; position: relative; overflow: hidden; z-index: 10; }
  .toolbar { background: var(--bg-sidebar); border-bottom: 1px solid var(--border-color); padding: 8px 16px; display: flex; align-items: center; gap: 12px; overflow-x: auto; white-space: nowrap; z-index: 30; box-shadow: 0 2px 5px rgba(0,0,0,0.02); }
  .tool-btn { display: flex; align-items: center; justify-content: center; height: 32px; min-width: 32px; padding: 0 8px; border-radius: 4px; color: var(--c-sub); font-size: 13px; font-family: var(--font-serif); font-weight: 500; cursor: pointer; transition: 0.2s; border: 1px solid transparent; }
  .tool-btn:hover { background: var(--bg-canvas); color: var(--c-accent); border-color: var(--border-color); }
  .tool-sep { width: 1px; height: 20px; background: var(--border-color); flex-shrink: 0; }
  .color-dot { width: 18px; height: 18px; border-radius: 50%; cursor: pointer; border: 2px solid var(--bg-sidebar); box-shadow: 0 0 0 1px var(--border-color); flex-shrink: 0; transition: transform 0.1s; display: flex; align-items: center; justify-content: center; }
  .color-dot:active { transform: scale(0.9); }
  .color-none { border: 1px solid #CCC; background: transparent; }
  .color-none svg { width: 10px; height: 10px; color: #999; }

  .editor-paper { width: 100%; max-width: 800px; min-height: calc(100vh - 140px); margin: 0 auto; background: var(--bg-sidebar); padding: 60px 80px; outline: none; font-family: var(--font-editor); font-size: 12pt; line-height: 1.6; color: var(--c-ink); text-align: justify; box-shadow: 0 0 40px rgba(0,0,0,0.03); }
  .editor-paper h2 { font-family: var(--font-serif); font-size: 18pt; font-weight: 700; color: var(--c-accent); border-bottom: 1px solid #DDD; padding-bottom: 6px; margin: 24px 0 12px 0; display: block; line-height: 1.4; }
  .editor-paper h3 { font-family: var(--font-serif); font-size: 14pt; font-weight: 700; color: var(--c-ink); border-left: 4px solid var(--c-highlight); padding-left: 10px; margin: 18px 0 10px 0; display: block; line-height: 1.4; }
  .editor-paper p { margin-bottom: 12pt; display: block; }
  .highlight-pulse { background-color: rgba(255, 255, 0, 0.4); box-shadow: 0 0 8px rgba(255, 255, 0, 0.6); }
  .stats-bar { background: var(--bg-sidebar); border-top: 1px solid var(--border-color); padding: 8px 20px; font-size: 11px; color: var(--c-sub); display: flex; justify-content: space-between; align-items: center; }
  .floating-menu { position: fixed; z-index: 999; background: var(--bg-sidebar); border: 1px solid var(--border-color); border-radius: 50px; padding: 6px 12px; display: flex; gap: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.15); opacity: 0; pointer-events: none; transform: translateY(10px); transition: 0.2s; }
  .floating-menu.show { opacity: 1; pointer-events: auto; transform: translateY(0); }

  @media (max-width: 768px) {
    .sidebar { display: none; width: 100% !important; border-right: none; }
    .editor-paper { padding: 20px 16px; width: 100%; box-shadow: none; min-height: calc(100dvh - 150px); }
    .mobile-tab-bar { display: flex; }
    .toolbar { padding: 8px 10px; overflow-x: auto; -webkit-overflow-scrolling: touch; }
    .mobile-active-page { display: flex !important; flex-direction: column; height: calc(100dvh - 48px - 50px); overflow: hidden; }
    .mobile-scroll-area { flex: 1; overflow-y: auto; -webkit-overflow-scrolling: touch; padding-bottom: 20px; }
  }
  .mobile-tab-bar { position: fixed; bottom: 0; left: 0; right: 0; height: 50px; background: var(--bg-sidebar); border-top: 1px solid var(--border-color); z-index: 50; justify-content: space-around; align-items: center; display: none; padding-bottom: env(safe-area-inset-bottom); }
  .tab-btn { flex: 1; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 10px; color: var(--c-sub); font-family: var(--font-serif); }
  .tab-btn.active { color: var(--c-highlight); font-weight: bold; background: rgba(0,0,0,0.02); }
</style>
</head>
<body>
  <div class="bg-grid"></div>

  <header class="h-12 md:hidden flex items-center justify-between px-4 bg-[var(--bg-sidebar)] border-b border-[var(--border-color)] sticky top-0 z-40 shrink-0">
    <div class="flex items-center gap-2 font-serif text-[var(--c-ink)]">
      <svg class="w-5 h-5" viewBox="0 0 512 512" fill="none" stroke="currentColor" stroke-width="20"><path d="M256 86C256 86 160 190 160 310C160 380 200 426 256 426C312 426 352 380 352 310C352 190 256 86 256 86Z" stroke='%23333' stroke-width='24' stroke-linecap='round' stroke-linejoin='round'/><path d='M256 180V320' stroke='%23333' stroke-width='24' stroke-linecap='round'/><circle cx='256' cy='370' r='24' fill='%23BF1E33'/></svg>
      <span>ËõçÂÖâ„Éö„É≥</span>
    </div>
    <button onclick="App.UI.toggleTheme()"><svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg></button>
  </header>

  <div id="mobileFloatMenu" class="floating-menu">
     <div onmousedown="event.preventDefault()" onclick="App.Format.removeHighlight()" class="color-dot color-none" title="ÁßªÈô§Ëû¢ÂÖâ"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg></div>
     <div onmousedown="event.preventDefault()" onclick="App.Format.highlight('#F0DC70')" class="color-dot bg-[#F0DC70]"></div>
     <div class="w-[1px] h-4 bg-gray-200"></div>
     <div onmousedown="event.preventDefault()" onclick="App.Format.removeColor()" class="color-dot color-none" title="ÈáçÁΩÆÊñáÂ≠óËâ≤"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg></div>
     <div onmousedown="event.preventDefault()" onclick="App.Format.color('#BF1E33')" class="color-dot bg-[#BF1E33]"></div>
     <div class="w-[1px] h-4 bg-gray-200"></div>
     <button onmousedown="event.preventDefault()" onclick="App.Format.remove()" class="text-gray-500"><svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg></button>
  </div>

  <div class="flex-1 flex overflow-hidden relative">
    <aside id="tabInput" class="sidebar w-full md:w-[320px] lg:w-[360px] custom-scroll overflow-y-auto p-5 hidden md:flex flex-col h-full mobile-active-page">
      <div class="mobile-scroll-area flex flex-col gap-4 h-full">
          <div class="flex items-center justify-between mb-2">
            <div class="flex items-center gap-3">
              <svg class="w-8 h-8 text-[var(--c-accent)] hidden md:block" viewBox="0 0 512 512" fill="none" stroke="currentColor" stroke-width="20"><path d="M256 86C256 86 160 190 160 310C160 380 200 426 256 426C312 426 352 380 352 310C352 190 256 86 256 86Z" stroke='currentColor' stroke-width='24' stroke-linecap='round' stroke-linejoin='round'/><path d='M256 180V320' stroke='currentColor' stroke-width='24' stroke-linecap='round'/><circle cx='256' cy='370' r='24' fill='%23BF1E33'/></svg>
              <div class="hidden md:block">
                <h1 class="text-lg font-bold font-serif">ËõçÂÖâ„Éö„É≥ <span class="text-xs text-[var(--c-highlight)] font-sans">PRO</span></h1>
                <p class="text-[9px] tracking-widest opacity-60">DIGITAL STATIONERY v6.9</p>
              </div>
            </div>
            <button onclick="App.UI.toggleTheme()" class="text-[var(--c-sub)] hover:text-[var(--c-accent)] hidden md:block" title="ÂàáÊèõÊ∑±Ëâ≤Ê®°Âºè">
               <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
            </button>
          </div>

          <div>
            <div class="flex justify-between items-baseline mb-2">
              <h3 class="font-serif font-bold text-sm border-l-4 border-[var(--c-accent)] pl-2">ÂéüÊñáËº∏ÂÖ•</h3>
              <button onclick="App.Core.restore()" class="text-[10px] text-blue-500 hover:underline font-serif">ÈÇÑÂéü</button>
            </div>
            <textarea id="sourceText" class="input-area h-48" placeholder="Âú®Ê≠§Ë≤º‰∏äÊñáÁ´†..."></textarea>
          </div>

          <div>
            <h3 class="font-serif font-bold text-sm border-l-4 border-[var(--c-highlight)] pl-2 mb-2">SEO ÈóúÈçµÂ≠ó</h3>
            <textarea id="kwList" class="input-area h-20 mb-2" placeholder="ÈóúÈçµÂ≠ó (‰∏ÄË°å‰∏ÄÂÄã)"></textarea>
            <div id="densityPanel" class="density-panel custom-scroll">
               <span class="text-xs text-gray-400 w-full text-center py-2">Á≠âÂæÖËº∏ÂÖ•...</span>
            </div>
          </div>

          <div class="mt-4 space-y-3 pb-8">
            <button onclick="App.Core.smartHighlight()" class="w-full py-3 bg-[var(--c-highlight)] text-white font-bold rounded shadow-md hover:opacity-90 transition text-sm font-serif tracking-wide">
              ‚ü≥ ‰∏ÄÈçµÊ®ôË®ª (Sync & Check)
            </button>
            
            <button onclick="App.Core.copyToDocs()" class="w-full py-2 border border-[var(--c-accent)] text-[var(--c-accent)] rounded hover:bg-blue-50 transition text-sm flex justify-center items-center gap-2 font-serif">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"/></svg>
              Ë§áË£ΩÂà∞ Docs (Ê†ºÂºèÈéñÂÆö)
            </button>
            
            <div class="grid grid-cols-2 gap-2 pt-2 border-t border-[var(--border-color)]">
               <button onclick="App.Storage.clear('source')" class="py-1 text-xs text-gray-500 border border-gray-200 rounded hover:text-red-500 font-serif">Ê∏ÖÁ©∫ÂéüÊñá</button>
               <button onclick="App.Storage.clear('kw')" class="py-1 text-xs text-gray-500 border border-gray-200 rounded hover:text-red-500 font-serif">Ê∏ÖÁ©∫ÈóúÈçµÂ≠ó</button>
               <button onclick="App.Storage.download('html')" class="py-1 text-xs text-[var(--c-accent)] border border-[var(--c-accent)] rounded hover:bg-blue-50 font-serif">ÂÇô‰ªΩ HTML</button>
               <button onclick="App.Storage.download('doc')" class="py-1 text-xs text-[var(--c-accent)] border border-[var(--c-accent)] rounded hover:bg-blue-50 font-serif">ÂÇô‰ªΩ Word</button>
               <button onclick="App.Storage.clear('all')" class="col-span-2 py-2 text-xs text-white bg-gray-400 rounded hover:bg-red-500 font-serif">ÂÖ®ÈÉ®ÈáçÁΩÆ (Âç±Èö™)</button>
            </div>
            <p class="text-[9px] text-center text-gray-300 mt-2 font-serif">Production by Kaoru Tsai ¬© 2025</p>
          </div>
      </div>
    </aside>

    <main id="tabPreview" class="preview-container w-full h-full">
      <div class="toolbar custom-scroll shrink-0">
        <button onmousedown="event.preventDefault()" onclick="document.execCommand('undo')" class="tool-btn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M3 7v6h6"/><path d="M21 17a9 9 0 00-9-9 9 9 0 00-6 2.3L3 13"/></svg></button>
        <button onmousedown="event.preventDefault()" onclick="document.execCommand('redo')" class="tool-btn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M21 7v6h-6"/><path d="M3 17a9 9 0 019-9 9 9 0 016 2.3l6 3.7"/></svg></button>
        <div class="tool-sep"></div>
        <button onmousedown="event.preventDefault()" onclick="document.execCommand('bold')" class="tool-btn font-serif font-bold text-lg" title="Á≤óÈ´î">B</button>
        <button onmousedown="event.preventDefault()" onclick="document.execCommand('italic')" class="tool-btn font-serif italic text-lg" title="ÊñúÈ´î">I</button>
        <button onmousedown="event.preventDefault()" onclick="document.execCommand('underline')" class="tool-btn font-serif underline text-lg" title="Â∫ïÁ∑ö">U</button>
        <div class="tool-sep"></div>
        <button onmousedown="event.preventDefault()" onclick="App.Format.cmd('formatBlock','h2')" class="tool-btn font-bold text-lg font-serif">H2</button>
        <button onmousedown="event.preventDefault()" onclick="App.Format.cmd('formatBlock','h3')" class="tool-btn font-bold text-base font-serif">H3</button>
        <button onmousedown="event.preventDefault()" onclick="App.Format.cmd('formatBlock','p')" class="tool-btn font-serif">P</button>
        <div class="tool-sep"></div>
        <div class="flex items-center gap-1">
            <button onmousedown="event.preventDefault()" onclick="App.Format.stepSize(-1)" class="tool-btn font-serif text-sm px-1" title="Á∏ÆÂ∞èÂ≠óÁ¥ö">A-</button>
            <select id="fontSizeSelect" onchange="App.Format.setSize(this.value)" class="h-8 border border-[var(--border-color)] rounded text-xs bg-[var(--bg-sidebar)] px-1 outline-none font-sans w-12 text-center">
              <option value="10pt">10</option><option value="11pt">11</option><option value="12pt" selected>12</option>
              <option value="13pt">13</option><option value="14pt">14</option><option value="15pt">15</option>
              <option value="16pt">16</option><option value="18pt">18</option><option value="20pt">20</option>
              <option value="24pt">24</option><option value="30pt">30</option><option value="36pt">36</option>
              <option value="48pt">48</option>
            </select>
            <button onmousedown="event.preventDefault()" onclick="App.Format.stepSize(1)" class="tool-btn font-serif text-lg px-1" title="ÊîæÂ§ßÂ≠óÁ¥ö">A+</button>
        </div>
        <div class="tool-sep"></div>
        <div class="flex gap-2 px-1">
          <div onmousedown="event.preventDefault()" onclick="App.Format.removeColor()" class="color-dot color-none" title="ÈáçÁΩÆÊñáÂ≠óÈ°èËâ≤"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg></div>
          <div onmousedown="event.preventDefault()" onclick="App.Format.color('#333333')" class="color-dot bg-[#333333]" title="Â¢®Ëâ≤"></div>
          <div onmousedown="event.preventDefault()" onclick="App.Format.color('#2B4B65')" class="color-dot bg-[#2B4B65]" title="ËóçÈâÑ"></div>
          <div onmousedown="event.preventDefault()" onclick="App.Format.color('#BF1E33')" class="color-dot bg-[#BF1E33]" title="ËåúËâ≤"></div>
          <div onmousedown="event.preventDefault()" onclick="App.Format.color('#2F5D50')" class="color-dot bg-[#2F5D50]" title="ÂçÉÊ≠≤Á∂†"></div>
          <div onmousedown="event.preventDefault()" onclick="App.Format.color('#6A4C9C')" class="color-dot bg-[#6A4C9C]" title="‰∫¨Á¥´"></div>
        </div>
        <div class="tool-sep"></div>
        <div class="flex gap-2 px-1">
          <div onmousedown="event.preventDefault()" onclick="App.Format.removeHighlight()" class="color-dot color-none" title="ÁßªÈô§Ëû¢ÂÖâÁ≠Ü"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg></div>
          <div onmousedown="event.preventDefault()" onclick="App.Format.highlight('#F0DC70')" class="color-dot bg-[#F0DC70]" title="ÂààÂÆâ"></div>
          <div onmousedown="event.preventDefault()" onclick="App.Format.highlight('#F5B199')" class="color-dot bg-[#F5B199]" title="Ê°ÉËâ≤"></div>
          <div onmousedown="event.preventDefault()" onclick="App.Format.highlight('#A0D8EF')" class="color-dot bg-[#A0D8EF]" title="Á©∫Ëâ≤"></div>
          <div onmousedown="event.preventDefault()" onclick="App.Format.highlight('#C6Eac5')" class="color-dot bg-[#C6Eac5]" title="ËñÑÁ∂†"></div>
          <div onmousedown="event.preventDefault()" onclick="App.Format.highlight('#E0C8F2')" class="color-dot bg-[#E0C8F2]" title="Ëó§Ëâ≤"></div>
        </div>
        <div class="tool-sep"></div>
        <button onmousedown="event.preventDefault()" onclick="App.Format.remove()" class="tool-btn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M18 6L6 18M6 6l12 12"/></svg></button>
      </div>

      <div class="mobile-scroll-area editor-container custom-scroll">
        <div id="editor" contenteditable="true" class="editor-paper shadow-lg" spellcheck="false" placeholder="Á≠âÂæÖÂêåÊ≠•..."></div>
      </div>

      <div class="stats-bar shrink-0">
        <div class="flex gap-4">
          <span id="saveStatus" class="text-[var(--c-highlight)] font-bold opacity-0 transition-opacity">Â∑≤ÂÑ≤Â≠ò</span>
          <span>Â≠óÊï∏: <b id="countTotal">0</b></span>
          <span id="selCountGroup" class="opacity-50">ÈÅ∏Âèñ: <b id="countSel">0</b></span>
        </div>
        <button id="btnPunc" onclick="App.UI.togglePunctuation()" class="flex items-center gap-1 text-xs px-2 py-1 rounded border hover:bg-gray-100">
          <span class="w-2 h-2 rounded-full bg-green-500" id="puncDot"></span> Âê´Ê®ôÈªû
        </button>
      </div>
    </main>
  </div>

  <nav class="mobile-tab-bar">
    <button onclick="App.UI.switchMobileTab('input')" class="tab-btn active" id="tabBtnInput">Á∑®ËºØ‰æÜÊ∫ê</button>
    <button onclick="App.UI.switchMobileTab('preview')" class="tab-btn" id="tabBtnPreview">Âç≥ÊôÇÈ†êË¶Ω</button>
  </nav>

  <script>
    const Config = {
        colors: {
            '#333333': '#333333', '#2B4B65': '#2B4B65', '#BF1E33': '#BF1E33', 
            '#2F5D50': '#2F5D50', '#6A4C9C': '#6A4C9C', 
            'var(--c-ink)': '#333333', 'var(--c-accent)': '#2B4B65', 'var(--c-highlight)': '#BF1E33' 
        },
        fontScale: [10, 11, 12, 13, 14, 15, 16, 18, 20, 24, 30, 36, 48]
    };

    const App = {
        state: { isAutoSync: true, includePunctuation: true },
        
        Storage: {
            save: (key, val) => {
                localStorage.setItem(key, val);
                App.UI.showSaved();
            },
            get: (key) => localStorage.getItem(key),
            clear: (type) => { 
                if(!confirm('Á¢∫ÂÆöÊ∏ÖÈô§ÔºüÊ≠§Âãï‰ΩúÁÑ°Ê≥ïÂæ©Âéü„ÄÇ')) return;
                if(type === 'source') { document.getElementById('sourceText').value = ''; App.Storage.save('fluo_src', ''); }
                if(type === 'kw') { document.getElementById('kwList').value = ''; App.Storage.save('fluo_kw', ''); }
                if(type === 'all') { 
                    document.getElementById('sourceText').value = '';
                    document.getElementById('kwList').value = '';
                    document.getElementById('editor').innerHTML = '';
                    localStorage.clear();
                }
                App.Core.runSync(); // Reset
            },
            download: (format) => { 
                const content = document.getElementById('editor').innerHTML;
                const style = `
                    body { font-family: 'Shippori Mincho', 'Zen Kaku Gothic New', sans-serif; max-width: 800px; margin: 20px auto; padding: 40px; color: #333; line-height: 1.6; }
                    h2 { font-size: 18pt; color: #2B4B65; border-bottom: 1px solid #DDD; padding-bottom: 6px; margin: 24px 0 12px 0; }
                    h3 { font-size: 14pt; color: #333; border-left: 4px solid #BF1E33; padding-left: 10px; margin: 18px 0 10px 0; }
                    p { margin-bottom: 12pt; }
                `;
                const fullHtml = `
                    <html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'>
                    <head><meta charset='utf-8'><title>Backup</title><style>${style}</style></head>
                    <body>${content}</body></html>`;
                const blob = new Blob([fullHtml], { type: format === 'doc' ? 'application/msword' : 'text/html' });
                const a = document.createElement('a');
                a.href = URL.createObjectURL(blob);
                a.download = `fluo_backup_${new Date().toISOString().slice(0,10)}.${format}`;
                document.body.appendChild(a); a.click(); document.body.removeChild(a);
            }
        },

        Init: () => {
            App.Dom = { 
                source: document.getElementById('sourceText'), kw: document.getElementById('kwList'), 
                editor: document.getElementById('editor'), density: document.getElementById('densityPanel'), 
                countTotal: document.getElementById('countTotal'), countSel: document.getElementById('countSel'), 
                puncDot: document.getElementById('puncDot'), saveStatus: document.getElementById('saveStatus'),
                fontSelect: document.getElementById('fontSizeSelect')
            };

            if(localStorage.getItem('fluo_theme') === 'dark') document.body.setAttribute('data-theme', 'dark');
            if(App.Storage.get('fluo_src')) App.Dom.source.value = App.Storage.get('fluo_src');
            if(App.Storage.get('fluo_kw')) App.Dom.kw.value = App.Storage.get('fluo_kw');
            // ÂàùÊ¨°ËºâÂÖ•ÊôÇÔºåËã• Editor ÊúâÂÇô‰ªΩÂâáÂÑ™ÂÖà‰ΩøÁî®ÔºåÂê¶Ââá Sync
            const savedHtml = App.Storage.get('fluo_temp');
            if(savedHtml && savedHtml.trim().length > 0) {
                App.Dom.editor.innerHTML = savedHtml;
                App.state.isAutoSync = false;
                App.Core.analyzeDensity();
            } else {
                App.Core.runSync();
            }

            App.Dom.source.addEventListener('input', () => { App.state.isAutoSync=true; App.Core.runSync(); });
            App.Dom.kw.addEventListener('input', () => { /* KW changes don't overwrite editor instantly, waiting for sync */ App.Core.analyzeDensity(); App.Storage.save('fluo_kw', App.Dom.kw.value); });
            App.Dom.editor.addEventListener('input', () => { 
                App.state.isAutoSync=false; 
                App.UI.updateStats(); 
                App.Storage.save('fluo_temp', App.Dom.editor.innerHTML); 
            });
            
            document.addEventListener('selectionchange', () => {
                App.UI.updateStats();
                const sel = window.getSelection();
                if(sel.rangeCount > 0 && !sel.isCollapsed) {
                    let parent = sel.anchorNode.parentElement;
                    if(parent.tagName !== 'SPAN') parent = parent.closest('span');
                    if(parent && parent.style.fontSize) {
                        App.Dom.fontSelect.value = parent.style.fontSize;
                    }
                }
            });
        },

        Core: {
            runSync: () => {
                if(!App.state.isAutoSync) return;
                const raw = App.Dom.source.value;
                const safeText = raw.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
                // ÂéüÂßãÂêåÊ≠•ÔºöÁõ¥Êé•Ë¶ÜËìã (ÂÉÖÂú®ÂâõÈñãÂßãÊàñ Source Â§ßÊîπÊôÇËß∏Áôº)
                const html = safeText.split('\n').map(line => line.trim() ? `<p>${line}</p>` : '<p><br></p>').join('');
                App.Dom.editor.innerHTML = html || '<p class="text-gray-300">Ë´ãÂú®Â∑¶ÂÅ¥Ëº∏ÂÖ•ÊñáÂ≠ó...</p>';
                App.Core.smartHighlight(); // Sync ÂæåËá™ÂãïÈ´ò‰∫Æ
                App.Storage.save('fluo_src', raw);
            },
            analyzeDensity: () => {
                const text = App.Dom.source.value;
                const kws = App.Dom.kw.value.split('\n').filter(k => k.trim());
                if(kws.length === 0) { App.Dom.density.innerHTML = '<span class="text-xs text-gray-400 w-full text-center py-2">ÁÑ°ÈóúÈçµÂ≠ó</span>'; return; }
                let html = '';
                kws.forEach(kw => {
                    const count = (text.match(new RegExp(kw, 'gi')) || []).length;
                    const density = (text.length > 0) ? ((count * kw.length / text.length) * 100).toFixed(1) : 0;
                    let cls = count === 0 ? 'missing' : (density > 0.5 && density < 5 ? 'good' : '');
                    html += `<div class="kw-tag ${cls}">${kw} <span class="count">${count}</span> <span style="opacity:0.6">(${density}%)</span></div>`;
                });
                App.Dom.density.innerHTML = html;
            },
            
            // üü¢ Êô∫ÊÖßÊ®ôË®ª (ÈùûÁ†¥Â£ûÊÄß)
            smartHighlight: () => {
                const editor = App.Dom.editor;
                const kws = App.Dom.kw.value.split('\n').filter(k => k.trim());
                
                // 1. Ê∏ÖÈô§ËàäÁöÑËá™ÂãïÊ®ôË®ª (‰øùÁïô class="fluo-auto")
                const oldMarks = editor.querySelectorAll('b[data-auto="true"]');
                oldMarks.forEach(mark => {
                    const parent = mark.parentNode;
                    while(mark.firstChild) parent.insertBefore(mark.firstChild, mark);
                    parent.removeChild(mark);
                });
                editor.normalize(); // Âêà‰ΩµÊñ∑Ë£ÇÁöÑÊñáÂ≠óÁØÄÈªû

                if(kws.length === 0) { App.UI.updateStats(); return; }

                // 2. ÈÅûËø¥ÊêúÂ∞ãÊñáÂ≠óÁØÄÈªû‰∏¶Ê®ôË®ª
                const walk = (node) => {
                    if (node.nodeType === 3) { // Text Node
                        const text = node.nodeValue;
                        // Á∞°ÂñÆÈÖçÂ∞çÔºöÊâæÁ¨¨‰∏ÄÂÄãÁ¨¶ÂêàÁöÑÈóúÈçµÂ≠ó
                        // (ÁÇ∫‰∫ÜÊïàËÉΩËàáÈÅøÂÖçÂ∑¢ÁãÄËø¥ÂúàÔºå‰∏ÄÊ¨°ËôïÁêÜ‰∏ÄÂÄãÊúÄÂÑ™ÂÖàÁöÑÈóúÈçµÂ≠óÔºåÈÅûËø¥ËôïÁêÜÂâ©È§òÈÉ®ÂàÜ)
                        kws.sort((a,b) => b.length - a.length); // Èï∑Ë©ûÂÑ™ÂÖà
                        let match = null, matchKw = '';
                        
                        for (let kw of kws) {
                            const idx = text.toLowerCase().indexOf(kw.toLowerCase());
                            if (idx !== -1) {
                                match = { idx, len: kw.length };
                                matchKw = text.substr(idx, kw.length);
                                break; 
                            }
                        }

                        if (match) {
                            const after = node.splitText(match.idx + match.len);
                            const middle = node.splitText(match.idx);
                            
                            const b = document.createElement('b');
                            b.setAttribute('data-auto', 'true');
                            b.style.color = '#BF1E33'; // Á¥ÖËâ≤Á≥ª
                            b.textContent = middle.nodeValue;
                            
                            middle.parentNode.replaceChild(b, middle);
                            
                            walk(after); // ÁπºÁ∫åËôïÁêÜÂæåÈù¢ÁöÑÊñáÂ≠ó
                        }
                    } else if (node.nodeType === 1 && node.childNodes && !['SCRIPT','STYLE'].includes(node.tagName)) {
                        Array.from(node.childNodes).forEach(walk);
                    }
                };
                
                walk(editor);
                App.Core.analyzeDensity(); // Êõ¥Êñ∞ÂØÜÂ∫¶Ë°®
                App.UI.updateStats();
                App.Storage.save('fluo_temp', editor.innerHTML);
            },

            restore: () => { if(confirm('Â∞áÈ†êË¶ΩÂçÄÂÖßÂÆπÈÇÑÂéüÂà∞Ëº∏ÂÖ•Ê°ÜÔºü')) { App.Dom.source.value = App.Dom.editor.innerText; App.state.isAutoSync=true; App.Core.runSync(); }},
            copyToDocs: async () => {
                const wrapper = document.createElement('div');
                wrapper.style.cssText = "font-family: 'Noto Sans TC', sans-serif; font-size: 12pt; line-height: 1.0; color: #333; background: white;";
                const clone = App.Dom.editor.cloneNode(true);
                const bakeStyles = (node) => {
                    if (node.nodeType === 1) { 
                        if (node.style.color && node.style.color.includes('var(')) {
                            const varName = node.style.color.match(/var\(([^)]+)\)/)[1];
                            if (Config.colors[varName]) node.style.color = Config.colors[varName];
                        }
                        node.style.lineHeight = "1.0"; node.style.marginBottom = "12pt"; 
                        if(node.tagName === 'H2') { node.style.fontSize="18pt"; node.style.color="#2B4B65"; node.style.lineHeight="1.2"; node.style.borderBottom="1px solid #DDD"; }
                        if(node.tagName === 'H3') { node.style.fontSize="14pt"; node.style.color="#333"; node.style.lineHeight="1.2"; node.style.borderLeft="4px solid #BF1E33"; node.style.paddingLeft="8px"; }
                    }
                    node.childNodes.forEach(bakeStyles);
                };
                bakeStyles(clone);
                wrapper.innerHTML = clone.innerHTML;
                try {
                    await navigator.clipboard.write([new ClipboardItem({'text/html': new Blob([wrapper.outerHTML],{type:'text/html'}), 'text/plain': new Blob([App.Dom.editor.innerText],{type:'text/plain'})})]);
                    alert('‚ú® Â∑≤Ë§áË£ΩÔºÅ(Docs Ê†ºÂºèÈéñÂÆö)');
                } catch(e) { alert('Ë§áË£ΩÂ§±ÊïóÔºåË´ãÊâãÂãïÂÖ®ÈÅ∏Ë§áË£Ω„ÄÇ'); }
            },
            forceSync: () => { 
                // Êåâ‰∏ãÊåâÈàïÊôÇÔºå‰∏çÂÜçÊö¥ÂäõË¶ÜËìãÔºåËÄåÊòØÂü∑Ë°åÊô∫ÊÖßÊ®ôË®ª
                App.Core.smartHighlight(); 
            }
        },

        Format: {
            cmd: (c, v) => { document.execCommand(c, false, v); App.state.isAutoSync=false; App.UI.updateStats(); },
            setSize: (pt) => {
               const sel = window.getSelection();
               if (sel.isCollapsed) return alert('Ë´ãÂÖàÈÅ∏ÂèñÊñáÂ≠ó');
               document.execCommand('fontSize', false, '7');
               const fonts = App.Dom.editor.querySelectorAll('font[size="7"]');
               fonts.forEach(el => { el.removeAttribute('size'); el.style.fontSize = pt; });
               App.state.isAutoSync=false;
            },
            stepSize: (step) => {
                const sel = window.getSelection();
                if (sel.isCollapsed) return alert('Ë´ãÂÖàÈÅ∏ÂèñÊñáÂ≠ó');
                let currentPt = 12;
                if(sel.anchorNode.parentElement.tagName === 'SPAN' && sel.anchorNode.parentElement.style.fontSize) {
                    currentPt = parseInt(sel.anchorNode.parentElement.style.fontSize);
                }
                let idx = Config.fontScale.findIndex(s => s >= currentPt);
                if (idx === -1) idx = 2;
                let newIdx = idx + step;
                if(newIdx < 0) newIdx = 0;
                if(newIdx >= Config.fontScale.length) newIdx = Config.fontScale.length - 1;
                const newSize = Config.fontScale[newIdx] + 'pt';
                App.Format.setSize(newSize);
                App.Dom.fontSelect.value = newSize;
            },
            color: (c) => App.Format.cmd('foreColor', c),
            highlight: (c) => { document.execCommand('hiliteColor', false, c) || document.execCommand('backColor', false, c); App.state.isAutoSync=false; },
            removeColor: () => { document.execCommand('foreColor', false, '#333333'); App.state.isAutoSync=false; },
            removeHighlight: () => { document.execCommand('backColor', false, 'transparent'); App.state.isAutoSync=false; },
            remove: () => { App.Format.cmd('removeFormat'); App.Format.cmd('backColor', 'transparent'); }
        },

        UI: {
            updateStats: () => {
                const text = App.Dom.editor.innerText || '';
                const clean = App.state.includePunctuation ? text : text.replace(/[^\w\u4e00-\u9fa5]/g, '');
                App.Dom.countTotal.innerText = clean.replace(/[\n\r]/g, '').length;
                const sel = window.getSelection().toString();
                App.Dom.countSel.innerText = App.state.includePunctuation ? sel.length : sel.replace(/[^\w\u4e00-\u9fa5]/g, '').length;
                
                const floatMenu = document.getElementById('mobileFloatMenu');
                if(window.innerWidth < 768 && sel.length > 0) {
                    floatMenu.classList.add('show');
                    const rect = window.getSelection().getRangeAt(0).getBoundingClientRect();
                    floatMenu.style.top = `${Math.max(10, rect.top - 60)}px`;
                    floatMenu.style.left = `${Math.max(10, rect.left)}px`;
                } else {
                    floatMenu.classList.remove('show');
                }
            },
            showSaved: () => {
                App.Dom.saveStatus.style.opacity = '1';
                setTimeout(() => { App.Dom.saveStatus.style.opacity = '0'; }, 1500);
            },
            togglePunctuation: () => {
                App.state.includePunctuation = !App.state.includePunctuation;
                App.Dom.puncDot.className = App.state.includePunctuation ? "w-2 h-2 rounded-full bg-green-500" : "w-2 h-2 rounded-full bg-gray-300";
                App.UI.updateStats();
            },
            switchMobileTab: (tab) => {
                const input = document.getElementById('tabInput');
                const preview = document.getElementById('tabPreview');
                const btnInput = document.getElementById('tabBtnInput');
                const btnPreview = document.getElementById('tabBtnPreview');
                if(tab==='input'){ 
                    input.classList.remove('hidden'); input.classList.add('flex'); 
                    preview.classList.remove('flex'); preview.classList.add('hidden'); 
                    btnInput.classList.add('active'); btnPreview.classList.remove('active'); 
                } else { 
                    input.classList.remove('flex'); input.classList.add('hidden'); 
                    preview.classList.remove('hidden'); preview.classList.add('flex'); 
                    btnInput.classList.remove('active'); btnPreview.classList.add('active'); 
                }
            },
            toggleTheme: () => {
               const isDark = document.body.getAttribute('data-theme') === 'dark';
               document.body.setAttribute('data-theme', isDark ? 'light' : 'dark');
               localStorage.setItem('fluo_theme', isDark ? 'light' : 'dark');
            }
        }
    };
    
    window.App = App;
    document.addEventListener('DOMContentLoaded', App.Init);
  </script>
</body>
</html>
