<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>è›å…‰ãƒšãƒ³ PRO - SEOæ–‡æ¡ˆæ•¸ä½å·¥å…·</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>âœ’ï¸</text></svg>">
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Shippori+Mincho:wght@500;700;900&family=Zen+Kaku+Gothic+New:wght@300;400;500;700&display=swap" rel="stylesheet">

<style>
  /* --- ğŸŸ¢ è‰²ç¥¨ç³»çµ± (Wairo Palette) --- */
  :root {
    --bg-canvas: #F9F8F4; /* ç”Ÿæˆè‰²ï¼šæ›´åŠ æº«æ½¤çš„ç´™åº•è‰² */
    --bg-sidebar: #FFFFFF;
    
    /* æ–‡å­— */
    --color-ink: #303133;  /* å¢¨è‰² */
    --color-sub: #595857;  /* é‰›è‰² */
    
    /* é‡é» */
    --color-accent: #BF1E33; /* çœŸç´… (Shinku) - æ›´å¯¦å¿ƒçš„ç´… */
    --color-focus: #2B4B65;  /* è—é‰„ */
    
    /* è¢å…‰ç­† */
    --hl-yellow: #F0DC70; /* åˆˆå®‰ */
    --hl-pink: #F5B199;   /* ä¸€æ–¤æŸ“ */

    /* ç´‹ç† */
    --noise: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.03'/%3E%3C/svg%3E");
  }

  /* --- åŸºç¤é‡ç½® --- */
  body {
    background-color: var(--bg-canvas);
    color: var(--color-ink);
    font-family: 'Zen Kaku Gothic New', sans-serif;
    height: 100vh; overflow: hidden; display: flex; flex-direction: column;
  }
  .bg-noise { position: fixed; inset: 0; background-image: var(--noise); pointer-events: none; z-index: -1; }
  .font-serif { font-family: 'Shippori Mincho', serif; }
  
  /* è‡ªå®šç¾©æ²è»¸ */
  .custom-scroll::-webkit-scrollbar { width: 6px; }
  .custom-scroll::-webkit-scrollbar-track { background: transparent; }
  .custom-scroll::-webkit-scrollbar-thumb { background: #E0E0E0; border-radius: 3px; }
  .custom-scroll::-webkit-scrollbar-thumb:hover { background: #CCC; }

  /* --- å·¦å´ï¼šè¼¸å…¥å€ (Sidebar) --- */
  .sidebar-container {
    background: var(--bg-sidebar); border-right: 1px solid #EBEBEB;
    display: flex; flex-direction: column; z-index: 20;
    box-shadow: 2px 0 10px rgba(0,0,0,0.02);
  }

  /* æ¨™é¡Œæ¨£å¼å‡ç´šï¼šæ—¥å¼å·¦å´è‰²å¡Š */
  .section-title {
    font-family: 'Shippori Mincho', serif; font-weight: 800; color: var(--color-ink);
    font-size: 1rem; letter-spacing: 0.05em; margin-bottom: 0.8rem;
    display: flex; align-items: center; gap: 8px;
    position: relative; padding-left: 12px;
  }
  .section-title::before {
    content: ''; position: absolute; left: 0; top: 10%; bottom: 10%;
    width: 4px; background: var(--color-focus); border-radius: 2px;
  }
  /* é—œéµå­—å€å¡Šçš„æ¨™é¡Œè‰²æ¢æ›è‰² */
  .section-title.accent::before { background: var(--color-accent); }

  .input-field {
    width: 100%; background: #FAFAFA;
    border: 1px solid #EEE; border-radius: 6px;
    padding: 14px; font-size: 14px; color: var(--color-ink); line-height: 1.7;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); resize: none; outline: none;
    font-family: 'Zen Kaku Gothic New', sans-serif;
  }
  .input-field:focus { 
    background: #FFF; border-color: var(--color-focus); 
    box-shadow: 0 4px 12px rgba(43, 75, 101, 0.08); 
  }

  /* --- é—œéµå­—å¯†åº¦é¢æ¿ (New Feature) --- */
  .density-panel {
    background: #F8F9FA; border: 1px solid #EEE; border-radius: 6px;
    padding: 10px; margin-bottom: 15px; max-height: 120px; overflow-y: auto;
    display: flex; flex-wrap: wrap; gap: 6px;
  }
  .kw-tag {
    font-size: 11px; padding: 3px 8px; border-radius: 4px;
    background: white; border: 1px solid #E0E0E0; color: #666;
    display: flex; align-items: center; gap: 4px;
    font-family: 'Zen Kaku Gothic New', sans-serif; font-weight: 500;
  }
  .kw-tag .count { font-weight: 800; color: var(--color-focus); }
  .kw-tag.missing { border-color: #FECACA; background: #FFF5F5; color: #C9171E; } /* ç¼ºæ¼è­¦å‘Š */
  .kw-tag.good { border-color: #C6F6D5; background: #F0FFF4; color: #276749; }

  /* --- å³å´ï¼šé è¦½å€ (Seamless Paper) --- */
  /* ç§»é™¤åŸæœ¬çš„ paddingï¼Œè®“ç´™å¼µå¡«æ»¿ */
  .preview-wrapper {
    flex: 1; display: flex; flex-direction: column; 
    background: var(--bg-canvas); position: relative;
    overflow-y: auto; scroll-behavior: smooth;
  }
  
  .editor-paper {
    width: 100%; max-width: 820px; 
    min-height: 100%; /* ç¢ºä¿é«˜åº¦è‡³å°‘å¡«æ»¿ç•«é¢ï¼Œè§£æ±ºæˆªæ–·å•é¡Œ */
    margin: 0 auto; /* ç½®ä¸­ */
    background: #FFFFFF; 
    padding: 60px 80px 100px 80px; /* åº•éƒ¨ç•™ç™½åŠ å¤šï¼Œé¿å…æˆªæ–· */
    box-shadow: 0 0 40px rgba(0,0,0,0.03); /* æ¥µæ·¡çš„æ“´æ•£é™°å½± */
    outline: none;
    /* æ ¸å¿ƒæ’ç‰ˆ */
    font-family: 'Zen Kaku Gothic New', sans-serif;
    font-size: 11.5pt; line-height: 2.1; color: var(--color-ink);
    letter-spacing: 0.03em; text-align: justify;
  }
  
  /* æ¨™é¡Œèˆ‡æ¨£å¼ */
  .editor-paper h2 { 
    font-family: 'Shippori Mincho', serif; font-size: 1.6em; color: var(--color-focus); 
    border-bottom: 1px solid #E0E0E0; padding-bottom: 8px; margin: 32px 0 16px 0; letter-spacing: 0.05em;
  }
  .editor-paper h3 { 
    font-family: 'Shippori Mincho', serif; font-size: 1.3em; color: var(--color-ink);
    border-left: 4px solid var(--color-accent); padding-left: 12px; margin: 24px 0 12px 0;
  }
  
  /* --- å·¥å…·åˆ— (æ‡¸æµ®) --- */
  .toolbar-sticky {
    position: sticky; top: 0; z-index: 40;
    background: rgba(249, 248, 244, 0.9); backdrop-filter: blur(8px);
    border-bottom: 1px solid rgba(0,0,0,0.05);
    display: flex; justify-content: center; padding: 10px;
  }
  .toolbar-inner {
    display: flex; align-items: center; gap: 6px; 
    background: white; padding: 4px 6px; border-radius: 8px;
    border: 1px solid #EAEAEA; box-shadow: 0 4px 15px rgba(0,0,0,0.04);
  }
  
  /* æŒ‰éˆ•äº’å‹•å¼·åŒ– */
  .btn-tool {
    min-width: 32px; height: 32px; padding: 0 12px; border-radius: 4px;
    font-size: 13px; font-family: 'Shippori Mincho', serif; color: #555;
    transition: all 0.2s cubic-bezier(0.25, 0.8, 0.25, 1); cursor: pointer; border: 1px solid transparent;
  }
  .btn-tool:hover { transform: translateY(-2px); background: #F7F7F7; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
  
  /* è‰²ç¥¨ */
  .color-dot { 
    width: 20px; height: 20px; border-radius: 50%; border: 2px solid #FFF; 
    box-shadow: 0 0 0 1px #DDD; cursor: pointer; transition: all 0.2s; 
  }
  .color-dot:hover { transform: translateY(-2px) scale(1.1); box-shadow: 0 4px 6px rgba(0,0,0,0.1); }

  /* --- é¡¯çœ¼çš„æ“ä½œæŒ‰éˆ• (Solid Red) --- */
  .btn-primary {
    width: 100%; background: var(--color-accent); color: white; border: none; 
    padding: 14px; border-radius: 6px; 
    font-family: 'Shippori Mincho', serif; letter-spacing: 0.1em; font-weight: 700;
    cursor: pointer; box-shadow: 0 4px 12px rgba(191, 30, 51, 0.3); 
    transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px;
  }
  .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 16px rgba(191, 30, 51, 0.4); filter: brightness(1.1); }
  .btn-primary:active { transform: translateY(0); }

  .btn-secondary {
    flex: 1; background: white; border: 1px solid #DDD; color: #666;
    padding: 10px; border-radius: 6px; font-size: 13px; cursor: pointer; transition: 0.2s;
  }
  .btn-secondary:hover { border-color: var(--color-focus); color: var(--color-focus); transform: translateY(-1px); }

  /* --- ç‰ˆæ¬Šå®£å‘Š (Copyright) --- */
  .copyright {
    margin-top: 20px; text-align: center; font-size: 10px; color: #AAA; font-family: sans-serif;
    padding-top: 10px; border-top: 1px solid #EEE; line-height: 1.5;
  }

  /* --- RWD --- */
  @media (max-width: 768px) {
    .sidebar-container, .preview-wrapper { width: 100% !important; height: auto; }
    #sectionInput { height: calc(100vh - 120px); } /* æ‰£æ‰ header/nav */
    .editor-paper { padding: 40px 24px; min-height: 80vh; }
    .toolbar-sticky { overflow-x: auto; justify-content: flex-start; }
    /* Mobile Nav Hide/Show Logic */
    .mobile-hidden { display: none !important; }
  }
  @media (min-width: 769px) {
    .mobile-nav { display: none; }
    .sidebar-container { display: flex !important; }
    .preview-wrapper { display: flex !important; }
  }

  /* ç‹€æ…‹æŒ‡ç¤º */
  .sync-badge {
    position: fixed; bottom: 20px; right: 20px; 
    background: white; border: 1px solid #E0E0E0; padding: 6px 12px;
    border-radius: 30px; font-size: 11px; font-weight: 500; color: #888;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08); display: flex; align-items: center; gap: 6px;
    z-index: 50; transition: all 0.3s;
  }
  .sync-badge.active { border-color: #C6F6D5; color: #2F855A; background: #F0FFF4; }
</style>
</head>
<body>
  <div class="bg-noise"></div>

  <header class="h-14 flex md:hidden items-center px-4 bg-white border-b z-50 justify-between sticky top-0">
    <span class="font-serif font-bold text-lg text-gray-800">è›å…‰ãƒšãƒ³ <span class="text-xs font-sans text-red-600">PRO</span></span>
  </header>

  <div class="flex-1 flex flex-col md:flex-row overflow-hidden relative h-screen">
    
    <aside id="sectionInput" class="sidebar-container w-full md:w-[380px] custom-scroll overflow-y-auto">
      <div class="p-6 flex flex-col min-h-full">
         
         <div class="hidden md:flex items-center gap-2 mb-8 select-none">
           <span class="text-2xl">âœ’ï¸</span>
           <div>
             <h1 class="font-serif font-bold text-xl text-[#303133] tracking-widest leading-none">è›å…‰ãƒšãƒ³ <span class="text-xs font-sans text-[#BF1E33]">PRO</span></h1>
             <p class="text-[10px] text-gray-400 tracking-[0.2em] mt-1">SEO DRAFTING TOOL</p>
           </div>
         </div>

         <div class="mb-6">
           <div class="section-title">åŸæ–‡è¼¸å…¥</div>
           <textarea id="sourceText" class="input-field min-h-[200px]" placeholder="åœ¨æ­¤è¼¸å…¥æ–‡ç« ...&#10;æ”¯æ´è‡ªå‹•å»é‡èˆ‡å¯†åº¦æª¢æ¸¬ã€‚"></textarea>
         </div>
         
         <div class="mb-6 flex-1">
            <div class="section-title accent">SEO é—œéµå­—</div>
            <textarea id="kwList" class="input-field h-24 mb-3" placeholder="æ¯è¡Œä¸€å€‹é—œéµå­—..."></textarea>
            
            <div id="densityPanel" class="density-panel custom-scroll">
               <span class="text-xs text-gray-400 w-full text-center py-2">ç­‰å¾…è¼¸å…¥...</span>
            </div>
         </div>

         <div class="mt-auto pb-4">
           <button onclick="forceSync()" class="btn-primary mb-3">
             <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
             ä¸€éµæ¨™è¨» (Sync & Check)
           </button>
           <div class="flex gap-3">
             <button onclick="copyToClipboard()" class="btn-secondary font-bold text-[#BF1E33] border-[#BF1E33]/30 hover:bg-red-50">è¤‡è£½åˆ° Docs</button>
             <button onclick="clearAll()" class="btn-secondary">æ¸…ç©º</button>
           </div>
           
           <div class="copyright">
             Â© 2025 Kaoru Tsai. All Rights Reserved.<br>
             Unauthorized reproduction is strictly prohibited.
           </div>
         </div>
      </div>
    </aside>

    <main id="sectionPreview" class="preview-wrapper mobile-hidden custom-scroll">
      
      <div class="toolbar-sticky">
        <div class="toolbar-inner">
          <button onclick="execCmd('formatBlock','h2')" class="btn-tool font-bold text-lg" title="H2">H2</button>
          <button onclick="execCmd('formatBlock','h3')" class="btn-tool font-bold text-sm" title="H3">H3</button>
          <button onclick="execCmd('formatBlock','p')" class="btn-tool" title="å…§æ–‡">P</button>
          <div class="w-px h-5 bg-gray-200 mx-2"></div>
          
          <div onclick="applyColor('#303133')" class="color-dot bg-[#303133]" title="å¢¨è‰²"></div>
          <div onclick="applyColor('#2B4B65')" class="color-dot bg-[#2B4B65]" title="è—é‰„"></div>
          <div onclick="applyColor('#BF1E33')" class="color-dot bg-[#BF1E33]" title="çœŸç´…"></div>
          <div class="w-px h-5 bg-gray-200 mx-2"></div>
          
          <div onclick="applyHighlight('#F0DC70')" class="color-dot bg-[#F0DC70]" title="åˆˆå®‰"></div>
          <div onclick="applyHighlight('#F5B199')" class="color-dot bg-[#F5B199]" title="ä¸€æ–¤æŸ“"></div>
          <div class="w-px h-5 bg-gray-200 mx-2"></div>

          <button onclick="document.execCommand('undo')" class="btn-tool" title="å¾©åŸ">â†©</button>
        </div>
      </div>

      <div id="editor" contenteditable="true" class="editor-paper" placeholder="é è¦½å…§å®¹..."></div>
      
    </main>
  </div>

  <div id="syncBadge" class="sync-badge active">
    <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
    <span>Auto-Saved</span>
  </div>

  <nav class="md:hidden fixed bottom-0 left-0 right-0 bg-white border-t h-14 flex z-50">
    <button onclick="switchTab('input')" class="flex-1 text-xs font-bold text-gray-500 hover:text-red-600 flex flex-col items-center justify-center">
      <span>âœï¸ ç·¨è¼¯</span>
    </button>
    <button onclick="switchTab('preview')" class="flex-1 text-xs font-bold text-gray-500 hover:text-red-600 flex flex-col items-center justify-center">
      <span>ğŸ‘ï¸ é è¦½</span>
    </button>
  </nav>

  <script>
    // --- Config & State ---
    const source = document.getElementById('sourceText');
    const kwInput = document.getElementById('kwList');
    const editor = document.getElementById('editor');
    const densityPanel = document.getElementById('densityPanel');
    const syncBadge = document.getElementById('syncBadge');
    
    let isAutoSync = true;
    let saveTimer = null;
    let syncTimer = null;

    // --- Init ---
    window.addEventListener('DOMContentLoaded', () => {
      // 1. Auto-Load from LocalStorage
      if(localStorage.getItem('fluo_src')) source.value = localStorage.getItem('fluo_src');
      if(localStorage.getItem('fluo_kw')) kwInput.value = localStorage.getItem('fluo_kw');
      
      // 2. æ¢å¾©ç·¨è¼¯å™¨å…§å®¹ï¼Œè‹¥æœ‰å·®ç•°å‰‡ä¿æŒæ‰‹å‹•ç‹€æ…‹
      const cachedHtml = localStorage.getItem('fluo_html');
      if(cachedHtml) {
        editor.innerHTML = cachedHtml;
        // å¦‚æœç·©å­˜å…§å®¹è·Ÿæºç¢¼å·®ç•°å¤ªå¤§ï¼Œæš«åœåŒæ­¥ï¼Œä¿è­·ç”¨æˆ¶æ‰‹å‹•ä¿®æ”¹
        if(editor.innerText.trim() !== source.value.trim()) {
           isAutoSync = false;
           updateBadge('Manual Mode', false);
        }
      } else {
        runSyncLogic(true);
      }
      analyzeDensity(); // åˆå§‹åˆ†æ
    });

    // --- Core Logic: Deduplication & Sync ---
    function runSyncLogic(silent = false) {
      if(!isAutoSync) return;
      
      let text = source.value;
      if(!text) { if(!silent) editor.innerHTML = ''; return; }

      // 1. å»é‡é‚è¼¯ (Deduplication) - ä½¿ç”¨ Set
      const rawKws = kwInput.value.split('\n');
      // Set è‡ªå‹•éæ¿¾é‡è¤‡ï¼Œä¸¦è½‰å°å¯«æ¯”å° (ä½†ä¿ç•™åŸå§‹è¼¸å…¥ä¾›é¡¯ç¤º)
      const uniqueKwMap = new Map();
      rawKws.forEach(k => {
        const trimmed = k.trim();
        if(trimmed) uniqueKwMap.set(trimmed.toLowerCase(), trimmed);
      });
      const uniqueKws = Array.from(uniqueKwMap.values()); // ä¹¾æ·¨çš„é—œéµå­—åˆ—è¡¨

      // 2. HTML Escape
      let html = text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");

      // 3. Highlight (Case-Insensitive)
      // ä½¿ç”¨è¤‡é›œ Regex é¿å…æ¨™ç±¤å…§å±¬æ€§è¢«å–ä»£ï¼Œé€™è£¡ç°¡åŒ–è™•ç†ç´”æ–‡æœ¬
      uniqueKws.forEach(kw => {
        // ä½¿ç”¨ CSS è®Šæ•¸ä¸­çš„ Deep Red é€²è¡Œæ¨™è¨˜
        const regex = new RegExp(`(${escapeRegExp(kw)})`, 'gi');
        html = html.replace(regex, `<span style="color: #BF1E33; font-weight: bold;">$1</span>`);
      });

      // 4. Formatting (Paragraphs)
      const paragraphs = html.split(/\n\s*\n/).map(p => {
        if(!p.trim()) return '';
        return `<p style="margin-bottom: 1.5em;">${p.replace(/\n/g, '<br>')}</p>`;
      }).join('');

      editor.innerHTML = paragraphs;
      
      analyzeDensity(); // åŒæ­¥åŸ·è¡Œåˆ†æ
      triggerSave();
    }

    // --- Feature: Density Analyzer (Real-time) ---
    function analyzeDensity() {
      const text = source.value;
      const totalLen = text.length;
      if(totalLen === 0) { densityPanel.innerHTML = '<span class="text-xs text-gray-400">ç„¡å…§å®¹</span>'; return; }

      const rawKws = kwInput.value.split('\n').filter(k => k.trim());
      // å»é‡
      const uniqueKws = [...new Set(rawKws.map(k => k.trim()))];
      
      if(uniqueKws.length === 0) { densityPanel.innerHTML = '<span class="text-xs text-gray-400">ç„¡é—œéµå­—</span>'; return; }

      let html = '';
      uniqueKws.forEach(kw => {
        // è¨ˆç®—å‡ºç¾æ¬¡æ•¸ (Case Insensitive)
        const regex = new RegExp(escapeRegExp(kw), 'gi');
        const matches = text.match(regex);
        const count = matches ? matches.length : 0;
        const density = ((count * kw.length / totalLen) * 100).toFixed(1);
        
        // ç‹€æ…‹æ¨£å¼
        let statusClass = '';
        if(count === 0) statusClass = 'missing'; // ç´…è‰²è­¦å‘Š
        else if(density > 0.5 && density < 5) statusClass = 'good'; // ç¶ è‰²å¥åº·

        html += `<div class="kw-tag ${statusClass}">
          ${kw} <span class="count">${count}</span> <span style="font-size:9px; opacity:0.7">(${density}%)</span>
        </div>`;
      });
      
      densityPanel.innerHTML = html;
    }

    // --- Helper: Escape Regex ---
    function escapeRegExp(string) {
      return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    }

    // --- Listeners ---
    // 1. Source/KW Input -> Debounce Sync
    function handleInput() {
      if(isAutoSync) {
        clearTimeout(syncTimer);
        syncTimer = setTimeout(() => runSyncLogic(true), 500); // 0.5s debounce
      } else {
        // å¦‚æœæ˜¯æ‰‹å‹•æ¨¡å¼ï¼Œåªæ›´æ–° Densityï¼Œä¸åŒæ­¥é è¦½
        analyzeDensity();
      }
      triggerSave();
    }
    source.addEventListener('input', handleInput);
    kwInput.addEventListener('input', handleInput);

    // 2. Editor Input -> Lock Sync
    editor.addEventListener('input', () => {
      if(isAutoSync) {
        isAutoSync = false;
        updateBadge('Manual Mode (Sync Paused)', false);
      }
      triggerSave();
    });

    // --- Auto-Save (LocalStorage) ---
    function triggerSave() {
      updateBadge('Saving...', true);
      clearTimeout(saveTimer);
      saveTimer = setTimeout(() => {
        localStorage.setItem('fluo_src', source.value);
        localStorage.setItem('fluo_kw', kwInput.value);
        localStorage.setItem('fluo_html', editor.innerHTML);
        updateBadge('All Saved', true);
      }, 1000); // 1ç§’å¾Œå­˜æª” (ä¸æ¶ˆè€—æ•ˆèƒ½)
    }

    function updateBadge(text, isActive) {
      syncBadge.innerHTML = `<span class="w-2 h-2 rounded-full ${isActive ? 'bg-green-500' : 'bg-orange-400'}"></span> ${text}`;
      syncBadge.className = `sync-badge ${isActive ? 'active' : ''}`;
    }

    // --- Actions ---
    function forceSync() {
      isAutoSync = true;
      updateBadge('Sync Active', true);
      runSyncLogic();
      if(window.innerWidth < 768) switchTab('preview');
    }

    function clearAll() {
      if(confirm('ç¢ºå®šè¦æ¸…ç©ºå—ï¼Ÿé€™å°‡ç„¡æ³•å¾©åŸã€‚')) {
        source.value = '';
        kwInput.value = '';
        editor.innerHTML = '';
        densityPanel.innerHTML = '';
        localStorage.clear();
        isAutoSync = true;
        triggerSave();
      }
    }

    // --- Deep Style Baking (Copy to Docs) ---
    async function copyToClipboard() {
      // 1. å»ºç«‹ Wrapperï¼Œå¼·åˆ¶é è¨­æ¨£å¼
      const wrapper = document.createElement('div');
      
      // 2. æ³¨å…¥æ·±åº¦çƒ˜ç„™æ¨£å¼ (Deep Baking)
      // æœ€å¤–å±¤å¼·åˆ¶ 12pt å¾®è»Ÿæ­£é»‘é«” (æ»¿è¶³ Google Docs æœ€ä½³ç›¸å®¹æ€§)
      wrapper.style.cssText = "font-family: 'Microsoft JhengHei', sans-serif; font-size: 12pt; line-height: 2.0; color: #303133;";
      
      // 3. è¤‡è£½å…§å®¹ä¸¦ä¿æŒå…§éƒ¨æ¨™è¨˜
      const clone = editor.cloneNode(true);
      
      // 4. é‡å°æ¨™é¡Œé€²è¡Œæ¨£å¼å›ºåŒ– (Inline Styles for Docs)
      const headers = clone.querySelectorAll('h2, h3');
      headers.forEach(h => {
        if(h.tagName === 'H2') h.style.cssText = "font-size: 18pt; font-weight: bold; color: #2B4B65; border-bottom: 1px solid #CCC; padding-bottom: 6px; margin-top: 24px;";
        if(h.tagName === 'H3') h.style.cssText = "font-size: 14pt; font-weight: bold; color: #333; border-left: 4px solid #BF1E33; padding-left: 10px; margin-top: 20px;";
      });

      wrapper.innerHTML = clone.innerHTML;

      try {
        const htmlBlob = new Blob([wrapper.outerHTML], {type: 'text/html'});
        const textBlob = new Blob([editor.innerText], {type: 'text/plain'});
        await navigator.clipboard.write([new ClipboardItem({'text/html': htmlBlob, 'text/plain': textBlob})]);
        alert('âœ¨ å·²è¤‡è£½ï¼\næ ¼å¼èˆ‡æ¨£å¼å·²æ·±åº¦å„ªåŒ–ï¼Œå¯ç›´æ¥è²¼ä¸Š Google Docsã€‚');
      } catch(e) {
        alert('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•å…¨é¸è¤‡è£½ã€‚');
      }
    }

    // --- Toolbar Logic ---
    function execCmd(cmd, val) {
      document.execCommand(cmd, false, val);
      // æ‰‹å‹•æ“ä½œè§¸ç™¼é–å®š
      if(isAutoSync) { isAutoSync = false; updateBadge('Manual Mode', false); }
    }
    function applyColor(hex) {
      document.execCommand('foreColor', false, hex);
      if(isAutoSync) { isAutoSync = false; updateBadge('Manual Mode', false); }
    }
    function applyHighlight(hex) {
      if(!document.execCommand('hiliteColor', false, hex)) {
         document.execCommand('backColor', false, hex);
      }
      if(isAutoSync) { isAutoSync = false; updateBadge('Manual Mode', false); }
    }

    // --- Mobile Tab Switch ---
    function switchTab(tab) {
      const input = document.getElementById('sectionInput');
      const preview = document.getElementById('sectionPreview');
      if(tab === 'input') {
        input.classList.remove('mobile-hidden');
        preview.classList.add('mobile-hidden');
      } else {
        input.classList.add('mobile-hidden');
        preview.classList.remove('mobile-hidden');
      }
    }
  </script>
</body>
</html>
