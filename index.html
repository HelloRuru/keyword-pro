<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>é—œéµå­—è¢å…‰ç­† Pro - SEO æ•¸ä½å·¥å…·</title>
  
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23374B6D' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='m12 19 7-7 3 3-7 7-3-3Z'/%3E%3Cpath d='m18 13-1.5-7.5L2 2l3.5 14.5L13 18l5-5Z'/%3E%3Cpath d='m2 2 5 2.25'/%3E%3Cpath d='m11 4 2 1.5'/%3E%3C/svg%3E">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Noto+Serif+JP:wght@400;600;900&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  
  <style>
    /* --- Design System: Wafuu Magazine --- */
    :root {
      --bg-canvas: #F5F5F2; 
      --bg-card: #FFFFFF;
      --text-ink: #2B2B2B;
      --text-sub: #595857;
      --color-brand: #374B6D; 
      --color-accent: #B93A32;
      --shadow-card: 0 10px 30px -10px rgba(0,0,0,0.06);
      --border-radius: 12px;
    }

    /* --- Global Reset --- */
    html, body { 
      height: 100%; width: 100%; overflow: hidden; 
      font-family: 'Noto Sans JP', sans-serif;
      background-color: var(--bg-canvas); 
      color: var(--text-ink); 
      margin: 0; padding: 0;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.03'/%3E%3C/svg%3E");
    }
    
    .serif-font { font-family: 'Noto Serif JP', serif; letter-spacing: 0.03em; }

    .app-container { 
      display: flex; flex-direction: column; height: 100vh; width: 100vw;
      /* ä¿®æ­£ï¼šé˜²æ­¢è¦–çª—é«˜åº¦éå°æ™‚ä»‹é¢å´©å£ */
      min-height: 500px; 
    }

    /* --- Header --- */
    .header-area { 
      flex-shrink: 0; height: 60px; z-index: 50; 
      background: rgba(255,255,255,0.9); backdrop-filter: blur(8px);
      display: flex; align-items: center; justify-content: center;
      border-bottom: 1px solid rgba(0,0,0,0.05);
      padding: 0 20px;
    }

    /* --- Workspace Layout (Desktop First) --- */
    .main-workspace { 
      display: flex; flex: 1; overflow: hidden; position: relative; 
      gap: 20px; padding: 20px; 
      max-width: 1600px; margin: 0 auto; width: 100%;
    }

    .card-panel {
      background: var(--bg-card);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-card);
      border: 1px solid rgba(0,0,0,0.03);
      overflow: hidden;
      display: flex; flex-direction: column;
    }

    /* --- Sidebar (Input) - Fluid Width Fix --- */
    .sidebar-input { 
      /* ä¿®æ­£ï¼šä½¿ç”¨ flex-basis èˆ‡ min/max width é”æˆæµé«”ç¸®æ”¾ */
      flex: 0 0 350px; 
      width: 350px;
      min-width: 300px; 
      max-width: 380px;
      z-index: 20;
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .input-group { padding: 16px; display: flex; flex-direction: column; }
    
    textarea { 
      width: 100%; resize: none; border: none; outline: none; background: transparent;
      font-size: 14px; line-height: 1.7; color: var(--text-sub); transition: all 0.2s;
    }
    textarea:focus { color: var(--text-ink); }
    textarea::placeholder { color: #A0A09E; font-weight: 400; font-style: italic; }

    .label-header { 
      font-size: 11px; font-weight: 700; color: var(--color-brand); 
      letter-spacing: 0.1em; margin-bottom: 10px; display: flex; align-items: center; gap: 8px; opacity: 0.8;
    }
    .label-header::before {
      content: ''; display: block; width: 6px; height: 6px; background: var(--color-brand); border-radius: 50%;
    }

    /* --- Preview Area --- */
    .preview-section { flex: 1; position: relative; min-width: 0; /* é˜²æ­¢ Flex å­å…ƒç´ æº¢å‡º */ }

    .inline-toolbar { 
      background: #fff; height: 52px; flex-shrink: 0; 
      padding: 0 12px; display: flex; align-items: center; gap: 8px; 
      border-bottom: 1px solid rgba(0,0,0,0.05); z-index: 40;
      overflow-x: auto; /* å…è¨±å·¥å…·åˆ—åœ¨å°è¢å¹•æ©«å‘æ²å‹• */
      white-space: nowrap;
    }
    /* éš±è—å·¥å…·åˆ—æ²è»¸ä½†ä¿ç•™åŠŸèƒ½ */
    .inline-toolbar::-webkit-scrollbar { display: none; }
    
    .scrollable-preview-area { 
      flex: 1; overflow-y: auto; overflow-x: hidden;
      display: block; padding: 0; text-align: center;
      background-image: radial-gradient(#d4d4d8 1px, transparent 1px);
      background-size: 24px 24px;
    }

    .editor-paper { 
      display: inline-block; width: 100%; max-width: 800px; 
      min-height: 100%; height: auto !important;
      background: #FFFFFF; 
      padding: 50px 60px 100px 60px; 
      margin: 0 auto; text-align: justify;
      white-space: pre-wrap; word-wrap: break-word; overflow-wrap: break-word;    
      line-height: 2.1; font-size: 16px; color: #333; font-weight: 500;
    }

    /* --- Interactive Elements --- */
    .btn-primary { 
      width: 100%; padding: 10px; border-radius: 8px; 
      background: var(--color-brand); color: white; font-weight: 700;
      display: flex; align-items: center; justify-content: center; gap: 8px; font-size: 13px;
      box-shadow: 0 4px 8px rgba(55, 75, 109, 0.15); transition: all 0.2s;
    }
    .btn-primary:hover { background: #2A3B55; transform: translateY(-1px); }

    .icon-btn { 
      width: 32px; height: 32px; border-radius: 6px; color: #64748b; 
      display: flex; align-items: center; justify-content: center; transition: all 0.2s; flex-shrink: 0;
    }
    .icon-btn:hover { background: #f1f5f9; color: var(--color-brand); }

    .swatch-group { 
      display: flex; align-items: center; gap: 3px; padding: 3px; 
      border-radius: 6px; background: #F7F7F7; flex-shrink: 0;
    }
    .swatch-item { 
      width: 22px; height: 22px; border-radius: 50%; border: 2px solid transparent; 
      cursor: pointer; transition: all 0.2s; flex-shrink: 0;
    }
    .swatch-item:hover { transform: scale(1.15); border-color: #ddd; }
    
    .btn-emphasis { 
      background: #FEF2F2; color: var(--color-accent); border: 1px solid #FECACA;
      padding: 5px 12px; border-radius: 6px; font-weight: 700; font-size: 12px;
      display: flex; align-items: center; gap: 4px; transition: all 0.2s; cursor: pointer; flex-shrink: 0;
    }
    .btn-emphasis:hover { background: var(--color-accent); color: white; border-color: var(--color-accent); }

    .btn-copy {
      margin-left: auto;
      background: #F8FAFC; color: var(--color-brand); border: 1px solid #E2E8F0;
      padding: 5px 14px; border-radius: 6px; font-weight: 700; font-size: 12px;
      display: flex; align-items: center; gap: 6px; transition: all 0.2s; cursor: pointer; flex-shrink: 0;
    }
    .btn-copy:hover { border-color: var(--color-brand); background: #F0F4F8; }

    .status-bar { 
      height: 36px; background: #fff; border-top: 1px solid rgba(0,0,0,0.05); 
      padding: 0 16px; font-size: 11px; color: #94a3b8; font-weight: 500; 
      display: flex; align-items: center; justify-content: space-between; flex-shrink: 0;
    }
    
    .density-item {
      display: flex; justify-content: space-between; align-items: center;
      padding: 6px 8px; border-radius: 6px; margin-bottom: 2px;
      font-size: 12px; color: var(--text-sub); border: 1px solid transparent;
    }
    .density-item:hover { background: #fff; border-color: #E2E8F0; }

    /* --- RESPONSIVE LOGIC (The Safety Net) --- */
    .mobile-tab-bar { display: none; }
    .divider { width: 1px; height: 16px; background: #E2E8F0; margin: 0 6px; flex-shrink: 0; }

    /* æ–·é»ä¿®æ­£ï¼šå°‡ Mobile æ¨¡å¼è§¸ç™¼é»æ‹‰é«˜è‡³ 820pxã€‚
       é€™æ¶µè“‹äº†ï¼š
       1. æ‰€æœ‰ç›´å‘æ‰‹æ©Ÿ
       2. iPad Mini (ç›´å‘)
       3. iPad Air/Pro (ç›´å‘)
       4. é›»è…¦ç€è¦½å™¨æ”¾å¤§ 150%~175% (è¦–è¢å¹•è§£æåº¦è€Œå®š)
    */
    @media (max-width: 820px) {
      .app-container { height: 100%; background: #fff; min-height: 0; /* Mobile doesn't need min-height constraint same way */ }
      .main-workspace { padding: 0; gap: 0; display: block; position: relative; }
      .card-panel { border-radius: 0; border: none; box-shadow: none; height: 100%; }
      
      /* Mobile: Panels are absolute and toggled */
      .sidebar-input { 
        width: 100%; height: auto; max-width: none; flex: none;
        position: absolute; top: 0; bottom: 56px; left: 0; 
        z-index: 30; transform: translateX(0); background: #fff;
      }
      .preview-section { 
        width: 100%; height: auto;
        position: absolute; top: 0; bottom: 56px; left: 0; 
        z-index: 25; opacity: 0; pointer-events: none; transition: opacity 0.2s; background: #fff;
      }
      
      .show-preview .sidebar-input { transform: translateX(-20px); opacity: 0; pointer-events: none; }
      .show-preview .preview-section { opacity: 1; pointer-events: auto; z-index: 35; }
      
      .editor-paper { padding: 30px 20px 100px 20px; width: 100%; }
      
      .mobile-tab-bar { 
        display: flex; height: 56px; background: #fff; border-top: 1px solid #E2E8F0;
        z-index: 60; width: 100%; flex-shrink: 0; 
        position: absolute; bottom: 0; left: 0;
        padding-bottom: env(safe-area-inset-bottom); /* iPhone Home Bar é©é… */
      }
      .tab-btn { 
        flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; 
        font-weight: 500; color: #94a3b8; font-size: 10px; gap: 4px; transition: 0.2s;
      }
      .tab-btn svg { width: 20px; height: 20px; }
      .tab-btn.active { color: var(--color-brand); background: #F8FAFC; }
      
      /* Mobile: Hide Status Bar in Preview to save space */
      .status-bar { display: none; } 
    }
  </style>
</head>
<body class="app-container">

  <header class="header-area">
    <div class="flex items-center gap-3">
      <div class="w-8 h-8 flex items-center justify-center text-[var(--color-brand)]">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m12 19 7-7 3 3-7 7-3-3Z"/><path d="m18 13-1.5-7.5L2 2l3.5 14.5L13 18l5-5Z"/></svg>
      </div>
      <h1 class="text-lg font-bold text-[var(--color-brand)] tracking-[0.1em] serif-font">è›å…‰ãƒšãƒ³ PRO <span class="text-xs font-normal opacity-60 ml-1 font-sans">V7.1</span></h1>
    </div>
  </header>

  <main class="main-workspace" id="mainWorkspace">
    <div class="sidebar-input card-panel">
      <div class="input-group flex-1 border-b border-gray-100">
        <div class="label-header">åŸæ–‡è¼¸å…¥ (SOURCE)</div>
        <textarea id="sourceText" class="flex-1" placeholder="è«‹åœ¨æ­¤è™•è²¼ä¸Šæ–‡ç« è‰ç¨¿..."></textarea>
      </div>
      
      <div class="input-group bg-[#FAFAFA]" style="height: 55%;">
        <div class="label-header">SEO é—œéµå­—åº«</div>
        <textarea id="kwList" class="h-20 mb-3 text-sm bg-white border border-gray-200 rounded-md p-2 outline-none resize-none font-medium focus:border-[var(--color-brand)]" placeholder="è¼¸å…¥é—œéµå­— (æ¯è¡Œä¸€å€‹)..."></textarea>
        
        <div id="densityResults" class="flex-1 overflow-y-auto mb-3 min-h-0 pr-1"></div>
        
        <button onclick="runAutoMark()" class="btn-primary mb-3">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></svg>
          ä¸€éµæ¨™è¨»
        </button>
        
        <div class="relative w-full">
          <select id="clearMenu" class="w-full p-2 text-xs text-center text-slate-500 bg-transparent hover:text-red-500 cursor-pointer outline-none appearance-none font-medium transition-colors" onchange="handleClearAction(this)">
            <option value="" disabled selected>ğŸ—‘ï¸ æ¸…é™¤é¸é …...</option>
            <option value="kw">æ¸…é™¤é—œéµå­—</option>
            <option value="source">æ¸…é™¤åŸæ–‡</option>
            <option value="format">æ¸…é™¤æ ¼å¼</option>
            <option value="all">âš ï¸ å…¨éƒ¨é‡ç½®</option>
          </select>
        </div>
      </div>
    </div>

    <div class="preview-section card-panel">
      <div class="inline-toolbar">
        <button onmousedown="event.preventDefault(); cmd('undo')" class="icon-btn" title="å¾©åŸ"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 7v6h6"/><path d="M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"/></svg></button>
        <button onmousedown="event.preventDefault(); cmd('redo')" class="icon-btn" title="é‡åš"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 7v6h-6"/><path d="M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3L21 13"/></svg></button>
        
        <div class="divider"></div>
        
        <div class="swatch-group">
           <div class="swatch-item bg-[#2C2C2C]" title="å¢¨" onmousedown="event.preventDefault(); applyColor('#2C2C2C')"></div>
           <div class="swatch-item bg-[#B93A32]" title="æœ±èµ¤" onmousedown="event.preventDefault(); applyColor('#B93A32')"></div>
           <div class="swatch-item bg-[#374B6D]" title="è—éµ" onmousedown="event.preventDefault(); applyColor('#374B6D')"></div>
           <div class="swatch-item bg-[#3F6C45]" title="å¸¸ç›¤" onmousedown="event.preventDefault(); applyColor('#3F6C45')"></div>
           <button onmousedown="event.preventDefault(); cmd('removeFormat')" class="swatch-item bg-white border-dashed border-gray-300 flex items-center justify-center text-gray-400" title="æ¸…é™¤æ ¼å¼">
             <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
           </button>
        </div>

        <div class="divider"></div>

        <div class="swatch-group">
          <div class="swatch-item bg-[#FEECEC]" title="æ«»è‰²" onmousedown="event.preventDefault(); applyHilite('#FEECEC')"></div>
          <div class="swatch-item bg-[#FFF9C4]" title="èœèŠ±" onmousedown="event.preventDefault(); applyHilite('#FFF9C4')"></div>
          <div class="swatch-item bg-[#D1EAED]" title="æ°´è‰²" onmousedown="event.preventDefault(); applyHilite('#D1EAED')"></div>
          <div class="swatch-item bg-[#E0EBDF]" title="è‹¥è‹—" onmousedown="event.preventDefault(); applyHilite('#E0EBDF')"></div>
          <button onmousedown="event.preventDefault(); applyHilite('transparent')" class="swatch-item bg-white border-dashed border-gray-300 flex items-center justify-center text-gray-400" title="ç„¡èƒŒæ™¯">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
          </button>
        </div>
        
        <div class="divider"></div>
        <button onmousedown="event.preventDefault(); applyRedBold()" class="btn-emphasis">A+ é‡é»</button>

        <button onclick="copyToDocs(this)" class="btn-copy">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>
          è¤‡è£½
        </button>
      </div>

      <div class="scrollable-preview-area">
        <div id="editor" contenteditable="true" class="editor-paper serif-font" placeholder="ç´™å¼µã«ç­†ã‚’èµ°ã‚‰ã›ã‚‹ã‚ˆã†ã«..."></div>
      </div>
      
      <footer class="status-bar">
        <div class="flex gap-4">
          <span>ç¸½å­—æ•¸: <span id="totalCount" class="text-slate-800 font-bold font-mono">0</span></span>
          <span class="text-slate-300">|</span>
          <span>é¸å–: <span id="selectCount" class="text-[var(--color-brand)] font-bold font-mono">0</span></span>
        </div>
        <div class="opacity-40 text-[10px] font-sans">
          Simple SEO Editor
        </div>
      </footer>
    </div>
  </main>

  <div class="mobile-tab-bar">
    <button class="tab-btn active" onclick="switchTab('input', this)">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
      <span>ç·¨è¼¯</span>
    </button>
    <button class="tab-btn" onclick="switchTab('preview', this)">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>
      <span>é è¦½</span>
    </button>
  </div>

  <script>
    // --- Logic Core (Stable) ---
    const editor = document.getElementById('editor'); 
    const source = document.getElementById('sourceText');
    const totalCount = document.getElementById('totalCount'); 
    const selectCount = document.getElementById('selectCount');
    const kwListArea = document.getElementById('kwList'); 
    const densityResults = document.getElementById('densityResults');
    const STORAGE_KEY = 'highlight_pro_v7_data';

    function cmd(command, value = null) {
      editor.focus();
      document.execCommand(command, false, value);
      updateCounts(); 
    }

    function applyColor(hex) { cmd('foreColor', hex); }
    
    function applyHilite(hex) {
      if (!document.execCommand('hiliteColor', false, hex)) {
        document.execCommand('backColor', false, hex); 
      }
      editor.focus();
    }

    function applyRedBold() {
      editor.focus();
      document.execCommand('bold');
      applyColor('#B93A32');
    }

    function switchTab(mode, btn) {
      const workspace = document.getElementById('mainWorkspace');
      const buttons = document.querySelectorAll('.tab-btn');
      
      buttons.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');

      if (mode === 'preview') {
        workspace.classList.add('show-preview');
        // Mobile scroll reset
        if (window.innerWidth < 820) {
             document.querySelector('.scrollable-preview-area').scrollTop = 0;
        }
      } else {
        workspace.classList.remove('show-preview');
      }
    }

    // Sync Logic
    function syncPreview() {
      editor.innerText = source.value; 
      updateCounts();
      runDensityAnalysis();
      saveData(); 
    }

    function updateCounts() {
      totalCount.innerText = editor.innerText.replace(/\s/g, '').length;
    }

    document.addEventListener('selectionchange', () => {
      const sel = window.getSelection().toString();
      selectCount.innerText = sel.replace(/\s/g, '').length;
    });

    function getUniqueKeywords() {
      const raw = kwListArea.value.split('\n');
      const cleaned = raw.map(k => k.trim()).filter(k => k !== "");
      return [...new Set(cleaned)];
    }

    function runDensityAnalysis() {
      const keywords = getUniqueKeywords(); 
      const content = editor.innerText || "";
      const totalChars = content.length;
      
      densityResults.innerHTML = "";
      if (totalChars === 0 && keywords.length > 0) return;

      keywords.forEach(kw => {
        const regex = new RegExp(kw.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'gi');
        const count = (content.match(regex) || []).length;
        const density = ((count * kw.length / totalChars) * 100).toFixed(1);
        
        let badgeClass = "text-gray-400";
        if (density > 0) badgeClass = "text-[var(--color-brand)] font-bold";
        if (density > 3) badgeClass = "text-[var(--color-accent)] font-bold";

        const div = document.createElement('div');
        div.className = "density-item";
        div.innerHTML = `
          <span class="truncate font-medium">${kw}</span>
          <span class="${badgeClass} font-mono text-xs">${density}% <span class="text-gray-300 text-[10px] ml-1">(${count})</span></span>
        `;
        densityResults.appendChild(div);
      });
      saveData(); 
    }

    function runAutoMark() {
      const keywords = getUniqueKeywords(); 
      if (keywords.length === 0) {
        alert("è«‹å…ˆè¼¸å…¥é—œéµå­—");
        return;
      }

      let html = editor.innerText;
      html = html.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");

      keywords.forEach(kw => {
        const cleanKw = kw.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'); 
        const regex = new RegExp(`(${cleanKw})`, 'gi');
        html = html.replace(regex, `<span style="color:#B93A32; font-weight:bold; text-decoration: underline; text-decoration-style: dashed; text-decoration-color: #B93A32;">$1</span>`);
      });
      
      editor.innerHTML = html;
      updateCounts();
      
      if (window.innerWidth < 820) {
         const previewBtn = document.querySelectorAll('.tab-btn')[1];
         switchTab('preview', previewBtn);
      }
    }

    function handleClearAction(select) {
      const val = select.value;
      if (!val) return; 

      if (confirm(`ç¢ºå®šè¦åŸ·è¡Œã€Œ${select.options[select.selectedIndex].text}ã€å—ï¼Ÿ`)) {
        if (val === 'kw') {
          kwListArea.value = "";
          densityResults.innerHTML = "";
        } else if (val === 'source') {
          source.value = "";
          editor.innerText = ""; 
        } else if (val === 'format') {
          const text = editor.innerText;
          editor.innerHTML = text; 
        } else if (val === 'all') {
          source.value = "";
          kwListArea.value = "";
          editor.innerHTML = "";
          densityResults.innerHTML = "";
        }
        updateCounts();
        saveData(); 
      }
      select.value = "";
    }

    async function copyToDocs(btn) {
      const blobHtml = new Blob([editor.innerHTML], { type: 'text/html' });
      const blobText = new Blob([editor.innerText], { type: 'text/plain' });
      const data = [new ClipboardItem({ 'text/html': blobHtml, 'text/plain': blobText })];
      
      try {
        await navigator.clipboard.write(data);
        const originalHtml = btn.innerHTML;
        btn.innerHTML = `
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
          å·²è¤‡è£½
        `;
        btn.classList.add('bg-gray-200');
        setTimeout(() => {
           btn.innerHTML = originalHtml;
           btn.classList.remove('bg-gray-200');
        }, 2000);
      } catch (err) {
        alert('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½ã€‚');
      }
    }

    // --- Auto-Save System ---
    function loadSavedData() {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (saved) {
        try {
          const data = JSON.parse(saved);
          if (data.source) {
             source.value = data.source;
             editor.innerText = data.source; 
          }
          if (data.keywords) {
             kwListArea.value = data.keywords;
             runDensityAnalysis(); 
          }
          updateCounts();
        } catch (e) { console.error("è®€å–å­˜æª”å¤±æ•—", e); }
      }
    }

    let saveTimeout;
    function saveData() {
      clearTimeout(saveTimeout);
      saveTimeout = setTimeout(() => {
        const data = {
          source: source.value,
          keywords: kwListArea.value
        };
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
      }, 500);
    }

    // Init
    loadSavedData();
    source.addEventListener('input', () => { syncPreview(); }); 
    kwListArea.addEventListener('input', () => { runDensityAnalysis(); }); 
  </script>
</body>
</html>
