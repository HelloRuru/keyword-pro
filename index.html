<!DOCTYPE html>
<html lang="zh-TW" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  
  <meta name="description" content="ÂÖçË≤ª SEO ÂØ´‰ΩúÂ∑•ÂÖ∑„ÄÇ‰∏ÄÈçµËá™ÂãïÊ®ôË®ªÈóúÈçµÂ≠ó„ÄÅË®àÁÆóÂØÜÂ∫¶ÔºåÂÆåÁæéË§áË£ΩÂà∞ Google Docs ‰∏çË∑ëÁâà„ÄÇÊîØÊè¥ÁπÅÁ∞°ËΩâÊèõËàáÂæÆËªüÊ≠£ÈªëÈ´îËº∏Âá∫„ÄÇ">
  <meta name="keywords" content="SEOÂ∑•ÂÖ∑, ÈóúÈçµÂ≠óÂØÜÂ∫¶, Google Docs Ê†ºÂºè, ÁπÅÁ∞°ËΩâÊèõ, ÂØ´‰ΩúËªüÈ´î, ËõçÂÖâ„Éö„É≥ PRO">
  <meta name="author" content="Kaoru Tsai">

  <title>ËõçÂÖâ„Éö„É≥ PRO - SEOÊñáÊ°àÊï∏‰ΩçÂ∑•ÂÖ∑</title>
  
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "SoftwareApplication",
    "name": "ËõçÂÖâ„Éö„É≥ PRO",
    "applicationCategory": "ProductivityApplication",
    "operatingSystem": "Browser",
    "offers": { "@type": "Offer", "price": "0", "priceCurrency": "TWD" },
    "description": "SEO ÂØ´ÊâãÂ∞àÁî®ÁöÑÊï∏‰ΩçËû¢ÂÖâÁ≠Ü„ÄÇËß£Ê±∫ Google Docs Ë≤º‰∏äË∑ëÁâàÂïèÈ°å„ÄÇ",
    "author": { "@type": "Person", "name": "Kaoru Tsai" }
  }
  </script>

  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23a58f86' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='m12 19 7-7 3 3-7 7-3-3Z'/%3E%3Cpath d='m18 13-1.5-7.5L2 2l3.5 14.5L13 18l5-5Z'/%3E%3Cpath d='m2 2 5 2.25'/%3E%3Cpath d='m11 4 2 1.5'/%3E%3C/svg%3E">
  <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white' style='background-color:%23b3ada0' stroke='%23a58f86' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='m12 19 7-7 3 3-7 7-3-3Z'/%3E%3Cpath d='m18 13-1.5-7.5L2 2l3.5 14.5L13 18l5-5Z'/%3E%3Cpath d='m2 2 5 2.25'/%3E%3Cpath d='m11 4 2 1.5'/%3E%3C/svg%3E">
  
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Noto+Serif+JP:wght@400;600;700;900&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  
  <style>
    /* --- Design System: Rikyu & Kurumi (V9.3) --- */
    :root {
      --bg-canvas: #EBE9E4; 
      --bg-card: #FFFEFA;
      --text-ink: #3E3C38; 
      --text-sub: #A58F86; 
      --border-light: #B3ADA0;
      --color-brand: #715C1F; 
      --color-jump-action: #B7282E; 
      --color-jump-finish: #192F60;
      --shadow-card: 0 4px 12px -2px rgba(165, 143, 134, 0.1);
      --radius-btn: 4px;
    }

    html[data-theme="dark"] {
      --bg-canvas: #1F1D19;
      --bg-card: #292622;
      --text-ink: #E8E6E1;
      --text-sub: #A6A092;
      --border-light: #5C5850;
      --color-brand: #C7B370; 
      --color-jump-action: #FF6B6B;
      --color-jump-finish: #6B8AFF;
    }
    
    html, body { 
      height: 100%; width: 100%; overflow: hidden; 
      font-family: 'Noto Sans JP', sans-serif;
      background-color: var(--bg-canvas); 
      color: var(--text-ink); 
      margin: 0; padding: 0;
      transition: background-color 0.3s;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.05'/%3E%3C/svg%3E");
    }

    .serif-font { font-family: 'Noto Serif JP', serif; letter-spacing: 0.04em; }

    .app-container { 
      display: flex; flex-direction: column; height: 100vh; width: 100vw;
      min-height: 500px; 
    }

    /* Toast */
    .toast {
      position: fixed; top: 24px; left: 50%; transform: translateX(-50%) translateY(-20px);
      background-color: var(--color-jump-finish); color: white;
      padding: 10px 20px; border-radius: 50px;
      font-size: 13px; font-weight: 500; letter-spacing: 0.05em;
      opacity: 0; pointer-events: none; transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      z-index: 100; box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      display: flex; align-items: center; gap: 8px;
    }
    .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

    /* Header */
    .header-area { 
      flex-shrink: 0; height: 60px; z-index: 50; 
      background: rgba(255, 254, 250, 0.95); 
      backdrop-filter: blur(8px);
      display: flex; align-items: center; justify-content: space-between;
      border-bottom: 1px solid var(--border-light);
      padding: 0 24px;
    }
    html[data-theme="dark"] .header-area { background: rgba(41, 38, 34, 0.95); }

    /* Workspace */
    .main-workspace { 
      display: flex; flex: 1; overflow: hidden; position: relative; 
      gap: 20px; padding: 20px; 
      max-width: 1600px; margin: 0 auto; width: 100%;
    }

    .card-panel {
      background: var(--bg-card);
      border-radius: 8px;
      box-shadow: var(--shadow-card), inset 0 0 0 1px rgba(255,255,255,0.4);
      border: 1px solid var(--border-light);
      overflow: hidden;
      display: flex; flex-direction: column;
    }

    /* Sidebar */
    .sidebar-input { 
      flex: 0 0 340px; width: 340px; 
      z-index: 20; transition: transform 0.3s;
    }
    
    .input-group { 
      padding: 16px; 
      display: flex; flex-direction: column;
      flex-shrink: 0;
    }
    
    textarea { 
      width: 100%; resize: none; border: none; outline: none; background: transparent;
      font-size: 14px; line-height: 1.8; color: var(--text-sub);
      font-family: 'Noto Sans JP', sans-serif;
    }
    textarea:focus { color: var(--text-ink); }
    textarea::placeholder { color: #968C83; opacity: 1; font-style: normal; }
    html[data-theme="dark"] textarea::placeholder { color: #6B655D; }
    
    .label-header { 
      font-family: 'Noto Serif JP', serif;
      font-size: 13px; font-weight: 700; color: var(--color-brand); 
      letter-spacing: 0.1em; margin-bottom: 10px; display: flex; align-items: center; justify-content: space-between;
      min-height: 24px;
    }

    /* Action Card */
    .jp-action-card {
      background-color: #FFFEFA;
      border: 1px solid var(--border-light);
      border-radius: 6px; padding: 20px;
      text-align: center; position: relative; margin-top: auto;
      box-shadow: inset 0 0 20px rgba(179, 173, 160, 0.1); 
      flex-shrink: 0; 
    }
    
    .btn-jp-hero {
      font-family: 'Noto Serif JP', serif;
      background-color: var(--color-jump-action); color: #FFFFFF;
      border: none; border-radius: 4px;
      padding: 12px 24px; width: 100%;
      font-size: 15px; letter-spacing: 0.05em; font-weight: 700;
      cursor: pointer; transition: all 0.2s ease;
      box-shadow: 0 4px 10px rgba(183, 40, 46, 0.25);
      margin-bottom: 14px;
    }
    .btn-jp-hero:hover { filter: brightness(1.1); transform: translateY(-1px); }
    
    .jp-secondary-actions {
      display: flex; gap: 8px; justify-content: center;
      border-top: 1px dashed var(--border-light); padding-top: 14px;
    }
    
    .btn-jp-sub {
      background: #FAF9F6; border: 1px solid var(--border-light); border-radius: 4px;
      color: var(--text-sub); padding: 5px 12px; flex: 1;
      font-size: 12px; cursor: pointer; transition: all 0.2s;
      font-family: 'Noto Serif JP', serif;
    }
    .btn-jp-sub:hover { color: var(--color-brand); border-color: var(--color-brand); background: #FFFFFF; }
    
    .select-reset {
      background: #FFF5F5; border: 1px solid #F5E6E6; border-radius: 4px;
      color: #C44338; padding: 5px 8px; font-size: 12px; cursor: pointer;
      font-family: 'Noto Serif JP', serif; outline: none; flex: 1;
      text-align: center; appearance: none;
    }
    .select-reset:hover { border-color: #C44338; }

    /* Toolbar */
    .preview-section { flex: 1; position: relative; min-width: 0; }

    .toolbar-container {
      background: var(--bg-card);
      border-bottom: 1px solid var(--border-light);
      padding: 10px 16px;
      display: flex; align-items: center; gap: 10px;
      flex-wrap: wrap; z-index: 40;
    }
    
    .tool-sep { width: 1px; height: 24px; background: var(--border-light); margin: 0 4px; }
    .tool-sep-strong { width: 2px; height: 28px; background: var(--border-light); margin: 0 8px; }

    .group-struct { display: flex; gap: 4px; }
    .group-edit { display: flex; gap: 4px; align-items: center; }
    
    /* Structure Buttons (Updated Event) */
    .btn-struct {
      height: 32px; padding: 0 10px;
      background: #FFFFFF; border: 1px solid var(--border-light);
      color: var(--text-sub); 
      font-family: 'Noto Serif JP', serif; font-size: 14px; font-weight: 700;
      border-radius: var(--radius-btn); 
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      line-height: 1; cursor: pointer; transition: all 0.2s;
    }
    .btn-struct span.pt-hint { font-family: sans-serif; font-size: 9px; opacity: 0.6; margin-top: 1px; font-weight: 400; color: var(--border-light); }
    .btn-struct:hover { border-color: var(--color-brand); color: var(--color-brand); background: #FDFCF8; }

    /* Font Size Wrapper */
    .font-size-wrapper { 
      position: relative; display: inline-block;
      height: 32px;
      background: #FFFFFF; 
      border: 1px solid var(--border-light); 
      border-radius: var(--radius-btn);
    }
    .font-size-wrapper:hover { border-color: var(--color-brand); }
    
    .font-size-select {
      height: 100%; width: 100%;
      padding: 0 24px 0 10px;
      background: transparent; border: none;
      color: var(--text-ink); font-size: 13px; font-family: 'Noto Serif JP', serif; font-weight: 600;
      cursor: pointer; outline: none; 
      appearance: none; -webkit-appearance: none; -moz-appearance: none;
    }
    
    .font-size-wrapper::after {
      content: ''; position: absolute; right: 8px; top: 50%; transform: translateY(-50%); width: 8px; height: 8px; pointer-events: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23a58f86' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");
      background-size: contain; background-repeat: no-repeat;
    }

    .btn-edit {
      height: 32px; min-width: 32px; padding: 0 8px;
      background: #FFFFFF; border: 1px solid var(--border-light); border-radius: var(--radius-btn);
      color: var(--text-sub); font-size: 14px;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer; transition: all 0.2s;
    }
    .btn-edit:hover { border-color: var(--color-brand); color: var(--color-brand); background: #FDFCF8; }
    .btn-edit svg { width: 16px; height: 16px; }

    .btn-emphasis { 
      background: #FFF5F5; color: var(--color-jump-action); border: 1px solid #FECACA;
      height: 34px; padding: 0 16px; border-radius: var(--radius-btn); 
      font-family: 'Noto Serif JP', serif; font-weight: 700; font-size: 13px;
      display: flex; align-items: center; gap: 6px; transition: 0.2s; cursor: pointer;
      box-shadow: 0 2px 5px rgba(183, 40, 46, 0.1);
    }
    .btn-emphasis:hover { background: var(--color-jump-action); color: white; border-color: var(--color-jump-action); box-shadow: 0 4px 8px rgba(183, 40, 46, 0.25); }

    .btn-copy {
      background: var(--color-jump-finish); color: white; border: none;
      height: 34px; padding: 0 20px; border-radius: var(--radius-btn); 
      font-family: 'Noto Serif JP', serif; font-weight: 600; font-size: 13px;
      display: flex; align-items: center; gap: 6px; cursor: pointer; transition: 0.2s;
      box-shadow: 0 2px 5px rgba(25, 47, 96, 0.2);
    }
    .btn-copy:hover { filter: brightness(1.2); transform: translateY(-1px); box-shadow: 0 4px 10px rgba(25, 47, 96, 0.3); }

    .btn-restore {
      height: 32px; padding: 0 10px;
      background: transparent; border: 1px dashed var(--border-light); border-radius: var(--radius-btn);
      color: var(--text-sub); font-size: 12px; font-weight: 500;
      display: flex; align-items: center; gap: 4px; cursor: pointer; transition: 0.2s;
    }
    .btn-restore:hover { border-color: var(--color-jump-finish); color: var(--color-jump-finish); background: #F0F4FF; }

    .group-color { display: flex; gap: 6px; align-items: center; }
    .swatch-item { 
      width: 24px; height: 24px; border-radius: 50%; border: 1px solid var(--border-light); 
      cursor: pointer; transition: transform 0.15s; flex-shrink: 0; display: flex; align-items: center; justify-content: center;
    }
    .swatch-item:hover { transform: scale(1.2); border-color: var(--text-sub); }
    .btn-color-reset {
      width: 24px; height: 24px; border-radius: 50%; border: 1px dashed var(--border-light);
      background: transparent; color: var(--text-sub); font-size: 10px;
      display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s;
    }
    .btn-color-reset:hover { color: var(--color-jump-action); border-color: var(--color-jump-action); background: white; }

    /* Editor Canvas */
    .scrollable-preview-area { 
      flex: 1; overflow-y: auto; overflow-x: hidden; display: block; 
      background-color: #E6E3DB; 
      text-align: center; padding-top: 30px; padding-bottom: 60px;
      scrollbar-gutter: stable; 
    }
    html[data-theme="dark"] .scrollable-preview-area { background-color: #151515; }

    .editor-paper { 
      display: inline-block; width: 100%; max-width: 820px; 
      min-height: 1000px; height: auto !important;
      background: #FFFFFF; 
      padding: 70px 80px; margin: 0 auto; 
      text-align: justify;
      white-space: pre-wrap; word-wrap: break-word; overflow-wrap: break-word;    
      line-height: 2.1; 
      font-size: 12pt; 
      color: #333; 
      box-shadow: 0 10px 30px -10px rgba(0,0,0,0.1);
    }
    html[data-theme="dark"] .editor-paper { background: #2B2822; color: #E7E5E4; }
    html[data-theme="dark"] .editor-paper span[style*="color: rgb(44, 44, 44)"] { color: #E7E5E4 !important; }

    /* Status Bar */
    .status-bar {
      height: 36px; background: var(--bg-card);
      border-top: 1px solid var(--border-light);
      display: flex; align-items: center; justify-content: space-between;
      padding: 0 20px; flex-shrink: 0;
      font-size: 12px; color: var(--text-sub);
      font-family: 'Noto Serif JP', serif;
    }
    
    /* Interactive Count Toggle */
    .count-toggle-btn {
      display: flex; align-items: center; gap: 6px; 
      cursor: pointer; user-select: none;
      padding: 2px 10px; border-radius: 12px;
      background: rgba(0,0,0,0.03); transition: all 0.2s;
      border: 1px solid transparent;
    }
    .count-toggle-btn:hover { background: rgba(0,0,0,0.06); border-color: var(--border-light); }
    .count-val { font-family: sans-serif; font-weight: 700; color: var(--text-ink); }
    
    /* FIX: Icon Size */
    .icon-switch { width: 14px; height: 14px; opacity: 0.6; min-width: 14px; }

    .geo-faq {
      margin-top: 20px; border-top: 1px dashed var(--border-light); padding-top: 10px;
      font-size: 11px; color: var(--text-sub);
      flex-shrink: 0; 
    }
    .geo-faq summary { cursor: pointer; margin-bottom: 5px; font-weight: bold; list-style: none; }
    .geo-faq summary::-webkit-details-marker { display: none; }
    .geo-faq p { margin-bottom: 5px; line-height: 1.5; }

    .mobile-tab-bar { display: none; }
    
    @media (max-width: 1024px) {
      .app-container { height: 100%; }
      .main-workspace { padding: 0; gap: 0; display: block; }
      .card-panel { border-radius: 0; border: none; box-shadow: none; height: 100%; }
      
      .sidebar-input { 
        width: 100%; height: auto; position: absolute; top: 0; bottom: 56px; left: 0; 
        z-index: 30; transform: translateX(0); background: var(--bg-card);
      }
      .preview-section { 
        width: 100%; height: auto; position: absolute; top: 0; bottom: 56px; left: 0; 
        z-index: 25; opacity: 0; pointer-events: none;
      }
      .toolbar-container { overflow-x: auto; padding: 8px; gap: 8px; }
      .tool-sep { display: none; }
      .tool-sep-strong { display: inline-block; width: 1px; margin: 0 4px; }
      
      .show-preview .sidebar-input { transform: translateX(-20px); opacity: 0; pointer-events: none; }
      .show-preview .preview-section { opacity: 1; pointer-events: auto; z-index: 35; }
      .editor-paper { padding: 30px 20px; margin: 0; width: 100%; min-height: 100%; box-shadow: none; }
      
      .mobile-tab-bar { 
        display: flex; height: 56px; background: var(--bg-card); border-top: 1px solid var(--border-light);
        z-index: 60; width: 100%; flex-shrink: 0; position: absolute; bottom: 0; left: 0;
        padding-bottom: env(safe-area-inset-bottom);
      }
      .tab-btn { 
        flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; 
        font-weight: 500; color: var(--text-sub); font-size: 10px; gap: 4px; font-family: 'Noto Serif JP', serif;
      }
      .tab-btn.active { color: var(--color-brand); background: var(--bg-canvas); }
      .header-title-sub { display: none; } 
      .status-bar { display: none; } 
    }
  </style>
</head>
<body class="app-container">

  <div id="toast" class="toast"></div>

  <header class="header-area">
    <div class="flex items-center gap-3 overflow-hidden">
      <div class="w-8 h-8 flex-shrink-0 flex items-center justify-center text-white bg-[var(--color-brand)] rounded shadow-sm">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="m12 19 7-7 3 3-7 7-3-3Z"/><path d="m18 13-1.5-7.5L2 2l3.5 14.5L13 18l5-5Z"/></svg>
      </div>
      <div class="flex flex-col justify-center min-w-0">
        <h1 class="text-lg font-bold text-[var(--color-brand)] tracking-widest serif-font leading-tight truncate">ËõçÂÖâ„Éö„É≥ PRO</h1>
        <span class="header-title-sub text-[10px] text-[var(--text-sub)] font-medium tracking-[0.2em] uppercase opacity-70 truncate">SEO Writer Suite</span>
      </div>
    </div>
    
    <button onclick="toggleTheme()" class="w-8 h-8 rounded-full flex items-center justify-center text-[var(--text-sub)] hover:bg-[var(--bg-canvas)] transition-colors flex-shrink-0" title="ÂàáÊèõÂ§úÈñìÊ®°Âºè">
      <svg id="moonIcon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="block"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
      <svg id="sunIcon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="hidden"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
    </button>
  </header>

  <main class="main-workspace" id="mainWorkspace">
    <div class="sidebar-input card-panel">
      <div class="input-group" style="flex: 1 1 40%; min-height: 150px; border-bottom: 1px solid var(--border-light);">
        <div class="flex justify-between items-start mb-2">
          <div class="label-header mb-0">ÂéüÊñáËº∏ÂÖ•</div>
          <div class="flex flex-col items-end gap-2">
            <label class="flex items-center gap-1 cursor-pointer select-none">
              <span class="text-[10px] font-bold text-[var(--text-sub)]">ÂÖ®ÂΩ¢</span>
              <input type="checkbox" id="autoPunc" class="accent-[var(--color-brand)] w-3.5 h-3.5" checked>
            </label>
            <div class="flex gap-1">
              <button onclick="convertText('S2T')" class="text-[10px] px-2 py-0.5 border border-[var(--border-light)] rounded bg-white text-[var(--text-sub)] hover:text-[var(--color-brand)] hover:border-[var(--color-brand)] transition">Á∞°‚ÜíÁπÅ</button>
              <button onclick="convertText('T2S')" class="text-[10px] px-2 py-0.5 border border-[var(--border-light)] rounded bg-white text-[var(--text-sub)] hover:text-[var(--color-brand)] hover:border-[var(--color-brand)] transition">ÁπÅ‚ÜíÁ∞°</button>
            </div>
          </div>
        </div>
        <textarea id="sourceText" style="flex: 1;" placeholder="Ë´ãË≤º‰∏äÊñáÁ´†ËçâÁ®ø..."></textarea>
      </div>
      
      <div class="input-group" style="flex: 1 1 50%; min-height: 250px; overflow-y: auto; padding-bottom: 24px;">
        <div class="label-header">SEO ÈóúÈçµÂ≠óÂ∫´</div>
        <textarea id="kwList" class="h-24 mb-3 text-sm bg-[var(--bg-card)] border border-[var(--border-light)] rounded p-3 outline-none resize-none font-medium transition-all focus:border-[var(--color-brand)]" style="min-height: 80px;" placeholder="Ëº∏ÂÖ•ÈóúÈçµÂ≠ó (ÊØèË°å‰∏ÄÂÄã)..."></textarea>
        
        <div id="densityResults" class="flex-shrink-0 mb-4 pr-1"></div>
        
        <div class="jp-action-card">
          <button onclick="runAutoMark()" class="btn-jp-hero">
            ‰∏ÄÈçµÊ®ôË®ª (Auto Mark)
          </button>
          
          <div class="jp-secondary-actions">
             <button onclick="downloadTxt()" class="btn-jp-sub">‰∏ãËºâ .txt</button>
             <select onchange="handleClearAction(this)" class="select-reset">
               <option value="" selected disabled>üóëÔ∏è ÈáçÁΩÆ...</option>
               <option value="source">Ê∏ÖÁ©∫ÂéüÊñá</option>
               <option value="kw">Ê∏ÖÁ©∫ÈóúÈçµÂ≠ó</option>
               <option value="all">ÂÖ®ÈÉ®Ê∏ÖÁ©∫</option>
             </select>
          </div>
        </div>
        
        <details class="geo-faq">
          <summary>Â∏∏Ë¶ãÂïèÈ°å (FAQ)</summary>
          <p><strong>Q: ÁÇ∫‰ªÄÈ∫ºË≤ºÂà∞ Google Docs Â≠óÈ´îÊúÉË∑ëÊéâÔºü</strong><br>A: ËõçÂÖâ„Éö„É≥ PRO ‰ΩøÁî®Áç®ÂÆ∂Â∞ÅË£ùÊäÄË°ìÔºåÂº∑Âà∂ÊåáÂÆöÂæÆËªüÊ≠£ÈªëÈ´îÔºåËß£Ê±∫Ê≠§ÂïèÈ°å„ÄÇ</p>
          <p><strong>Q: Ë≥áÊñôÂÆâÂÖ®ÂóéÔºü</strong><br>A: ÂÆâÂÖ®„ÄÇÊâÄÊúâË≥áÊñôÂÉÖÂÑ≤Â≠òÊñºÊÇ®ÁöÑÁÄèË¶ΩÂô® (Local Storage)„ÄÇ</p>
        </details>

      </div>
    </div>

    <div class="preview-section card-panel">
      <div class="toolbar-container">
        
        <div class="group-struct">
          <button onmousedown="event.preventDefault(); applyBlock('H1')" class="btn-struct" title="Â§ßÊ®ôÈ°å (24pt)">
            H1 <span class="pt-hint">24pt</span>
          </button>
          <button onmousedown="event.preventDefault(); applyBlock('H2')" class="btn-struct" title="ÂâØÊ®ôÈ°å (18pt)">
            H2 <span class="pt-hint">18pt</span>
          </button>
          <button onmousedown="event.preventDefault(); applyBlock('P')" class="btn-struct" title="ÂÖßÊñá (12pt)">
            ÂÖßÊñá <span class="pt-hint">12pt</span>
          </button>
        </div>
        
        <div class="tool-sep"></div>

        <div class="group-edit">
           <div class="font-size-wrapper">
             <select id="fontSizeSelect" onchange="changeFontSize(this.value)" class="font-size-select" title="ÈÅ∏ÊìáÂ≠óÈ´îÂ§ßÂ∞è">
               <option value="10">10pt</option>
               <option value="11">11pt</option>
               <option value="12" selected>12pt</option>
               <option value="14">14pt</option>
               <option value="18">18pt</option>
               <option value="24">24pt</option>
               <option value="30">30pt</option>
               <option value="36">36pt</option>
             </select>
           </div>

           <button onmousedown="event.preventDefault(); cmd('undo')" class="btn-edit" title="Âæ©Âéü"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 7v6h6"/><path d="M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"/></svg></button>
           <button onmousedown="event.preventDefault(); cmd('redo')" class="btn-edit" title="ÈáçÂÅö"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 7v6h-6"/><path d="M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3L21 13"/></svg></button>
           
           <div class="w-px h-6 bg-[var(--border-light)] mx-1"></div>
           
           <button onmousedown="event.preventDefault(); applyRedBold()" class="btn-emphasis" title="Á¥ÖÂ≠ó+Á≤óÈ´î">A+ ÈáçÈªû</button>
           <button onclick="copyToDocs(this)" class="btn-copy" title="Ë§áË£ΩÂà∞Ââ™Ë≤ºÁ∞ø (ÂæÆËªüÊ≠£Èªë)">
             Ë§áË£Ω
           </button>
        </div>

        <div class="tool-sep-strong"></div>

        <button onmousedown="event.preventDefault(); applyCleanStyle()" class="btn-restore" title="ÁßªÈô§ÊâÄÊúâÊ†ºÂºè">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
          ÈÇÑÂõûÈ†êË®≠
        </button>

        <div class="ml-auto flex items-center gap-4">
           <div class="group-color">
             <div class="swatch-item bg-[#2C2C2C]" onmousedown="event.preventDefault(); applyColor('#2C2C2C')" title="Â¢®"></div>
             <div class="swatch-item bg-[#B93A32]" onmousedown="event.preventDefault(); applyColor('#B93A32')" title="Êú±Ëµ§"></div>
             <div class="swatch-item bg-[#192F60]" onmousedown="event.preventDefault(); applyColor('#192F60')" title="Á¥∫Èùí"></div>
             <button onmousedown="event.preventDefault(); applyColor('inherit')" class="btn-color-reset" title="ÂõûÂæ©È†êË®≠Ëâ≤">‚úï</button>
           </div>
           
           <div class="w-px h-4 bg-[var(--border-light)] opacity-50"></div>
           
           <div class="group-color">
             <div class="swatch-item bg-[#FFF9C4]" onmousedown="event.preventDefault(); applyHilite('#FFF9C4')" title="ÈªÉ"></div>
             <div class="swatch-item bg-[#FEECEC]" onmousedown="event.preventDefault(); applyHilite('#FEECEC')" title="Á¥Ö"></div>
             <div class="swatch-item bg-[#D1EAED]" onmousedown="event.preventDefault(); applyHilite('#D1EAED')" title="Ëóç"></div>
             <button onmousedown="event.preventDefault(); applyHilite('transparent')" class="btn-color-reset" title="Ê∏ÖÈô§ËÉåÊôØ">‚úï</button>
           </div>
        </div>

      </div>

      <div class="scrollable-preview-area">
        <div id="editor" contenteditable="true" class="editor-paper serif-font" placeholder="ÈñãÂßãÂØ´‰Ωú..."></div>
      </div>
      
      <footer class="status-bar">
        <div class="flex gap-4">
          <div class="count-toggle-btn" title="ÈªûÊìäÂàáÊèõË®àÁÆóÊ®°Âºè" onclick="toggleCountMode()">
            <svg class="icon-switch" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M21 21v-5h-5"/></svg>
            <span>Â≠óÊï∏:</span>
            <span id="totalCount" class="count-val">0</span>
            <span id="countModeLabel" class="text-[10px] opacity-70 font-medium">(Âê´Ê®ôÈªû)</span>
          </div>
          
          <div class="w-px h-3 bg-[var(--border-light)]"></div>
          
          <div class="count-item">
            <span>ÈÅ∏Âèñ:</span>
            <span id="selectCount" class="count-val text-[var(--color-brand)]">0</span>
          </div>
        </div>
        <div class="flex items-center gap-2 text-[10px] text-[var(--text-sub)]">
           <span id="saveStatus">‚òÅÔ∏è Â∑≤ÂÑ≤Â≠ò</span>
           <span>|</span>
           <span>&copy; 2025 Kaoru Tsai.</span>
        </div>
      </footer>
    </div>
  </main>

  <div class="mobile-tab-bar">
    <button class="tab-btn active" onclick="switchTab('input', this)">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
      <span>Á∑®ËºØ</span>
    </button>
    <button class="tab-btn" onclick="switchTab('preview', this)">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>
      <span>È†êË¶Ω</span>
    </button>
  </div>

  <script>
    const editor = document.getElementById('editor'); 
    const source = document.getElementById('sourceText');
    const kwListArea = document.getElementById('kwList'); 
    const densityResults = document.getElementById('densityResults');
    const autoPuncToggle = document.getElementById('autoPunc');
    const totalCount = document.getElementById('totalCount');
    const selectCount = document.getElementById('selectCount');
    const saveStatus = document.getElementById('saveStatus');
    const toast = document.getElementById('toast');
    const countModeLabel = document.getElementById('countModeLabel');
    const STORAGE_KEY = 'highlight_pro_v93_data';
    const THEME_KEY = 'highlight_pro_theme';
    let countMode = 'all'; 
    let savedRange = null; // Selection Memory

    const TS_DICT = {
      '‰πà':'È∫º','‰∫é':'Êñº','‰∏∫':'ÁÇ∫','Âπ≤':'‰πæ','Âêé':'Âæå','Èáå':'Ë£°','Âà∂':'Ë£Ω','Èù¢':'È∫µ','Âèë':'Áôº','ÈÉÅ':'È¨±','Êùæ':'È¨Ü','Êâç':'Êâç','Âè∞':'Ëá∫',
      '‰∏á':'Ëê¨','‰∏é':'Ëàá','‰∏ë':'ÈÜú','‰∏ì':'Â∞à','‰∏ö':'Ê•≠','‰∏õ':'Âè¢','‰∏ú':'Êù±','‰∏ù':'Áµ≤','‰∏§':'ÂÖ©','‰∏•':'Âö¥','‰∏ß':'Âñ™','‰∏™':'ÂÄã','‰∏∞':'Ë±ê',
      '‰∏¥':'Ëá®','‰∏Ω':'È∫ó','‰∏æ':'Ëàâ','‰πÉ':'‰πÉ','‰πÖ':'‰πÖ','‰πâ':'Áæ©','‰πê':'Ê®Ç','‰πî':'Âñ¨','‰πñ':'‰πñ','‰πò':'‰πò','‰πô':'‰πô','‰πù':'‰πù','‰πû':'‰πû',
      '‰π†':'Áøí','‰π°':'ÈÑâ','‰π¶':'Êõ∏','‰π∞':'Ë≤∑','‰π±':'‰∫Ç','‰∫Ü':'‰∫Ü','‰∫à':'‰∫à','‰∫â':'Áà≠','‰∫ã':'‰∫ã','‰∫å':'‰∫å','‰∫è':'Ëôß','‰∫ë':'Èõ≤','‰∫í':'‰∫í',
      '‰∫î':'‰∫î','‰∫ï':'‰∫ï','‰∫ö':'‰∫û','‰∫õ':'‰∫õ','‰∫°':'‰∫°','‰∫§':'‰∫§','‰∫•':'‰∫•','‰∫¶':'‰∫¶','‰∫ß':'Áî¢','‰∫®':'‰∫®','‰∫©':'Áïù','‰∫´':'‰∫´','‰∫¨':'‰∫¨',
      '‰∫≤':'Ë¶™','‰∫ø':'ÂÑÑ','‰ªÄ':'‰ªÄ','‰ªÅ':'‰ªÅ','‰ªÖ':'ÂÉÖ','‰ªÜ':'ÂÉï','‰ªá':'‰ªá','‰ªä':'‰ªä','‰ªã':'‰ªã','‰ªç':'‰ªç','‰ªé':'Âæû','‰ªë':'‰æñ','‰ªì':'ÂÄâ',
      '‰ªî':'‰ªî','‰ªï':'‰ªï','‰ªñ':'‰ªñ','‰ªò':'‰ªò','‰ªô':'‰ªô','‰ª£':'‰ª£','‰ª§':'‰ª§','‰ª•':'‰ª•','‰ª™':'ÂÑÄ','‰ª¨':'ÂÄë','‰ª∞':'‰ª∞','‰ª≤':'‰ª≤','‰ª∂':'‰ª∂',
      '‰ª∑':'ÂÉπ','‰ªª':'‰ªª','‰ªΩ':'‰ªΩ','‰ªø':'‰ªø','‰ºÅ':'‰ºÅ','‰ºâ':'‰ºâ','‰ºä':'‰ºä','‰ºç':'‰ºç','‰ºé':'‰ºé','‰ºè':'‰ºè','‰ºê':'‰ºê','‰ºë':'‰ºë','‰ºó':'Áúæ',
      '‰ºò':'ÂÑ™','‰ºô':'Â§•','‰ºö':'ÊúÉ','‰º†':'ÂÇ≥','‰º§':'ÂÇ∑','‰º¶':'ÂÄ´','‰º™':'ÂÅΩ','‰º´':'‰Ωá','‰ºØ':'‰ºØ','‰º∞':'‰º∞','‰º¥':'‰º¥','‰º∂':'‰º∂','‰º∏':'‰º∏',
      '‰º∫':'‰º∫','‰ºº':'‰ºº','‰ºΩ':'‰ºΩ','‰ΩÉ':'‰ΩÉ','‰ΩÜ':'‰ΩÜ','‰Ωç':'‰Ωç','‰Ωé':'‰Ωé','‰Ωè':'‰Ωè','‰Ωê':'‰Ωê','‰Ωë':'‰Ωë','‰Ωì':'È´î','‰Ωï':'‰Ωï','‰Ωô':'È§ò',
      '‰Ωõ':'‰Ωõ','‰Ωú':'‰Ωú','‰Ω†':'‰Ω†','‰Ω£':'ÂÇ≠','‰Ω©':'‰Ω©','‰ΩØ':'‰ΩØ','‰Ω∞':'‰Ω∞','‰Ω≥':'‰Ω≥','‰Ωø':'‰Ωø','Êù•':'‰æÜ','‰æã':'‰æã','‰æç':'‰æç','‰æè':'‰æè'
    };
    const ST_DICT = {};
    Object.keys(TS_DICT).forEach(key => { ST_DICT[TS_DICT[key]] = key; });

    function showToast(msg) {
      toast.innerText = msg;
      toast.classList.add('show');
      setTimeout(() => { toast.classList.remove('show'); }, 2000);
    }

    // --- CORE FIX: SELECTION MEMORY ---
    function saveSelection() {
      const sel = window.getSelection();
      if (sel.getRangeAt && sel.rangeCount) {
        savedRange = sel.getRangeAt(0);
      }
    }

    function restoreSelection() {
      if (savedRange) {
        const sel = window.getSelection();
        sel.removeAllRanges();
        sel.addRange(savedRange);
      }
    }

    function convertText(mode) {
      let text = source.value;
      if (!text) return;
      let converted = "";
      const map = (mode === 'S2T') ? TS_DICT : ST_DICT;
      for (let i = 0; i < text.length; i++) {
        const char = text[i];
        converted += map[char] || char;
      }
      source.value = converted;
      syncPreview();
      showToast(mode === 'S2T' ? '‚úÖ Â∑≤ËΩâÊèõÁÇ∫ÁπÅÈ´î' : '‚úÖ Â∑≤ËΩâÊèõÁÇ∫Á∞°È´î');
    }

    function cmd(command, value = null) { 
      restoreSelection(); 
      document.execCommand(command, false, value); 
      updateCounts(); 
    }
    
    function applyColor(hex) { 
      restoreSelection();
      if (hex === 'inherit') { document.execCommand('removeFormat', false, null); } 
      else { document.execCommand('foreColor', false, hex); }
      updateCounts();
    }
    
    function applyHilite(hex) { 
      restoreSelection();
      if (!document.execCommand('hiliteColor', false, hex)) document.execCommand('backColor', false, hex); 
      updateCounts(); 
    }

    function applyRedBold() {
      restoreSelection();
      const selection = window.getSelection();
      if (!selection.rangeCount) return;
      
      const span = document.createElement("span");
      span.style.fontWeight = "700"; span.style.color = "#B93A32";
      
      const range = selection.getRangeAt(0);
      try { 
        range.surroundContents(span); 
      } catch (e) { 
        document.execCommand('styleWithCSS', false, true); 
        document.execCommand('foreColor', false, "#B93A32"); 
        document.execCommand('bold', false, null); 
      }
      updateCounts();
      showToast('‚ú® Â∑≤Ê®ôË®ª A+ ÈáçÈªû');
    }

    function applyBlock(tag) { 
      restoreSelection();
      document.execCommand('formatBlock', false, tag); 
      updateCounts(); 
    }

    function applyCleanStyle() {
      if(confirm('Á¢∫ÂÆöË¶ÅÁßªÈô§ÊâÄÊúâÊ†ºÂºèÔºàËÆäÂõûÁ¥îÊñáÂ≠óÔºâÂóéÔºü')) {
         const cleanText = editor.innerText;
         editor.innerHTML = cleanText; 
         updateCounts();
         showToast('üßπ Ê†ºÂºèÂ∑≤Ê∏ÖÈô§');
      }
    }

    function changeFontSize(val) {
      restoreSelection(); 
      const selection = window.getSelection();
      if (!selection.rangeCount || selection.isCollapsed) return;
      
      const span = document.createElement("span");
      span.style.fontSize = val + "pt";
      
      const range = selection.getRangeAt(0);
      try {
         range.surroundContents(span);
      } catch (e) {
         document.execCommand('styleWithCSS', false, true);
         document.execCommand('fontSize', false, '3'); 
      }
      updateCounts();
    }

    function convertPunctuation(text) {
      if (!autoPuncToggle.checked) return text;
      return text.replace(/,/g, 'Ôºå').replace(/\./g, '„ÄÇ').replace(/\(/g, 'Ôºà').replace(/\)/g, 'Ôºâ').replace(/:/g, 'Ôºö').replace(/;/g, 'Ôºõ').replace(/!/g, 'ÔºÅ').replace(/\?/g, 'Ôºü');
    }

    function syncPreview() {
      let text = source.value;
      text = convertPunctuation(text);
      if (document.activeElement === source) editor.innerText = text;
      runDensityAnalysis(); updateCounts(); saveData(); 
    }

    function toggleCountMode() {
      countMode = countMode === 'all' ? 'no-punc' : 'all';
      countModeLabel.innerText = countMode === 'all' ? '(Âê´Ê®ôÈªû)' : '(‰∏çÂê´Ê®ôÈªû)';
      updateCounts();
    }

    function updateCounts() {
      let text = editor.innerText || "";
      if (countMode === 'no-punc') { text = text.replace(/[^\w\u4e00-\u9fa5]/g, ''); } else { text = text.replace(/\s/g, ''); }
      totalCount.innerText = text.length;
      let selection = window.getSelection().toString();
      if (countMode === 'no-punc') { selection = selection.replace(/[^\w\u4e00-\u9fa5]/g, ''); } else { selection = selection.replace(/\s/g, ''); }
      selectCount.innerText = selection.length;
    }
    
    editor.addEventListener('keyup', () => { updateCounts(); saveSelection(); });
    editor.addEventListener('mouseup', () => { updateCounts(); saveSelection(); });
    editor.addEventListener('touchend', () => { updateCounts(); saveSelection(); });
    document.addEventListener('selectionchange', () => {
      const sel = window.getSelection();
      if(sel.rangeCount && editor.contains(sel.anchorNode)) {
        saveSelection();
        updateCounts();
      }
    });

    function runDensityAnalysis() {
      const keywords = kwListArea.value.split('\n').map(k => k.trim()).filter(k => k !== "");
      const content = editor.innerText || "";
      const totalChars = content.length;
      densityResults.innerHTML = "";
      if (totalChars === 0 && keywords.length > 0) return;
      keywords.forEach(kw => {
        const regex = new RegExp(kw.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'gi');
        const count = (content.match(regex) || []).length;
        const density = ((count * kw.length / totalChars) * 100).toFixed(1);
        let colorClass = density > 0 ? "text-[var(--color-brand)] font-bold" : "text-[var(--text-sub)]";
        const div = document.createElement('div');
        div.className = "flex justify-between items-center p-1.5 border-b border-[var(--border-light)] text-xs";
        div.innerHTML = `<span class="truncate ${colorClass}">${kw}</span><span class="font-mono text-[var(--text-ink)]">${density}%</span>`;
        densityResults.appendChild(div);
      });
    }

    function runAutoMark() {
      const keywords = kwListArea.value.split('\n').map(k => k.trim()).filter(k => k !== "");
      if (keywords.length === 0) { alert("Ë´ãÂÖàËº∏ÂÖ•ÈóúÈçµÂ≠ó"); return; }
      let html = editor.innerText.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
      keywords.forEach(kw => {
        const cleanKw = kw.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'); 
        const regex = new RegExp(`(${cleanKw})`, 'gi');
        html = html.replace(regex, `<span style="color:#B93A32; font-weight:700;">$1</span>`);
      });
      editor.innerHTML = html;
      updateCounts();
      showToast('‚ú® Â∑≤Ëá™ÂãïÊ®ôË®ª');
      if (window.innerWidth < 1024) switchTab('preview', document.querySelectorAll('.tab-btn')[1]);
    }

    /* FIX: Style Baking for Google Docs */
    async function copyToDocs(btn) {
      const clone = editor.cloneNode(true);
      
      const h1s = clone.querySelectorAll('h1');
      h1s.forEach(el => el.setAttribute('style', 'font-size: 24pt !important; font-weight: bold; line-height: 1.5; margin-bottom: 12px; color: #333;'));
      
      const h2s = clone.querySelectorAll('h2');
      h2s.forEach(el => el.setAttribute('style', 'font-size: 18pt !important; font-weight: bold; line-height: 1.5; margin-bottom: 10px; color: #333;'));
      
      const wrapper = document.createElement('div');
      wrapper.style.cssText = "font-family: 'Microsoft JhengHei', 'Microsoft YaHei', sans-serif; font-size: 12pt; line-height: 2.0; color: #333333;";
      wrapper.innerHTML = clone.innerHTML;
      
      const blobHtml = new Blob([wrapper.outerHTML], { type: 'text/html' });
      const blobText = new Blob([editor.innerText], { type: 'text/plain' });
      const data = [new ClipboardItem({ 'text/html': blobHtml, 'text/plain': blobText })];
      
      try {
        await navigator.clipboard.write(data);
        showToast('üìã Â∑≤Ë§áË£Ω (Âê´Ê®£ÂºèÈéñÂÆö)');
      } catch (err) { alert('Ë§áË£ΩÂ§±Êïó'); }
    }

    function downloadTxt() {
      const blob = new Blob([editor.innerText], { type: "text/plain" });
      const a = document.createElement("a"); a.href = URL.createObjectURL(blob); a.download = "draft.txt"; a.click();
    }
    
    function handleClearAction(select) {
      if (!select.value) return;
      if(confirm('Á¢∫ÂÆöË¶ÅÂü∑Ë°åÊ≠§Ê∏ÖÁ©∫Êìç‰ΩúÂóéÔºüÁÑ°Ê≥ïÂæ©Âéü„ÄÇ')) {
        if(select.value === 'source') { source.value = ""; editor.innerText = ""; }
        else if(select.value === 'kw') { kwListArea.value = ""; densityResults.innerHTML = ""; }
        else if(select.value === 'all') { source.value = ""; kwListArea.value = ""; editor.innerText = ""; densityResults.innerHTML = ""; }
        updateCounts(); saveData();
        showToast('üóëÔ∏è Ë≥áÊñôÂ∑≤Ê∏ÖÁ©∫');
      }
      select.value = ""; 
    }

    function toggleTheme() {
      const html = document.documentElement;
      const next = html.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
      html.setAttribute('data-theme', next);
      document.getElementById('moonIcon').classList.toggle('hidden'); document.getElementById('sunIcon').classList.toggle('hidden');
      localStorage.setItem(THEME_KEY, next);
    }

    function switchTab(mode, btn) {
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active')); btn.classList.add('active');
      const ws = document.getElementById('mainWorkspace');
      if (mode === 'preview') ws.classList.add('show-preview'); else ws.classList.remove('show-preview');
    }

    const saved = localStorage.getItem(STORAGE_KEY);
    if (localStorage.getItem(THEME_KEY) === 'dark') toggleTheme();
    if (saved) {
      const data = JSON.parse(saved);
      if(data.source) { source.value = data.source; editor.innerText = data.source; }
      if(data.keywords) { kwListArea.value = data.keywords; runDensityAnalysis(); }
    }
    
    let saveTimeout;
    function saveData() { 
      saveStatus.innerText = "üíæ ÂÑ≤Â≠ò‰∏≠...";
      clearTimeout(saveTimeout);
      saveTimeout = setTimeout(() => {
        localStorage.setItem(STORAGE_KEY, JSON.stringify({ source: source.value, keywords: kwListArea.value }));
        saveStatus.innerText = "‚òÅÔ∏è Â∑≤ÂÑ≤Â≠ò";
      }, 800);
    }
    
    source.addEventListener('input', () => syncPreview());
    kwListArea.addEventListener('input', () => runDensityAnalysis());
    updateCounts(); 
  </script>
</body>
</html>
