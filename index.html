<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ÈóúÈçµÂ≠óËû¢ÂÖâÁ≠Ü Pro (V6.1 Auto-Save)</title>
  
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23374B6D' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='m12 19 7-7 3 3-7 7-3-3Z'/%3E%3Cpath d='m18 13-1.5-7.5L2 2l3.5 14.5L13 18l5-5Z'/%3E%3Cpath d='m2 2 5 2.25'/%3E%3Cpath d='m11 4 2 1.5'/%3E%3C/svg%3E">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Noto+Serif+JP:wght@400;600;900&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  
  <style>
    /* --- Design System: Nippon Colors V6 --- */
    :root {
      --bg-paper: #F9F8F4;      /* ÁîüÊàêËâ≤ (Warm White) */
      --bg-backdrop: #E8E7E3;   /* ÁÅ∞ÁôΩ (Paper Gray) */
      --text-primary: #2C2C2C;  /* Â¢® (Sumi) */
      
      --color-brand: #374B6D;   /* ËóçÈêµ (Aitetsu) */
      --color-accent: #B93A32;  /* Êú±Ëµ§ (Shu-aka) */
      
      --border-soft: #E0E0DE;
    }

    /* --- 1. Global Reset --- */
    html, body { 
      height: 100%; width: 100%; overflow: hidden; 
      font-family: 'Noto Sans JP', sans-serif; 
      background-color: var(--bg-paper); 
      color: var(--text-primary); 
      margin: 0; padding: 0;
    }
    .serif-font { font-family: 'Noto Serif JP', serif; }
    
    .app-container { 
      display: flex; flex-direction: column; height: 100vh; width: 100vw;
    }

    /* --- 2. Header --- */
    .header-area { 
      flex-shrink: 0; height: 64px; z-index: 50; background: #fff; 
      display: flex; align-items: center; justify-content: space-between;
      border-bottom: 1px solid var(--border-soft); padding: 0 24px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.02);
    }

    /* --- 3. Main Workspace --- */
    .main-workspace { 
      display: flex; flex: 1; overflow: hidden; position: relative; 
    }

    /* --- Left: Input Area --- */
    .sidebar-input { 
      width: 380px; height: 100%; background: #fff; border-right: 1px solid var(--border-soft);
      display: flex; flex-direction: column; flex-shrink: 0; z-index: 20;
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .input-group { 
      padding: 24px; border-bottom: 1px solid var(--border-soft); 
      overflow: hidden; display: flex; flex-direction: column; 
    }
    
    textarea { 
      width: 100%; resize: none; border: none; outline: none; background: transparent;
      font-size: 15px; line-height: 1.8; color: #334155; font-weight: 500;
    }
    textarea::placeholder { color: #94a3b8; font-weight: 400; }

    /* Heading Style */
    .label-header { 
      font-size: 13px; font-weight: 800; color: var(--color-brand); 
      text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 14px; 
      display: flex; align-items: center; gap: 8px;
      padding-left: 10px; border-left: 4px solid var(--color-brand); 
      height: 16px; line-height: 1;
    }

    /* --- Right: Preview Area --- */
    .preview-section { 
      flex: 1; 
      display: flex; flex-direction: column; 
      background-color: var(--bg-backdrop); 
      position: relative; overflow: hidden;
    }

    /* Toolbar */
    .inline-toolbar { 
      background: #fff; 
      height: 60px; 
      flex-shrink: 0; 
      padding: 0 20px; display: flex; align-items: center; gap: 14px; 
      box-shadow: 0 4px 12px -2px rgba(0, 0, 0, 0.06); z-index: 40;
      overflow-x: auto;
    }
    
    /* Scrollable Canvas */
    .scrollable-preview-area { 
      flex: 1; overflow-y: auto; overflow-x: hidden;
      display: block; 
      padding: 0; 
      text-align: center;
      background-image: radial-gradient(#d4d4d8 1px, transparent 1px);
      background-size: 24px 24px;
    }

    /* The Paper */
    .editor-paper { 
      display: inline-block; 
      width: 100%; max-width: 820px; 
      min-height: 100%; 
      height: auto !important;
      background: #FFFFFF; 
      padding: 80px 80px 200px 80px; 
      margin: 0 auto; 
      text-align: left;
      
      white-space: pre-wrap; word-wrap: break-word; overflow-wrap: break-word;   
      line-height: 2.3; font-size: 17px; color: #333; font-weight: 500;
      
      box-shadow: 0 0 40px rgba(0,0,0,0.06); 
    }

    /* --- Mobile Logic --- */
    .mobile-tab-bar { display: none; }

    @media (max-width: 768px) {
      .app-container { height: 100%; }
      .header-area { padding: 0 16px; height: 56px; }
      .main-workspace { flex-direction: column; }
      
      .sidebar-input { 
        width: 100%; position: absolute; top: 0; bottom: 56px; left: 0; 
        border-right: none; z-index: 30; transform: translateX(0); 
      }
      .preview-section { 
        width: 100%; position: absolute; top: 0; bottom: 56px; left: 0; 
        z-index: 25; opacity: 0; pointer-events: none; transition: opacity 0.2s;
      }

      .show-preview .sidebar-input { transform: translateX(-100%); opacity: 0; }
      .show-preview .preview-section { opacity: 1; pointer-events: auto; z-index: 35; }

      .editor-paper { width: 100%; padding: 40px 24px 100px 24px; min-height: 100%; }
      .inline-toolbar { padding: 0 12px; gap: 10px; height: 54px; }
      
      .mobile-tab-bar { 
        display: flex; height: 56px; background: #fff; border-top: 1px solid var(--border-soft);
        z-index: 60; width: 100%; flex-shrink: 0;
      }
      .tab-btn { 
        flex: 1; display: flex; align-items: center; justify-content: center; 
        font-weight: 700; color: #94a3b8; font-size: 14px; gap: 8px; transition: 0.2s;
      }
      .tab-btn.active { color: var(--color-brand); background: #f1f5f9; }
    }

    /* --- Print Optimization (New in V6.1) --- */
    @media print {
      html, body { overflow: visible !important; height: auto !important; background: #fff; }
      .app-container { height: auto; display: block; }
      
      /* Hide UI */
      .header-area, .sidebar-input, .inline-toolbar, .status-bar, .mobile-tab-bar { 
        display: none !important; 
      }

      /* Preview Layout for Print */
      .preview-section { 
        position: static; overflow: visible; background: #fff; display: block; 
      }
      .scrollable-preview-area { 
        overflow: visible; padding: 0; display: block; background: none;
      }
      .editor-paper { 
        box-shadow: none; margin: 0; width: 100%; max-width: 100%; padding: 0;
        min-height: 0;
      }
    }

    /* --- Interactive Components --- */
    .icon-btn { 
      padding: 9px; border-radius: 8px; color: #64748b; 
      display: flex; align-items: center; justify-content: center;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      border: 1px solid transparent;
    }
    .icon-btn:hover { 
      background: #f8fafc; color: var(--color-brand); 
      border-color: #e2e8f0; transform: translateY(-1px); 
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    
    .swatch-group { 
      display: flex; align-items: center; gap: 6px; padding: 4px 6px; 
      border-radius: 99px; background: #f8fafc; border: 1px solid #f1f5f9; 
    }
    .swatch-item { 
      width: 26px; height: 26px; border-radius: 50%; border: 2px solid #fff; 
      box-shadow: 0 1px 3px rgba(0,0,0,0.1); cursor: pointer; transition: all 0.2s; 
    }
    .swatch-item:hover { transform: scale(1.2) translateY(-1px); z-index: 10; border-color: #fff; }
    
    .swatch-reset { 
      width: 26px; height: 26px; border-radius: 50%; border: 1px dashed #cbd5e1; 
      display: flex; align-items: center; justify-content: center; color: #64748b; 
      cursor: pointer; transition: 0.2s;
    }
    .swatch-reset:hover { background: #fff; color: #ef4444; border-color: #ef4444; transform: scale(1.1); }

    .btn-emphasis { 
      background: var(--color-accent); color: white; border: none;
      padding: 8px 18px; border-radius: 99px; font-weight: 700; font-size: 13px;
      display: flex; align-items: center; gap: 6px; transition: all 0.2s;
      box-shadow: 0 2px 6px rgba(185, 58, 50, 0.25);
      cursor: pointer;
    }
    .btn-emphasis:hover { 
      background: #9B2C2C; transform: translateY(-1px); 
      box-shadow: 0 4px 12px rgba(185, 58, 50, 0.35); 
    }

    .btn-primary { 
      width: 100%; padding: 14px; border-radius: 10px; 
      background: var(--color-brand); color: white; font-weight: 700;
      display: flex; align-items: center; justify-content: center; gap: 8px; font-size: 14px;
      box-shadow: 0 4px 6px rgba(55, 75, 109, 0.2); transition: all 0.2s;
    }
    .btn-primary:hover { background: #2A3B55; transform: translateY(-1px); box-shadow: 0 6px 12px rgba(55, 75, 109, 0.3); }

    .clear-select-wrapper { position: relative; width: 100%; margin-top: 12px; }
    .clear-select {
      width: 100%; padding: 10px 12px; font-size: 13px; border-radius: 8px;
      border: 1px solid #cbd5e1; color: #475569; background: white; outline: none; cursor: pointer;
      font-weight: 500; transition: border 0.2s;
    }
    .clear-select:hover { border-color: var(--color-brand); }

    .status-bar { 
      height: 42px; background: #fff; border-top: 1px solid var(--border-soft); 
      padding: 0 24px; font-size: 11px; color: #94a3b8; font-weight: 700; 
      display: flex; align-items: center; justify-content: space-between; flex-shrink: 0;
    }
    
    .divider { width: 1px; height: 28px; background: #e2e8f0; margin: 0 8px; flex-shrink: 0; }
  </style>
</head>
<body class="app-container">

  <header class="header-area">
    <div class="flex items-center gap-3">
      <div class="w-10 h-10 border-2 border-[var(--color-brand)] flex items-center justify-center rounded-lg text-[var(--color-brand)]">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="m12 19 7-7 3 3-7 7-3-3Z"/><path d="m18 13-1.5-7.5L2 2l3.5 14.5L13 18l5-5Z"/></svg>
      </div>
      <h1 class="text-xl font-black text-[var(--color-brand)] tracking-[0.15em] serif-font">ËõçÂÖâ„Éö„É≥ PRO</h1>
    </div>
    <button onclick="copyToDocs()" class="px-6 py-2.5 border-2 border-[var(--color-brand)] rounded-full text-xs font-bold text-[var(--color-brand)] hover:bg-[var(--color-brand)] hover:text-white transition-all tracking-widest shadow-sm">
      Ë§áË£ΩÊñáÊ°à
    </button>
  </header>

  <main class="main-workspace" id="mainWorkspace">
    <div class="sidebar-input">
      <div class="input-group" style="flex: 2;">
        <div class="label-header">
          ÂéüÊñáËº∏ÂÖ• (SOURCE)
        </div>
        <textarea id="sourceText" placeholder="Ë´ãÂú®Ê≠§Ë≤º‰∏äÊñáÁ´†ËçâÁ®ø..."></textarea>
      </div>
      
      <div class="input-group bg-slate-50" style="flex: 1;">
        <div class="label-header">
          SEO ÈóúÈçµÂ≠óÂ∫´
        </div>
        <textarea id="kwList" class="h-24 mb-3 text-sm bg-transparent border-b border-dashed border-slate-300 outline-none resize-none font-medium" placeholder="Ëº∏ÂÖ•ÈóúÈçµÂ≠ó (ÊØèË°å‰∏ÄÂÄã)..."></textarea>
        
        <div id="densityResults" class="flex-1 overflow-y-auto mb-3 space-y-1 min-h-0"></div>
        
        <button onclick="runAutoMark()" class="btn-primary">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></svg>
          ‰∏ÄÈçµÊ®ôË®ª (Auto Mark)
        </button>
        
        <div class="clear-select-wrapper">
          <select id="clearMenu" class="clear-select" onchange="handleClearAction(this)">
            <option value="" disabled selected>üóëÔ∏è Ê∏ÖÁ©∫ÈáçÁΩÆÈÅ∏ÂñÆ...</option>
            <option value="kw">Ê∏ÖÁ©∫ÈóúÈçµÂ≠ó</option>
            <option value="source">Ê∏ÖÁ©∫ÂéüÊñáÂÖßÂÆπ</option>
            <option value="format">Ê∏ÖÈô§Ê†ºÂºè (ËÆäÂõûÁ¥îÊñáÂ≠ó)</option>
            <option value="all" class="text-red-600 font-bold">‚ö†Ô∏è ÂÖ®ÈÉ®Ê∏ÖÁ©∫ÈáçÁΩÆ</option>
          </select>
        </div>
      </div>
    </div>

    <div class="preview-section">
      <div class="inline-toolbar">
        <button onmousedown="event.preventDefault(); cmd('undo')" class="icon-btn" title="Âæ©Âéü"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 7v6h6"/><path d="M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"/></svg></button>
        <button onmousedown="event.preventDefault(); cmd('redo')" class="icon-btn" title="ÈáçÂÅö"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 7v6h-6"/><path d="M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3L21 13"/></svg></button>
        
        <div class="divider"></div>
        
        <div class="swatch-group" title="ÊñáÂ≠óÈ°èËâ≤">
           <div class="swatch-item bg-[#2C2C2C]" title="Â¢®" onmousedown="event.preventDefault(); applyColor('#2C2C2C')"></div>
           <div class="swatch-item bg-[#B93A32]" title="Êú±Ëµ§" onmousedown="event.preventDefault(); applyColor('#B93A32')"></div>
           <div class="swatch-item bg-[#374B6D]" title="ËóçÈêµ" onmousedown="event.preventDefault(); applyColor('#374B6D')"></div>
           <div class="swatch-item bg-[#3F6C45]" title="Â∏∏Áõ§" onmousedown="event.preventDefault(); applyColor('#3F6C45')"></div>
           <div class="swatch-item bg-[#6A4C9C]" title="Ê∑±Á¥´" onmousedown="event.preventDefault(); applyColor('#6A4C9C')"></div>
           <button onmousedown="event.preventDefault(); cmd('removeFormat')" class="swatch-reset" title="Ê∏ÖÈô§Ê†ºÂºè"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
        </div>

        <div class="divider"></div>

        <div class="swatch-group" title="Ëû¢ÂÖâÁ≠ÜËÉåÊôØ">
          <div class="swatch-item bg-[#FEECEC]" title="Ê´ªËâ≤" onmousedown="event.preventDefault(); applyHilite('#FEECEC')"></div>
          <div class="swatch-item bg-[#FFF9C4]" title="ËèúËä±" onmousedown="event.preventDefault(); applyHilite('#FFF9C4')"></div>
          <div class="swatch-item bg-[#D1EAED]" title="Ê∞¥Ëâ≤" onmousedown="event.preventDefault(); applyHilite('#D1EAED')"></div>
          <div class="swatch-item bg-[#E0EBDF]" title="Ëã•Ëãó" onmousedown="event.preventDefault(); applyHilite('#E0EBDF')"></div>
          <div class="swatch-item bg-[#E6E6FA]" title="Ëó§Ëâ≤" onmousedown="event.preventDefault(); applyHilite('#E6E6FA')"></div>
          <button onmousedown="event.preventDefault(); applyHilite('transparent')" class="swatch-reset" title="ÁÑ°ËÉåÊôØ"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
        </div>
        
        <div class="divider"></div>
        <button onmousedown="event.preventDefault(); applyRedBold()" class="btn-emphasis">A+ ÈáçÈªû</button>
      </div>

      <div class="scrollable-preview-area">
        <div id="editor" contenteditable="true" class="editor-paper serif-font" placeholder="Á¥ôÂºµ„Å´Á≠Ü„ÇíËµ∞„Çâ„Åõ„Çã„Çà„ÅÜ„Å´..."></div>
      </div>
      
      <footer class="status-bar">
        <div class="flex gap-4">
          <span>Â≠óÊï∏: <span id="totalCount" class="text-slate-900 font-bold">0</span></span>
          <span>ÈÅ∏Âèñ: <span id="selectCount" class="text-slate-900 font-bold">0</span></span>
        </div>
        <div class="opacity-50 text-[10px] md:text-xs font-sans">
          ¬© 2025 Kaoru Tsai. All Rights Reserved.
        </div>
      </footer>
    </div>
  </main>

  <div class="mobile-tab-bar">
    <button class="tab-btn active" onclick="switchTab('input', this)">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
      Á∑®ËºØËº∏ÂÖ•
    </button>
    <button class="tab-btn" onclick="switchTab('preview', this)">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>
      È†êË¶ΩÁï´Â∏É
    </button>
  </div>

  <script>
    // --- Logic Core ---
    const editor = document.getElementById('editor'); 
    const source = document.getElementById('sourceText');
    const totalCount = document.getElementById('totalCount'); 
    const selectCount = document.getElementById('selectCount');
    const kwListArea = document.getElementById('kwList'); 
    const densityResults = document.getElementById('densityResults');
    const STORAGE_KEY = 'highlight_pro_v6_data';

    function cmd(command, value = null) {
      editor.focus();
      document.execCommand(command, false, value);
      updateCounts(); 
    }

    function applyColor(hex) { cmd('foreColor', hex); }
    
    function applyHilite(hex) {
      if (!document.execCommand('hiliteColor', false, hex)) {
        document.execCommand('backColor', false, hex); 
      }
      editor.focus();
    }

    function applyRedBold() {
      editor.focus();
      document.execCommand('bold');
      applyColor('#B93A32');
    }

    function switchTab(mode, btn) {
      const workspace = document.getElementById('mainWorkspace');
      const buttons = document.querySelectorAll('.tab-btn');
      
      buttons.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');

      if (mode === 'preview') {
        workspace.classList.add('show-preview');
        if (window.innerWidth < 768) {
             document.querySelector('.scrollable-preview-area').scrollTop = 0;
        }
      } else {
        workspace.classList.remove('show-preview');
      }
    }

    // Sync Logic
    function syncPreview() {
      editor.innerText = source.value; 
      updateCounts();
      runDensityAnalysis();
      saveData(); // Auto-save on input
    }

    function updateCounts() {
      totalCount.innerText = editor.innerText.replace(/\s/g, '').length;
    }

    document.addEventListener('selectionchange', () => {
      const sel = window.getSelection().toString();
      selectCount.innerText = sel.replace(/\s/g, '').length;
    });

    function getUniqueKeywords() {
      const raw = kwListArea.value.split('\n');
      const cleaned = raw.map(k => k.trim()).filter(k => k !== "");
      return [...new Set(cleaned)];
    }

    function runDensityAnalysis() {
      const keywords = getUniqueKeywords(); 
      const content = editor.innerText || "";
      const totalChars = content.length;
      
      densityResults.innerHTML = "";
      if (totalChars === 0 && keywords.length > 0) return;

      keywords.forEach(kw => {
        const regex = new RegExp(kw.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'gi');
        const count = (content.match(regex) || []).length;
        const density = ((count * kw.length / totalChars) * 100).toFixed(1);
        
        let badgeClass = "bg-gray-100 text-gray-600";
        if (density > 0) badgeClass = "bg-blue-50 text-blue-600";
        if (density > 3) badgeClass = "bg-red-50 text-red-600";

        const div = document.createElement('div');
        div.className = "flex justify-between items-center text-xs border-b border-gray-100 pb-2 pt-2";
        div.innerHTML = `
          <span class="text-slate-600 truncate mr-2 font-bold" title="${kw}">${kw}</span>
          <span class="px-2 py-0.5 rounded-full ${badgeClass} font-mono font-bold text-[10px]">${density}%</span>
        `;
        densityResults.appendChild(div);
      });
      saveData(); // Auto-save keywords
    }

    function runAutoMark() {
      const keywords = getUniqueKeywords(); 
      if (keywords.length === 0) {
        alert("Ë´ãÂÖàËº∏ÂÖ•ÈóúÈçµÂ≠ó");
        return;
      }

      let html = editor.innerText;
      html = html.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");

      keywords.forEach(kw => {
        const cleanKw = kw.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'); 
        const regex = new RegExp(`(${cleanKw})`, 'gi');
        html = html.replace(regex, `<span style="color:#B93A32; font-weight:bold; text-decoration: underline; text-decoration-style: dashed; text-decoration-color: #B93A32;">$1</span>`);
      });
      
      editor.innerHTML = html;
      updateCounts();
      
      if (window.innerWidth < 768) {
         const previewBtn = document.querySelectorAll('.tab-btn')[1];
         switchTab('preview', previewBtn);
      }
    }

    function handleClearAction(select) {
      const val = select.value;
      if (!val) return; 

      if (confirm(`Á¢∫ÂÆöË¶ÅÂü∑Ë°å„Äå${select.options[select.selectedIndex].text}„ÄçÂóéÔºü`)) {
        if (val === 'kw') {
          kwListArea.value = "";
          densityResults.innerHTML = "";
        } else if (val === 'source') {
          source.value = "";
          editor.innerText = ""; 
        } else if (val === 'format') {
          const text = editor.innerText;
          editor.innerHTML = text; 
        } else if (val === 'all') {
          source.value = "";
          kwListArea.value = "";
          editor.innerHTML = "";
          densityResults.innerHTML = "";
        }
        updateCounts();
        saveData(); // Sync clear to storage
      }
      select.value = "";
    }

    async function copyToDocs() {
      const blobHtml = new Blob([editor.innerHTML], { type: 'text/html' });
      const blobText = new Blob([editor.innerText], { type: 'text/plain' });
      const data = [new ClipboardItem({ 'text/html': blobHtml, 'text/plain': blobText })];
      
      try {
        await navigator.clipboard.write(data);
        const btn = document.querySelector('header button');
        const oldText = btn.innerText;
        btn.innerText = "‚ú® Â∑≤Ë§áË£Ω";
        btn.classList.add("bg-[#374B6D]", "text-white");
        setTimeout(() => {
           btn.innerText = oldText;
           btn.classList.remove("bg-[#374B6D]", "text-white");
        }, 2000);
      } catch (err) {
        alert('Ë§áË£ΩÂ§±ÊïóÔºåË´ãÊâãÂãïË§áË£Ω„ÄÇ');
      }
    }

    // --- Auto-Save System ---
    function loadSavedData() {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (saved) {
        try {
          const data = JSON.parse(saved);
          if (data.source) {
             source.value = data.source;
             editor.innerText = data.source; 
          }
          if (data.keywords) {
             kwListArea.value = data.keywords;
             runDensityAnalysis(); // Re-run analysis on load
          }
          updateCounts();
        } catch (e) { console.error("ËÆÄÂèñÂ≠òÊ™îÂ§±Êïó", e); }
      }
    }

    let saveTimeout;
    function saveData() {
      clearTimeout(saveTimeout);
      saveTimeout = setTimeout(() => {
        const data = {
          source: source.value,
          keywords: kwListArea.value
        };
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
      }, 500);
    }

    // Init
    loadSavedData();
    source.addEventListener('input', () => { syncPreview(); }); // Additional bind
    kwListArea.addEventListener('input', () => { runDensityAnalysis(); }); // Additional bind
  </script>
</body>
</html>
