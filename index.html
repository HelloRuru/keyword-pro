<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>è›å…‰ãƒšãƒ³ PRO - SEOæ–‡æ¡ˆæ•¸ä½å·¥å…·</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>âœ’ï¸</text></svg>">
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Shippori+Mincho:wght@400;600;800&family=Zen+Kaku+Gothic+New:wght@300;400;500;700&display=swap" rel="stylesheet">

<style>
  /* --- ğŸŸ¢ è‰²ç¥¨ç³»çµ± (Japan Traditional Colors) --- */
  :root {
    /* èƒŒæ™¯ï¼šç”Ÿæˆè‰² (Kinari-iro) - ä»¿èˆŠç´™å¼µæ„Ÿ */
    --bg-canvas: #FBFBF6;
    --bg-sidebar: #FCFCFA;
    
    /* 1. å¢¨è‰² (Sumi) - å…§æ–‡ä¸»è‰² */
    --color-ink: #303133; 
    
    /* 2. æ·±ç·‹ (Kokiake) - é‡é»è‰²/Logo */
    --color-accent: #C9171E; 
    
    /* 3. è—é‰„ (Aitetsu) - æ¨™é¡Œè‰² */
    --color-sub: #393F4C;
    
    /* 4. åˆˆå®‰è‰² (Kariyasu) - è¢å…‰ç­†é»ƒ */
    --hl-yellow: #F0DC70;
    
    /* 5. ä¸€æ–¤æŸ“ (Ikkonzome) - è¢å…‰ç­†ç²‰ */
    --hl-pink: #F5B199;

    /* é›œé»ç´‹ç† */
    --noise: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.04'/%3E%3C/svg%3E");
  }

  /* --- åŸºç¤è¨­å®š --- */
  body {
    background-color: var(--bg-canvas);
    color: var(--color-ink);
    font-family: 'Zen Kaku Gothic New', sans-serif;
    height: 100vh; overflow: hidden; display: flex; flex-direction: column;
  }
  
  .bg-noise { position: fixed; inset: 0; background-image: var(--noise); pointer-events: none; z-index: -1; }
  .font-serif { font-family: 'Shippori Mincho', serif; }
  .icon-line { width: 18px; height: 18px; stroke-width: 1.5px; stroke: currentColor; fill: none; stroke-linecap: round; stroke-linejoin: round; }

  /* --- å·¦å´ï¼šè¼¸å…¥å€ (æ¥µç°¡é¢¨æ ¼) --- */
  .input-group-label {
    font-family: 'Shippori Mincho', serif; font-weight: 700; color: var(--color-sub);
    font-size: 0.85rem; letter-spacing: 0.1em; margin-bottom: 0.5rem;
    display: flex; align-items: center; gap: 6px;
  }
  .input-field {
    width: 100%; background: #FFFFFF;
    border: 1px solid #E6E6E6; border-radius: 4px;
    padding: 16px; font-size: 15px; color: var(--color-ink); line-height: 1.8;
    transition: all 0.3s ease; resize: none; outline: none;
    font-family: 'Zen Kaku Gothic New', sans-serif;
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.02);
  }
  .input-field:focus { border-color: var(--color-sub); background: #FFFEFA; box-shadow: inset 0 2px 4px rgba(0,0,0,0.01); }

  /* --- å³å´ï¼šé è¦½å€ (é›œèªŒé¢¨æ ¼) --- */
  .editor-paper {
    width: 100%; max-width: 800px; min-height: 80vh;
    background: #FFFFFF; padding: 60px 80px; 
    /* æŸ”å’Œçš„æ“´æ•£é™°å½±ï¼Œç‡Ÿé€ ç´™å¼µæµ®èµ·æ„Ÿ */
    box-shadow: 0 5px 30px rgba(0,0,0,0.04);
    outline: none;
    /* ğŸŸ¢ æ ¸å¿ƒæ’ç‰ˆåƒæ•¸ */
    font-family: 'Zen Kaku Gothic New', sans-serif;
    font-size: 11.5pt; line-height: 2.2; color: var(--color-ink);
    letter-spacing: 0.04em; text-align: justify;
  }
  /* æ¨™é¡Œå¼·åˆ¶ä½¿ç”¨è¥¯ç·šé«” */
  .editor-paper h2, .editor-paper h3 { font-family: 'Shippori Mincho', serif; letter-spacing: 0.05em; color: var(--color-sub); }
  .editor-paper h2 { font-size: 1.6em; margin-top: 1.5em; margin-bottom: 0.8em; border-bottom: 2px solid #F0F0F0; padding-bottom: 10px; }
  .editor-paper h3 { font-size: 1.3em; margin-top: 1.2em; margin-bottom: 0.5em; position: relative; padding-left: 12px; border-left: 4px solid var(--color-accent); }
  .editor-paper p { margin-bottom: 1.5em; }

  /* --- å·¥å…·åˆ— --- */
  .toolbar-wrapper {
    position: sticky; top: 0; z-index: 40;
    background: rgba(251, 251, 246, 0.95); backdrop-filter: blur(5px);
    border-bottom: 1px solid #EBEBEB;
    display: flex; justify-content: center; padding: 8px 16px;
  }
  .toolbar {
    display: flex; align-items: center; gap: 8px; flex-wrap: nowrap;
    overflow-x: auto; padding: 4px; border-radius: 8px;
    background: white; border: 1px solid #E0E0E0; box-shadow: 0 2px 6px rgba(0,0,0,0.03);
  }
  .btn-tool {
    display: flex; align-items: center; justify-content: center;
    min-width: 32px; height: 32px; padding: 0 10px;
    background: white; border: 1px solid transparent; border-radius: 4px;
    font-size: 13px; font-family: 'Shippori Mincho', serif; color: #555;
    cursor: pointer; transition: all 0.2s; white-space: nowrap; flex-shrink: 0;
  }
  .btn-tool:hover { background: #F7F7F7; border-color: #EEE; }
  .btn-tool.active { background: #F0F0F0; font-weight: bold; }
  
  /* è‰²ç¥¨æŒ‰éˆ• */
  .color-dot { 
    width: 22px; height: 22px; border-radius: 50%; 
    border: 2px solid white; box-shadow: 0 0 0 1px #DDD; 
    cursor: pointer; transition: transform 0.2s; position: relative;
  }
  .color-dot:hover { transform: scale(1.15); z-index: 10; }
  .color-dot::after { /* Tooltip */
    content: attr(title); position: absolute; bottom: 120%; left: 50%; transform: translateX(-50%);
    background: #333; color: white; font-size: 10px; padding: 4px 6px; border-radius: 4px;
    white-space: nowrap; opacity: 0; pointer-events: none; transition: opacity 0.2s;
  }
  .color-dot:hover::after { opacity: 1; }

  /* --- æŒ‰éˆ•ç³»çµ± --- */
  .btn-primary {
    width: 100%; background: var(--color-accent); color: white; border: none; padding: 12px;
    border-radius: 4px; font-family: 'Shippori Mincho', serif; letter-spacing: 0.1em; font-weight: 600;
    cursor: pointer; box-shadow: 0 4px 12px rgba(201, 23, 30, 0.2); transition: 0.2s;
    display: flex; align-items: center; justify-content: center; gap: 8px;
  }
  .btn-primary:hover { filter: brightness(1.1); }
  .btn-primary:active { transform: translateY(1px); }

  .btn-outline {
    flex: 1; background: white; border: 1px solid #DDD; color: #666;
    padding: 8px; border-radius: 4px; font-size: 13px; cursor: pointer; transition: 0.2s;
    font-family: 'Zen Kaku Gothic New', sans-serif;
  }
  .btn-outline:hover { border-color: var(--color-sub); color: var(--color-sub); }

  /* --- RWD / Mobile --- */
  .mobile-nav {
    display: none; position: fixed; bottom: 0; left: 0; right: 0; height: 60px;
    background: white; border-top: 1px solid #E0E0E0; z-index: 50;
    padding-bottom: env(safe-area-inset-bottom);
  }
  .nav-item {
    flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center;
    font-size: 10px; color: #999; gap: 4px; cursor: pointer;
  }
  .nav-item.active { color: var(--color-accent); font-weight: bold; }
  
  /* æ–·é»æ§åˆ¶ */
  @media (max-width: 768px) {
    .mobile-nav { display: flex; }
    #sectionInput, #sectionPreview { width: 100% !important; height: calc(100vh - 60px - 60px); } /* Header + Nav */
    .editor-paper { padding: 30px 20px; font-size: 11pt; }
    .toolbar-wrapper { padding: 8px 10px; overflow-x: auto; justify-content: flex-start; }
    .d-none-mobile { display: none !important; }
  }
  @media (min-width: 769px) {
    #sectionInput { display: flex !important; }
    #sectionPreview { display: flex !important; }
  }

  /* ç‹€æ…‹æ¨™ç±¤ */
  .status-pill {
    font-size: 11px; padding: 4px 10px; border-radius: 20px; border: 1px solid;
    display: flex; align-items: center; gap: 5px; font-weight: 500;
  }
  .status-sync { background: #EDF7F6; color: #356859; border-color: #B2D8D2; }
  .status-manual { background: #FFF8E1; color: #8D6E63; border-color: #FFE082; }

  .toast {
    position: fixed; top: 80px; left: 50%; transform: translateX(-50%);
    background: #333; color: white; padding: 10px 20px; border-radius: 50px;
    font-size: 13px; opacity: 0; pointer-events: none; transition: opacity 0.3s; z-index: 100;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15); display: flex; align-items: center; gap: 8px;
  }
</style>
</head>
<body>
  <div class="bg-noise"></div>

  <header class="h-16 flex items-center px-6 border-b border-[#EAEAEA] bg-[#FCFCFA]/95 flex-shrink-0 justify-between z-50">
     <div class="flex items-center gap-3">
       <div class="w-8 h-8 rounded bg-[var(--color-accent)] text-white flex items-center justify-center">
         <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg>
       </div>
       <div>
         <h1 class="font-serif font-bold text-lg text-[var(--color-ink)] tracking-widest leading-none">è›å…‰ãƒšãƒ³ <span class="text-xs font-sans font-normal text-gray-400 ml-1">PRO</span></h1>
       </div>
     </div>
     <div class="hidden md:flex text-xs text-gray-400 font-serif tracking-wider">SEO COPYWRITING TOOL</div>
  </header>

  <div class="flex-1 flex flex-col md:flex-row overflow-hidden relative">
    
    <aside id="sectionInput" class="w-full md:w-[400px] bg-[var(--bg-sidebar)] border-r border-[#EAEAEA] flex flex-col z-20 flex-shrink-0 h-full overflow-hidden">
      <div class="p-6 flex flex-col h-full overflow-y-auto custom-scroll">
         <div class="flex-col flex min-h-[200px] flex-shrink-0 mb-6">
           <div class="input-group-label">
             <span class="w-1 h-4 bg-[var(--color-sub)] rounded-sm"></span> åŸæ–‡è¼¸å…¥ (DRAFT)
           </div>
           <textarea id="sourceText" class="input-field flex-1 min-h-[220px]" placeholder="è«‹åœ¨æ­¤è²¼ä¸Šæˆ–è¼¸å…¥æ–‡ç« ...&#10;æ”¯æ´è‡ªå‹•æ®µè½èˆ‡å³æ™‚åŒæ­¥ã€‚"></textarea>
         </div>
         
         <div class="flex-col flex flex-shrink-0 mb-6">
            <div class="input-group-label">
              <span class="w-1 h-4 bg-[var(--color-accent)] rounded-sm"></span> SEO é—œéµå­— (KEYWORDS)
            </div>
            <textarea id="kwList" class="input-field h-24" placeholder="æ¯è¡Œä¸€å€‹é—œéµå­—&#10;ç³»çµ±å°‡è‡ªå‹•æ¨™ç¤ºç´…è‰²é‡é»..."></textarea>
         </div>

         <div class="mt-auto pt-4 pb-20 md:pb-0">
           <button onclick="forceSync()" class="btn-primary mb-3">
             <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
             ä¸€éµæ³¨å…¥æ¨£å¼ (Sync Styles)
           </button>
           <div class="flex gap-3">
             <button onclick="downloadTxt()" class="btn-outline">ä¸‹è¼‰ TXT</button>
             <button onclick="clearAll()" class="btn-outline hover:text-red-600 hover:border-red-200">æ¸…ç©º</button>
           </div>
         </div>
      </div>
    </aside>

    <main id="sectionPreview" class="flex-1 flex flex-col bg-[#F7F6F2] relative min-w-0 h-full d-none-mobile">
      
      <div class="toolbar-wrapper">
        <div class="toolbar">
          <button onclick="execCmd('formatBlock', 'h2')" class="btn-tool" title="å¤§æ¨™é¡Œ">H2</button>
          <button onclick="execCmd('formatBlock', 'h3')" class="btn-tool" title="ä¸­æ¨™é¡Œ">H3</button>
          <button onclick="execCmd('formatBlock', 'p')" class="btn-tool" title="å…§æ–‡">å…§æ–‡</button>
          <div class="w-px h-5 bg-gray-200 mx-1"></div>
          
          <div onclick="applyColor('#303133')" class="color-dot bg-[#303133]" title="å¢¨è‰² (å…§æ–‡)"></div>
          <div onclick="applyColor('#393F4C')" class="color-dot bg-[#393F4C]" title="è—é‰„ (æ¨™é¡Œ)"></div>
          <div onclick="applyColor('#C9171E')" class="color-dot bg-[#C9171E]" title="æ·±ç·‹ (é‡é»)"></div>
          
          <div class="w-px h-5 bg-gray-200 mx-1"></div>
          
          <div onclick="applyHighlight('#F0DC70')" class="color-dot bg-[#F0DC70]" title="åˆˆå®‰ (é»ƒè¢å…‰)"></div>
          <div onclick="applyHighlight('#F5B199')" class="color-dot bg-[#F5B199]" title="ä¸€æ–¤æŸ“ (ç²‰è¢å…‰)"></div>

          <div class="w-px h-5 bg-gray-200 mx-1"></div>
          
          <button onclick="document.execCommand('undo')" class="btn-tool" title="å¾©åŸ"><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"></path></svg></button>
          <button onclick="copyForGoogleDocs()" class="btn-tool text-[var(--color-accent)] font-bold border-l border-gray-100 pl-3">
            <svg class="w-4 h-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path></svg>
            è¤‡è£½
          </button>
        </div>
      </div>

      <div class="flex-1 overflow-y-auto flex flex-col items-center pb-32 pt-6 scroll-smooth px-4 md:px-0">
        <div id="editor" contenteditable="true" class="editor-paper" placeholder="é è¦½å…§å®¹..."></div>
        
        <div class="w-full max-w-[800px] flex justify-between items-center text-xs text-gray-400 px-4 mt-4 select-none">
           <div id="charCount">0 å­—</div>
           <div id="syncStatus" class="status-pill status-sync">
              <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>
              è‡ªå‹•åŒæ­¥ä¸­
           </div>
        </div>
      </div>
    </main>
  </div>

  <nav class="mobile-nav">
    <div id="navInput" class="nav-item active" onclick="switchMobileTab('input')">
      <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
      <span>ç·¨è¼¯</span>
    </div>
    <div id="navPreview" class="nav-item" onclick="switchMobileTab('preview')">
      <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 5 8.268 7.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>
      <span>é è¦½</span>
    </div>
  </nav>

  <div id="toast">
    <span id="toastIcon">ğŸ“‹</span> <span id="toastMsg">å·²è¤‡è£½</span>
  </div>

  <script>
    // --- æ ¸å¿ƒè®Šæ•¸ ---
    const source = document.getElementById('sourceText');
    const kwList = document.getElementById('kwList');
    const editor = document.getElementById('editor');
    const syncStatusLabel = document.getElementById('syncStatus');
    const charCount = document.getElementById('charCount');

    // ç‹€æ…‹æ©Ÿ
    let isAutoSync = true;
    let syncTimer;

    // --- åˆå§‹åŒ– ---
    window.addEventListener('DOMContentLoaded', () => {
      if(localStorage.getItem('fp_src')) source.value = localStorage.getItem('fp_src');
      if(localStorage.getItem('fp_kw')) kwList.value = localStorage.getItem('fp_kw');
      
      // å¦‚æœæœ‰ç·©å­˜çš„ HTMLï¼Œå„ªå…ˆè¼‰å…¥ï¼ˆé¿å…é‡ç½®æ‰‹å‹•æ ¼å¼ï¼‰
      if(localStorage.getItem('fp_html')) {
        editor.innerHTML = localStorage.getItem('fp_html');
        // æª¢æŸ¥æ˜¯å¦èˆ‡ Source ä¸åŒï¼Œä¸åŒå‰‡æš«åœåŒæ­¥
        if(editor.innerText.trim() !== source.value.trim()) pauseSync();
      } else {
        runSync(true);
      }
      updateCount();
    });

    // --- åŒæ­¥é‚è¼¯ (Sync Engine) ---
    function runSync(silent = false) {
      if (!isAutoSync) return;
      
      const text = source.value;
      const kws = kwList.value.split('\n').filter(k => k.trim());
      
      if(!text) {
        if(!silent) editor.innerHTML = '<span style="color:#ccc">ç­‰å¾…è¼¸å…¥...</span>';
        return;
      }

      // 1. è½‰ç¾© HTML
      let html = text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
      
      // 2. é—œéµå­—æ¨™ç´… (ä½¿ç”¨ span å…§è¯æ¨£å¼ï¼Œç¢ºä¿ copy ç›¸å®¹)
      kws.forEach(kw => {
        const regex = new RegExp(`(${kw})`, 'gi');
        // color: #C9171E (æ·±ç·‹)
        html = html.replace(regex, `<span style="color: #C9171E; font-weight: bold;">$1</span>`);
      });

      // 3. æ›è¡Œè½‰ P æ¨™ç±¤ (ç¢ºä¿çµæ§‹)
      // ç°¡å–®è™•ç†ï¼šé›™æ›è¡Œè®Š Pï¼Œå–®æ›è¡Œè®Š BR
      const paragraphs = html.split(/\n\s*\n/);
      const finalHtml = paragraphs.map(p => {
        if(!p.trim()) return '';
        return `<p style="margin-bottom: 1.5em;">${p.replace(/\n/g, '<br>')}</p>`;
      }).join('');

      editor.innerHTML = finalHtml;
      saveData();
      updateCount();
      if(!silent) showToast('success', 'åŒæ­¥å®Œæˆ');
    }

    // --- ç›£è½å™¨ ---
    source.addEventListener('input', () => {
      if(isAutoSync) {
        clearTimeout(syncTimer);
        syncTimer = setTimeout(() => runSync(true), 300);
      }
      saveData();
    });

    kwList.addEventListener('input', () => {
      if(isAutoSync) {
        clearTimeout(syncTimer);
        syncTimer = setTimeout(() => runSync(true), 300);
      }
      saveData();
    });

    // ç·¨è¼¯å™¨ä¸€æ—¦æ‰‹å‹•ä¿®æ”¹ï¼Œç«‹å³é–å®šåŒæ­¥
    editor.addEventListener('input', () => {
      pauseSync();
      saveData();
      updateCount();
    });

    // --- åŠŸèƒ½å‡½å¼ ---
    function forceSync() {
      isAutoSync = true;
      updateSyncUI();
      runSync();
      // æ‰‹æ©Ÿç‰ˆè‡ªå‹•åˆ‡æ›åˆ°é è¦½
      if(window.innerWidth < 768) switchMobileTab('preview');
    }

    function pauseSync() {
      if(isAutoSync) {
        isAutoSync = false;
        updateSyncUI();
      }
    }

    function updateSyncUI() {
      if(isAutoSync) {
        syncStatusLabel.className = 'status-pill status-sync';
        syncStatusLabel.innerHTML = `<svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg> è‡ªå‹•åŒæ­¥ä¸­`;
      } else {
        syncStatusLabel.className = 'status-pill status-manual';
        syncStatusLabel.innerHTML = `ğŸ”’ æ‰‹å‹•ç·¨è¼¯æ¨¡å¼`;
      }
    }

    // --- ç·¨è¼¯å™¨æŒ‡ä»¤ (ExecCommand - æœ€ç©©å®šçš„æ–¹æ¡ˆ) ---
    function execCmd(cmd, val = null) {
      pauseSync(); // ä»»ä½•æ ¼å¼æ“ä½œéƒ½è¦–ç‚ºæ‰‹å‹•ä»‹å…¥
      document.execCommand(cmd, false, val);
      
      // ä¿®è£œï¼šå¦‚æœæ˜¯ formatBlockï¼Œé€šå¸¸ç€è¦½å™¨ä¸æœƒåŠ ä¸Š classï¼Œæˆ‘å€‘é€™è£¡è£œä¸Š inline styles
      if(cmd === 'formatBlock') {
        const sel = window.getSelection();
        if(sel.rangeCount > 0) {
          const node = sel.anchorNode.parentNode;
          // é‡å° H2, H3 è£œä¸Šæ¨£å¼ (ç‚ºäº† Copy åˆ° Google Docs)
          if(node.tagName === 'H2') {
             node.style.cssText = "font-family: 'Shippori Mincho', serif; font-size: 1.6em; color: #393F4C; border-bottom: 2px solid #EEE; padding-bottom: 5px; margin-top: 24px;";
          } else if (node.tagName === 'H3') {
             node.style.cssText = "font-family: 'Shippori Mincho', serif; font-size: 1.3em; color: #393F4C; border-left: 4px solid #C9171E; padding-left: 10px; margin-top: 20px;";
          }
        }
      }
      saveData();
    }

    function applyColor(hex) {
      pauseSync();
      document.execCommand('foreColor', false, hex);
    }

    function applyHighlight(hex) {
      pauseSync();
      // å˜—è©¦ä½¿ç”¨ hiliteColor (èƒŒæ™¯è‰²)
      if (!document.execCommand('hiliteColor', false, hex)) {
        document.execCommand('backColor', false, hex);
      }
    }

    // --- Google Docs è¤‡è£½å„ªåŒ– (Critical) ---
    async function copyForGoogleDocs() {
      // 1. å»ºç«‹ä¸€å€‹ä¹¾æ·¨çš„å®¹å™¨
      const wrapper = document.createElement('div');
      
      // 2. è¤‡è£½ç·¨è¼¯å™¨å…§å®¹
      // ç‚ºäº†ç¢ºä¿å­—é«”åœ¨ Docs é¡¯ç¤ºæ­£å¸¸ï¼Œæˆ‘å€‘éœ€è¦åœ¨é€™è£¡å¼·åˆ¶æ³¨å…¥å…¨å±€æ¨£å¼
      // æ³¨æ„ï¼šGoogle Docs å–œæ­¡ Inline Styles
      const content = editor.cloneNode(true);
      
      // éæ­·æ‰€æœ‰ç¯€é»ï¼Œç¢ºä¿å­—é«”è¨­å®šæ­£ç¢º
      const walker = document.createTreeWalker(content, NodeFilter.SHOW_ELEMENT);
      while(walker.nextNode()) {
        const node = walker.currentNode;
        // å¦‚æœæ²’æœ‰æŒ‡å®šå­—é«”ï¼Œè£œä¸Šé€šç”¨å­—é«”
        if (!node.style.fontFamily) {
           // å„ªå…ˆä½¿ç”¨ç„¡è¥¯ç·šï¼Œæ¨™é¡Œä½¿ç”¨è¥¯ç·š
           if(['H1','H2','H3'].includes(node.tagName)) {
             node.style.fontFamily = "'Shippori Mincho', 'Times New Roman', serif";
           } else {
             node.style.fontFamily = "'Zen Kaku Gothic New', 'Arial', sans-serif";
             node.style.lineHeight = "2.0";
           }
        }
      }
      
      wrapper.innerHTML = content.innerHTML;
      wrapper.style.cssText = "background: white; color: #303133;";

      try {
        const htmlBlob = new Blob([wrapper.outerHTML], { type: 'text/html' });
        const textBlob = new Blob([editor.innerText], { type: 'text/plain' });
        
        await navigator.clipboard.write([
          new ClipboardItem({ 
            'text/html': htmlBlob,
            'text/plain': textBlob 
          })
        ]);
        showToast('success', 'å·²è¤‡è£½ï¼å¯ç›´æ¥è²¼ä¸Š Google Docs');
      } catch (err) {
        console.error(err);
        showToast('error', 'è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•å…¨é¸è¤‡è£½');
      }
    }

    // --- RWD åˆ‡æ› ---
    function switchMobileTab(tab) {
      const sectionInput = document.getElementById('sectionInput');
      const sectionPreview = document.getElementById('sectionPreview');
      const navInput = document.getElementById('navInput');
      const navPreview = document.getElementById('navPreview');

      if(tab === 'input') {
        sectionInput.classList.remove('d-none-mobile');
        sectionPreview.classList.add('d-none-mobile');
        navInput.classList.add('active');
        navPreview.classList.remove('active');
      } else {
        sectionInput.classList.add('d-none-mobile');
        sectionPreview.classList.remove('d-none-mobile');
        navInput.classList.remove('active');
        navPreview.classList.add('active');
        // å¦‚æœé è¦½æ˜¯ç©ºçš„ï¼Œè‡ªå‹•è·‘ä¸€æ¬¡åŒæ­¥
        if(!editor.innerText.trim()) runSync(true);
      }
    }

    // --- è¼”åŠ© ---
    function downloadTxt() {
      const a = document.createElement("a");
      const blob = new Blob([source.value], {type: "text/plain;charset=utf-8"});
      a.href = URL.createObjectURL(blob);
      a.download = `draft-${new Date().toISOString().slice(0,10)}.txt`;
      a.click();
    }

    function clearAll() {
      if(confirm('ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰å…§å®¹å—ï¼Ÿ')) {
        source.value = '';
        kwList.value = '';
        editor.innerHTML = '';
        localStorage.clear();
        isAutoSync = true;
        updateSyncUI();
        updateCount();
      }
    }

    function saveData() {
      localStorage.setItem('fp_src', source.value);
      localStorage.setItem('fp_kw', kwList.value);
      localStorage.setItem('fp_html', editor.innerHTML);
    }

    function updateCount() {
      charCount.innerText = `${editor.innerText.replace(/\n/g,'').length} å­—`;
    }

    function showToast(type, msg) {
      const t = document.getElementById('toast');
      const icon = document.getElementById('toastIcon');
      icon.innerText = type === 'success' ? 'âœ’ï¸' : 'âš ï¸';
      document.getElementById('toastMsg').innerText = msg;
      
      t.style.opacity = '1';
      t.style.top = '90px'; // slide down
      setTimeout(() => {
        t.style.opacity = '0';
        t.style.top = '80px';
      }, 2500);
    }
  </script>
</body>
</html>
