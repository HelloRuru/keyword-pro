<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<title>ËõçÂÖâ„Éö„É≥ PRO | SEOÊñáÊ°àÊï∏‰ΩçÂ∑•ÂÖ∑</title>
<meta name="description" content="Â∞àÁÇ∫ÂÖßÂÆπÂâµ‰ΩúËÄÖÊâìÈÄ†ÁöÑÊï∏‰ΩçÊñáÊàøÂÖ∑„ÄÇÊèê‰æõ SEO ÈóúÈçµÂ≠óÂØÜÂ∫¶Ê™¢Ê∏¨„ÄÅÂ≠óÊï∏Áµ±Ë®à„ÄÅGoogle Docs Ê†ºÂºèÁÑ°Á∏´Ë≤º‰∏äÂäüËÉΩ„ÄÇÈõ¢Á∑öÂèØÁî®ÔºåÊîØÊè¥Ê∑±Ëâ≤Ê®°ÂºèËàá PWA ÂÆâË£ù„ÄÇ">
<meta name="keywords" content="SEOÂ∑•ÂÖ∑, ÊñáÊ°àÂØ´‰Ωú, Â≠óÊï∏Áµ±Ë®à, ÈóúÈçµÂ≠óÂØÜÂ∫¶, Google Docs ÊéíÁâà, Á∂≤È†ÅËû¢ÂÖâÁ≠Ü, Êï∏‰ΩçÊñáÂÖ∑, PWA">
<meta name="author" content="Kaoru Tsai">
<meta name="robots" content="index, follow">
<meta property="og:type" content="website">
<meta property="og:title" content="ËõçÂÖâ„Éö„É≥ PRO">
<meta property="og:description" content="ËÆìÂØ´‰ΩúÂõûÊ≠∏ÂÑ™ÈõÖÁöÑÊï∏‰ΩçÊñáÂÖ∑ÔºåËß£Ê±∫ Google Docs Ë≤º‰∏äË∑ëÁâàÁóõÈªû„ÄÇ">
<meta property="og:url" content=""> 

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#F9F8F4">
<link rel="apple-touch-icon" href="icon-192.png">

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "SoftwareApplication",
  "name": "ËõçÂÖâ„Éö„É≥ PRO",
  "operatingSystem": "Web, iOS, Android",
  "applicationCategory": "ProductivityApplication",
  "description": "SEO writing tool with auto-save and Google Docs formatting."
}
</script>

<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512' fill='none'><path d='M256 86C256 86 160 190 160 310C160 380 200 426 256 426C312 426 352 380 352 310C352 190 256 86 256 86Z' stroke='%232B4B65' stroke-width='24' stroke-linecap='round' stroke-linejoin='round'/><path d='M256 180V320' stroke='%232B4B65' stroke-width='24' stroke-linecap='round'/><circle cx='256' cy='370' r='24' fill='%23BF1E33'/></svg>">

<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Shippori+Mincho:wght@500;700;900&family=Zen+Kaku+Gothic+New:wght@300;400;500;700&display=swap" rel="stylesheet">

<script>
  // 1. Êô∫ÊÖßÂûãÂè≥ÈçµÈò≤Ë≠∑ÔºöÂè™Âú®Á∑®ËºØÂçÄÂÖÅË®±Âè≥ÈçµÔºåÂÖ∂‰ªñÂú∞ÊñπÈéñ‰Ωè
  document.addEventListener('contextmenu', e => {
    const isEditable = e.target.tagName === 'TEXTAREA' || 
                       e.target.tagName === 'INPUT' || 
                       e.target.isContentEditable ||
                       (e.target.closest && e.target.closest('[contenteditable="true"]'));
    if (isEditable) return; // ÂÖÅË®±Á∑®ËºØÂçÄÂè≥Èçµ
    e.preventDefault();     // ÂÖ∂‰ªñÂú∞ÊñπÈéñ‰Ωè
  });
  
  // 2. Á¶ÅÊ≠¢ Ctrl+S / Ctrl+UÔºå‰øùÁïô F12 Êñπ‰æøÊÇ®Èô§ÈåØ
  document.addEventListener('keydown', e => {
    if((e.ctrlKey && ['u','U','s','S'].includes(e.key))){
      e.preventDefault(); 
    }
  });

  // 3. Ë®ªÂÜä PWA
  if ('serviceWorker' in navigator) {
     window.addEventListener('load', () => { 
       navigator.serviceWorker.register('./sw.js').catch(e => console.log('SW Fail')); 
     });
  }
</script>

<style>
  /* --- ËÆäÊï∏Á≥ªÁµ± --- */
  :root {
    --bg-canvas: #F9F8F4; --bg-sidebar: #FFFFFF; --bg-panel: #F8F9FA; --border-color: #EBEBEB;
    --c-ink: #303133; --c-sub: #555555; 
    --c-iron: #2B4B65; --c-crimson: #BF1E33; --c-forest: #2F5D50; --c-purple: #6A4C9C;
    --hl-yellow: #F0DC70; --hl-pink: #F5B199; --hl-blue: #A0D8EF; --hl-green: #C6Eac5; --hl-purple: #E0C8F2;
    --font-ui: 'Zen Kaku Gothic New', sans-serif; --font-serif: 'Shippori Mincho', serif; --font-docs: 'Noto Sans TC', sans-serif;
    --grid-pattern: linear-gradient(#E5E5E5 1px, transparent 1px), linear-gradient(90deg, #E5E5E5 1px, transparent 1px);
  }
  [data-theme="dark"] {
    --bg-canvas: #1A1A1A; --bg-sidebar: #222222; --bg-panel: #2C2C2C; --border-color: #333333;
    --c-ink: #E0C088; --c-sub: #A0A0A0; --c-iron: #8AB4D6; --c-crimson: #FF6B6B;
    --grid-pattern: linear-gradient(#333 1px, transparent 1px), linear-gradient(90deg, #333 1px, transparent 1px);
  }

  /* --- Âü∫Á§éÊ®£Âºè --- */
  body { background: var(--bg-canvas); color: var(--c-ink); font-family: var(--font-ui); height: 100vh; overflow: hidden; display: flex; flex-direction: column; transition: 0.3s; user-select: none; }
  input, textarea, [contenteditable] { user-select: text; } /* Á¢∫‰øùÂèØÈÅ∏Âèñ */
  .bg-grid { position: fixed; inset: 0; background-image: var(--grid-pattern); background-size: 20px 20px; opacity: 0.4; pointer-events: none; z-index: -1; }
  .custom-scroll::-webkit-scrollbar { width: 6px; }
  .custom-scroll::-webkit-scrollbar-track { background: transparent; }
  .custom-scroll::-webkit-scrollbar-thumb { background: #E0E0E0; border-radius: 3px; }
  [data-theme="dark"] .custom-scroll::-webkit-scrollbar-thumb { background: #444; }

  /* --- ‰ΩàÂ±ÄÁµÑ‰ª∂ --- */
  .sidebar-container { background: var(--bg-sidebar); border-right: 1px solid var(--border-color); display: flex; flex-direction: column; z-index: 20; box-shadow: 2px 0 10px rgba(0,0,0,0.02); transition: 0.3s; }
  .section-title { font-family: var(--font-serif); font-weight: 800; font-size: 0.95rem; margin-bottom: 0.8rem; display: flex; align-items: center; gap: 8px; position: relative; padding-left: 12px; }
  .section-title::before { content: ''; position: absolute; left: 0; top: 15%; bottom: 15%; width: 3px; background: var(--c-iron); border-radius: 2px; }
  .section-title.accent::before { background: var(--c-crimson); }

  .input-field { width: 100%; background: var(--bg-panel); border: 1px solid var(--border-color); border-radius: 6px; padding: 12px; font-size: 14px; color: var(--c-ink); line-height: 1.6; transition: 0.3s; resize: none; outline: none; font-family: var(--font-ui); }
  .input-field:focus { background: var(--bg-sidebar); border-color: var(--c-iron); box-shadow: 0 4px 12px rgba(43, 75, 101, 0.08); }

  .density-panel { background: var(--bg-panel); border: 1px solid var(--border-color); border-radius: 6px; padding: 8px; margin-bottom: 10px; max-height: 100px; overflow-y: auto; display: flex; flex-wrap: wrap; gap: 6px; }
  .kw-tag { font-size: 11px; padding: 2px 8px; border-radius: 4px; background: var(--bg-sidebar); border: 1px solid var(--border-color); color: var(--c-sub); display: flex; align-items: center; gap: 4px; cursor: default; transition: 0.2s; }
  .kw-tag:hover { border-color: var(--c-iron); transform: translateY(-1px); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
  .kw-tag .count { font-weight: 800; color: var(--c-iron); }
  .kw-tag.missing { border-color: #FECACA; background: #FFF5F5; color: #C9171E; }
  .kw-tag.good { border-color: #C6F6D5; background: #F0FFF4; color: #276749; }

  .localization-panel { background: rgba(255, 200, 0, 0.1); border: 1px solid rgba(255, 200, 0, 0.3); border-radius: 6px; padding: 8px; margin-bottom: 15px; font-size: 11px; color: var(--c-ink); display: none; }
  .loc-item { display: flex; align-items: center; gap: 6px; margin-bottom: 4px; }

  /* --- Á∑®ËºØÂô® (Google Docs ÈÅ©ÈÖç) --- */
  .preview-wrapper { flex: 1; display: flex; flex-direction: column; background: var(--bg-canvas); position: relative; overflow: hidden; transition: 0.3s; }
  .editor-container { flex: 1; overflow-y: auto; padding: 20px 0; scroll-behavior: smooth; }
  .editor-paper { 
    width: 100%; max-width: 820px; min-height: 100%; margin: 0 auto; 
    background: var(--bg-sidebar); padding: 60px 80px 100px 80px; 
    box-shadow: 0 0 40px rgba(0,0,0,0.03); outline: none; 
    font-family: var(--font-docs); font-size: 12pt; 
    line-height: 1.6; /* Á¢∫‰øùË°åÈ´òËàíÈÅ©‰∏î‰∏çÂàáÂ≠ó */
    color: var(--c-ink); letter-spacing: 0.02em; text-align: justify; 
    transition: background 0.3s, color 0.3s; 
  }
  
  .editor-paper h2 { font-family: var(--font-docs); font-size: 18pt; font-weight: 700; color: var(--c-iron); border-bottom: 1px solid var(--border-color); padding-bottom: 8px; margin: 24px 0 16px 0; line-height: 1.4; }
  .editor-paper h3 { font-family: var(--font-docs); font-size: 14pt; font-weight: 700; color: var(--c-ink); border-left: 4px solid var(--c-crimson); padding-left: 10px; margin: 20px 0 12px 0; line-height: 1.4; }
  .editor-paper p { margin-bottom: 12pt; }
  .highlight-pulse { background-color: rgba(255, 255, 0, 0.4); border-radius: 2px; box-shadow: 0 0 8px rgba(255, 255, 0, 0.6); transition: 0.2s; }
  [data-theme="dark"] .highlight-pulse { background-color: rgba(255, 215, 0, 0.3); color: #FFF; }

  /* --- Â∑•ÂÖ∑Âàó --- */
  .toolbar-sticky { position: sticky; top: 0; z-index: 40; background: var(--bg-canvas); border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; backdrop-filter: blur(8px); transition: 0.3s; }
  [data-theme="dark"] .toolbar-sticky { background: rgba(34, 34, 34, 0.65); backdrop-filter: blur(12px); border-bottom: 1px solid rgba(255, 255, 255, 0.08); }
  .toolbar-inner { display: flex; align-items: center; gap: 6px; background: var(--bg-sidebar); padding: 4px 8px; border-radius: 8px; border: 1px solid var(--border-color); box-shadow: 0 4px 15px rgba(0,0,0,0.04); flex-wrap: wrap; }
  .btn-tool { height: 32px; width: 32px; border-radius: 4px; color: var(--c-sub); transition: 0.2s; cursor: pointer; border: 1px solid transparent; display: flex; align-items: center; justify-content: center; }
  .btn-tool svg { width: 16px; height: 16px; stroke-width: 1.5; }
  .btn-tool:hover { background: var(--bg-panel); color: var(--c-iron); }
  .divider { width: 1px; height: 18px; background: var(--border-color); margin: 0 4px; }
  .color-dot { width: 20px; height: 20px; border-radius: 50%; border: 2px solid var(--bg-sidebar); box-shadow: 0 0 0 1px var(--border-color); cursor: pointer; transition: 0.2s; }
  .color-dot:hover { transform: scale(1.15); z-index: 10; }
  select.tool-select { height: 32px; border: 1px solid var(--border-color); border-radius: 4px; font-size: 13px; padding: 0 4px; color: var(--c-sub); background: var(--bg-sidebar); outline: none; cursor: pointer; font-family: var(--font-docs); }

  /* --- ÊµÆÂãïÈÅ∏ÂñÆ & Modal --- */
  .floating-menu { position: fixed; z-index: 999; background: var(--bg-sidebar); border: 1px solid var(--border-color); border-radius: 50px; padding: 6px 12px; display: flex; align-items: center; gap: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.15); opacity: 0; pointer-events: none; transform: translateY(10px); transition: 0.2s; }
  .floating-menu.show { opacity: 1; pointer-events: auto; transform: translateY(0); }
  .float-divider { width: 1px; height: 16px; background: var(--border-color); }

  .ai-modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 1000; display: none; justify-content: center; align-items: center; backdrop-filter: blur(4px); }
  .ai-modal { background: var(--bg-sidebar); width: 90%; max-width: 500px; border-radius: 12px; padding: 20px; border: 1px solid var(--border-color); box-shadow: 0 10px 30px rgba(0,0,0,0.2); max-height: 80vh; overflow-y: auto; }
  .ai-result-item { margin-bottom: 12px; padding: 10px; background: var(--bg-panel); border-radius: 6px; border: 1px solid var(--border-color); cursor: pointer; transition: 0.2s; font-size: 13px; color: var(--c-ink); }
  .ai-result-item:hover { border-color: var(--c-iron); background: var(--bg-sidebar); }
  .ai-label { font-size: 10px; color: var(--c-sub); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 4px; font-weight: bold; }

  /* --- ÂÖÉ‰ª∂ --- */
  .btn-primary { width: 100%; background: var(--c-crimson); color: white; border: none; padding: 12px; border-radius: 6px; font-family: var(--font-serif); letter-spacing: 0.1em; font-weight: 700; cursor: pointer; box-shadow: 0 4px 12px rgba(191, 30, 51, 0.3); transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px; font-size: 14px; }
  .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 6px 16px rgba(191, 30, 51, 0.4); }
  .btn-secondary { flex: 1; background: var(--bg-sidebar); border: 1px solid var(--border-color); color: var(--c-sub); padding: 8px; border-radius: 6px; font-size: 12px; cursor: pointer; transition: 0.2s; display: flex; justify-content: center; align-items: center; gap: 4px; }
  .btn-secondary:hover { border-color: var(--c-iron); color: var(--c-iron); background: var(--bg-panel); }
  .stats-bar { background: var(--bg-sidebar); border-top: 1px solid var(--border-color); padding: 6px 20px; display: flex; justify-content: space-between; align-items: center; font-size: 11px; color: var(--c-sub); font-family: var(--font-ui); z-index: 30; }
  .stat-group { display: flex; gap: 15px; align-items: center; }
  .stat-item { display: flex; gap: 4px; }
  .stat-val { font-weight: 700; color: var(--c-iron); }
  .toggle-btn { display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 2px 8px; border-radius: 12px; border: 1px solid var(--border-color); transition: 0.2s; }
  .toggle-btn.active { background: #E6FFFA; border-color: #38B2AC; color: #2C7A7B; }
  [data-theme="dark"] .toggle-btn.active { background: #1D4044; color: #4FD1C5; border-color: #2C7A7B; }
  .clear-options { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 6px; margin-top: 6px; }
  .copyright-text { text-align: center; margin-top: 20px; font-size: 10px; color: #AAA; font-family: sans-serif; letter-spacing: 0.5px; }

  @media (max-width: 768px) {
    .sidebar-container, .preview-wrapper { width: 100% !important; height: auto; }
    #sectionInput { height: calc(100vh - 120px); }
    .editor-paper { padding: 30px 20px; min-height: 80vh; }
    .toolbar-sticky { flex-wrap: wrap; gap: 8px; padding: 8px 10px; }
    .toolbar-inner { flex: 1; overflow-x: auto; padding-right: 20px; -webkit-overflow-scrolling: touch; }
    .stats-bar { flex-direction: column; gap: 8px; align-items: flex-start; padding: 10px 15px; }
    .mobile-hidden { display: none !important; }
  }
  @media (min-width: 769px) { .floating-menu { display: none !important; } }
</style>
</head>
<body>
  <div class="bg-grid"></div>

  <div id="aiModal" class="ai-modal-overlay" onclick="App.AI.close()">
     <div class="ai-modal" onclick="event.stopPropagation()">
        <div class="flex justify-between items-center mb-4">
           <h3 class="font-serif font-bold text-lg text-[var(--c-iron)]">‚ú® AI Êô∫ÊÖßÂª∫Ë≠∞</h3>
           <button onclick="App.AI.close()" class="text-2xl text-[var(--c-sub)]">&times;</button>
        </div>
        <div id="aiContent"></div>
     </div>
  </div>

  <header class="h-14 flex md:hidden items-center px-4 bg-white border-b z-50 justify-between sticky top-0">
    <span class="font-serif font-bold text-lg text-gray-800 flex items-center gap-2">
      <svg class="w-5 h-5" viewBox="0 0 512 512" fill="none"><path d="M256 86C256 86 160 190 160 310C160 380 200 426 256 426C312 426 352 380 352 310C352 190 256 86 256 86Z" stroke="#303133" stroke-width="24" stroke-linecap="round" stroke-linejoin="round"/><path d="M256 180V320" stroke="#303133" stroke-width="24" stroke-linecap="round"/><circle cx="256" cy="370" r="24" fill="#BF1E33"/></svg>
      ËõçÂÖâ„Éö„É≥ <span class="text-xs font-sans text-red-600">PRO</span>
    </span>
  </header>

  <div id="mobileFloatMenu" class="floating-menu">
     <div onmousedown="event.preventDefault()" onclick="App.Format.color('#BF1E33')" class="color-dot" style="background:#BF1E33" title="ÁúüÁ¥Ö"></div>
     <div onmousedown="event.preventDefault()" onclick="App.Format.color('#2B4B65')" class="color-dot" style="background:#2B4B65" title="ËóçÈâÑ"></div>
     <div class="float-divider"></div>
     <div onmousedown="event.preventDefault()" onclick="App.Format.highlight('#F0DC70')" class="color-dot" style="background:var(--hl-yellow)" title="ÂààÂÆâ"></div>
     <div class="float-divider"></div>
     <div onmousedown="event.preventDefault()" onclick="App.Format.remove()" class="btn-tool w-6 h-6 p-0" title="Ê∏ÖÈô§">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6L6 18M6 6l12 12"/></svg>
     </div>
     <div id="synonymBtn" onmousedown="event.preventDefault()" class="hidden btn-tool w-6 h-6 p-0 text-yellow-600" title="ÊõøÊèõË©û">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3M3.337 17h4.673M12 21v-1"/></svg>
     </div>
  </div>

  <div class="flex-1 flex flex-col md:flex-row overflow-hidden relative h-screen">
    <aside id="sectionInput" class="sidebar-container w-full md:w-[360px] custom-scroll overflow-y-auto">
      <div class="p-5 flex flex-col min-h-full">
          <div class="hidden md:flex items-center gap-3 mb-6 select-none">
            <svg class="w-10 h-10 text-[#303133] dark:text-[#E0C088]" viewBox="0 0 512 512" fill="none"><path d="M256 86C256 86 160 190 160 310C160 380 200 426 256 426C312 426 352 380 352 310C352 190 256 86 256 86Z" stroke="currentColor" stroke-width="24" stroke-linecap="round" stroke-linejoin="round"/><path d="M256 180V320" stroke="currentColor" stroke-width="24" stroke-linecap="round"/><circle cx="256" cy="370" r="24" fill="#BF1E33"/></svg>
            <div>
              <h1 class="font-serif font-bold text-lg text-[var(--c-ink)] tracking-widest leading-none">ËõçÂÖâ„Éö„É≥ <span class="text-xs font-sans text-[var(--c-crimson)]">PRO</span></h1>
              <p class="text-[9px] text-gray-400 tracking-[0.2em] mt-1">DOCS DRAFTING TOOL v4.8</p>
            </div>
          </div>

          <div class="mb-4">
            <div class="flex justify-between items-end mb-2">
              <div class="section-title mb-0">ÂéüÊñáËº∏ÂÖ•</div>
              <button onclick="App.Core.restore()" class="text-[10px] text-blue-600 hover:underline flex items-center gap-1">
                 <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg> ÈÇÑÂéü
              </button>
            </div>
            <textarea id="sourceText" class="input-field min-h-[220px]" placeholder="Âú®Ê≠§Ëº∏ÂÖ•ÊñáÁ´†...&#10;Á∑®ËºØÂæåÊúÉËá™ÂãïÂêåÊ≠•Ëá≥Âè≥ÂÅ¥È†êË¶Ω„ÄÇ"></textarea>
          </div>
          
          <div class="mb-4 flex-1">
             <div class="section-title accent">SEO ÈóúÈçµÂ≠ó</div>
             <textarea id="kwList" class="input-field h-20 mb-2" placeholder="ÈóúÈçµÂ≠ó (ÊØèË°å‰∏ÄÂÄã)..."></textarea>
             <div id="densityPanel" class="density-panel custom-scroll"><span class="text-xs text-gray-400 w-full text-center py-2">Á≠âÂæÖËº∏ÂÖ•...</span></div>
             <div id="locPanel" class="localization-panel"></div>
          </div>

          <div class="mt-auto pb-4">
            <button onclick="App.AI.generate()" class="btn-primary mb-3 !bg-indigo-600 !shadow-indigo-200">
               <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg> <span>‚ú® AI Êô∫ÊÖßÂª∫Ë≠∞</span>
            </button>
            <button onclick="App.Core.forceSync()" class="btn-primary mb-3">
              <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg> <span>‰∏ÄÈçµÊ®ôË®ª (Sync & Check)</span>
            </button>
            <button onclick="App.Core.copyToDocs()" class="btn-secondary w-full mb-3 !text-[var(--c-crimson)] !border-[var(--c-crimson)]/30 !bg-red-50 dark:!bg-red-900/20 hover:!bg-red-100">
              <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"/></svg> Ë§áË£ΩÂà∞ Docs
            </button>

            <div class="section-title sub text-xs mt-4">Ê∏ÖÁ©∫ËàáÂÇô‰ªΩ</div>
            <div class="clear-options">
              <button onclick="App.Storage.clear('source')" class="btn-secondary text-[10px]">Ê∏ÖÁ©∫ÂéüÊñá</button>
              <button onclick="App.Storage.clear('kw')" class="btn-secondary text-[10px]">Ê∏ÖÁ©∫ÈóúÈçµÂ≠ó</button>
              <button onclick="App.Storage.downloadBackup()" class="btn-secondary text-[10px] text-blue-600">‰∏ãËºâÂÇô‰ªΩ</button>
            </div>
            <button onclick="App.Storage.clear('all')" class="btn-secondary w-full mt-2 text-[10px] !text-red-500 hover:bg-red-50">ÂÖ®ÈÉ®ÈáçÁΩÆ</button>
            <div class="copyright-text">Production by Kaoru TsaiÔºåÊñº2025Ë£Ω‰Ωú</div>
          </div>
      </div>
    </aside>

    <main id="sectionPreview" class="preview-wrapper mobile-hidden custom-scroll">
      <div class="toolbar-sticky">
        <div class="toolbar-inner">
          <div class="tool-group">
            <button onmousedown="event.preventDefault()" onclick="document.execCommand('undo')" class="btn-tool" title="Âæ©Âéü"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M3 7v6h6"/><path d="M21 17a9 9 0 00-9-9 9 9 0 00-6 2.3L3 13"/></svg></button>
            <button onmousedown="event.preventDefault()" onclick="document.execCommand('redo')" class="btn-tool" title="ÈáçÂÅö"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M21 7v6h-6"/><path d="M3 17a9 9 0 019-9 9 9 0 016 2.3l6 3.7"/></svg></button>
          </div>
          <div class="divider"></div>
          <div class="tool-group">
             <button onmousedown="event.preventDefault()" onclick="App.Format.cmd('formatBlock','h2')" class="btn-tool font-bold" title="H2">H2</button>
             <button onmousedown="event.preventDefault()" onclick="App.Format.cmd('formatBlock','h3')" class="btn-tool font-bold" title="H3">H3</button>
             <button onmousedown="event.preventDefault()" onclick="App.Format.cmd('formatBlock','p')" class="btn-tool" title="P">P</button>
             <button onmousedown="event.preventDefault()" onclick="App.Format.remove()" class="btn-tool" title="Ê∏ÖÈô§Ê†ºÂºè"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M2 12l5 5L22 2l-5-5L2 12zM12 2l10 10M12 22h10"/></svg></button>
          </div>
          <div class="divider"></div>
          <div class="tool-group">
            <select onchange="App.Format.size(this.value)" class="tool-select" title="Â≠óÁ¥ö">
              <option value="10pt">10</option><option value="11pt">11</option><option value="12pt" selected>12</option><option value="14pt">14</option><option value="18pt">18</option>
            </select>
          </div>
          <div class="divider"></div>
          <div class="tool-group px-1">
            <div onmousedown="event.preventDefault()" onclick="App.Format.color('#303133')" class="color-dot" style="background:#303133"></div>
            <div onmousedown="event.preventDefault()" onclick="App.Format.color('#2B4B65')" class="color-dot" style="background:#2B4B65"></div>
            <div onmousedown="event.preventDefault()" onclick="App.Format.color('#BF1E33')" class="color-dot" style="background:#BF1E33"></div>
            <div onmousedown="event.preventDefault()" onclick="App.Format.color('#2F5D50')" class="color-dot" style="background:#2F5D50"></div>
            <div onmousedown="event.preventDefault()" onclick="App.Format.color('#6A4C9C')" class="color-dot" style="background:#6A4C9C"></div>
          </div>
          <div class="divider"></div>
          <div class="tool-group px-1">
            <div onmousedown="event.preventDefault()" onclick="App.Format.highlight('#F0DC70')" class="color-dot" style="background:var(--hl-yellow)"></div>
            <div onmousedown="event.preventDefault()" onclick="App.Format.highlight('#F5B199')" class="color-dot" style="background:var(--hl-pink)"></div>
            <div onmousedown="event.preventDefault()" onclick="App.Format.highlight('#A0D8EF')" class="color-dot" style="background:var(--hl-blue)"></div>
            <div onmousedown="event.preventDefault()" onclick="App.Format.highlight('#C6Eac5')" class="color-dot" style="background:var(--hl-green)"></div>
            <div onmousedown="event.preventDefault()" onclick="App.Format.highlight('#E0C8F2')" class="color-dot" style="background:var(--hl-purple)"></div>
          </div>
        </div>
        <button onclick="App.UI.toggleTheme()" class="btn-tool rounded-full w-8 h-8 ml-2 border border-gray-200 dark:border-gray-600">
          <svg id="themeIcon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
        </button>
      </div>

      <div class="editor-container custom-scroll">
        <div id="editor" contenteditable="true" class="editor-paper" placeholder="È†êË¶ΩÂÖßÂÆπ..."></div>
      </div>
      
      <div class="stats-bar">
        <div class="stat-group">
          <div class="stat-item"><span>Á∏ΩÂ≠óÊï∏:</span> <span id="countTotal" class="stat-val">0</span></div>
          <div class="stat-item" style="opacity:0.6" id="selCountGroup"><span>ÈÅ∏Âèñ:</span> <span id="countSel" class="stat-val">0</span></div>
        </div>
        <div class="stat-group">
           <div id="btnPunc" class="toggle-btn" onclick="App.UI.togglePunctuation()" title="ÈªûÊìäÂàáÊèõ">
             <svg id="puncIcon" class="w-3 h-3 text-green-600" fill="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/></svg> Âê´Ê®ôÈªû
           </div>
        </div>
      </div>
    </main>
  </div>

  <nav class="md:hidden fixed bottom-0 left-0 right-0 bg-white border-t h-14 flex z-50">
    <button onclick="App.UI.switchTab('input')" class="flex-1 text-xs font-bold text-gray-500 hover:text-red-600 flex flex-col items-center justify-center">
      <svg class="w-5 h-5 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" /></svg> <span>Á∑®ËºØ</span>
    </button>
    <button onclick="App.UI.switchTab('preview')" class="flex-1 text-xs font-bold text-gray-500 hover:text-red-600 flex flex-col items-center justify-center">
      <svg class="w-5 h-5 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" /></svg> <span>È†êË¶Ω</span>
    </button>
  </nav>

  <script>
    const Config = {
        locDict: {'Ë≥™Èáè': 'ÂìÅË≥™', 'Ë¶ñÈ†ª': 'ÂΩ±Áâá', 'È´òÊ∏Ö': 'È´òÁï´Ë≥™', 'Á°¨‰ª∂': 'Á°¨È´î', 'Ëªü‰ª∂': 'ËªüÈ´î', 'È†ÖÁõÆ': 'Â∞àÊ°à', '‰ø°ÊÅØ': 'Ë≥áË®ä', 'Á∂≤‰∏ä': 'Á∑ö‰∏ä', 'ÊúçÂãôÂô®': '‰º∫ÊúçÂô®', 'Á®ãÂ∫è': 'Á®ãÂºè', 'Èº†Ê®ô': 'ÊªëÈº†', 'ÊâìÂç∞': 'ÂàóÂç∞', 'Â±èÂπï': 'Ëû¢Âπï', 'ÂÖßÂ≠ò': 'Ë®òÊÜ∂È´î'},
        synonyms: {
            'ÊóÖÈÅä': ['ÊóÖË°å', 'Ëá™Áî±Ë°å', 'Â∞èÊóÖË°å', 'Ê∑±Â∫¶ÈÅä'], '‰æøÂÆú': ['Âπ≥ÂÉπ', 'È´òCPÂÄº', 'Ë¶™Ê∞ë', 'ÈäÖÊùøÂÉπ'],
            'Â•ΩÂêÉ': ['ÁæéÂë≥', 'ÂøÖÂêÉ', 'È•ïÂÆ¢È¶ñÈÅ∏', 'È¢®Âë≥Áç®Áâπ'], 'Êé®Ëñ¶': ['Á≤æÈÅ∏', 'ÂøÖË≤∑', '‰∫∫Ê∞£', 'ÁÜ±Èä∑'],
            '‰ΩèÂÆø': ['È£ØÂ∫ó', 'Ê∞ëÂÆø', 'ÊóÖÂ∫ó', '‰∏ãÊ¶ª'], 'ÊãçÁÖß': ['ÊâìÂç°', 'ÂèñÊôØ', 'ÁæéÊãç', 'ÊÆ∫Â∫ïÁâá']
        },
        titles: (kw) => [`„Äê2025ÊúÄÊñ∞„Äë${kw}ÂÆåÂÖ®ÊîªÁï•ÔºöÊñ∞ÊâãÂøÖÁúãÁöÑÈáçÈªûÊï¥ÁêÜ`, `ÈÇÑÂú®ÁÖ©ÊÉ±${kw}ÔºüÊéåÊè°ÈÄôÂπæÈªûËÆì‰Ω†‰∫ãÂçäÂäüÂÄç`, `${kw}ÊòØ‰ªÄÈ∫ºÔºüÂÆåÊï¥Ëß£ÊûêËàáÂØ¶Áî®ÊäÄÂ∑ß`, `ÁÇ∫‰ªÄÈ∫º‰Ω†ÈúÄË¶Å${kw}ÔºüÂ∞àÂÆ∂ÂëäË®¥‰Ω†ËÉåÂæåÁöÑÁßòÂØÜ`, `5ÂàÜÈêòÊêûÊáÇ${kw}ÔºöÊá∂‰∫∫ÂåÖÁ∏ΩÊï¥ÁêÜ`]
    };

    const Storage = {
        save: (key, val) => { try { localStorage.setItem(key, val); } catch (e) { if(e.name==='QuotaExceededError') alert('ÂÑ≤Â≠òÁ©∫ÈñìÂ∑≤Êªø'); } },
        get: (key) => localStorage.getItem(key),
        clear: (type) => { if(!confirm('Á¢∫ÂÆöÊ∏ÖÁ©∫Ôºü(ÁÑ°Ê≥ïÂæ©Âéü)')) return; if(type==='source'||type==='all') Dom.source.value=''; if(type==='kw'||type==='all') Dom.kwInput.value=''; if(type==='all') { Dom.editor.innerHTML=''; localStorage.clear(); } App.Core.forceSync(); },
        downloadBackup: () => { const a = document.createElement('a'); a.href = URL.createObjectURL(new Blob([`<html><body>${Dom.editor.innerHTML}</body></html>`], {type:'text/html'})); a.download = `backup_${new Date().toISOString().slice(0,10)}.html`; a.click(); }
    };

    let Dom = {};

    const App = {
        state: { isAutoSync: true, includePunctuation: true, saveTimer: null, syncTimer: null },
        Init: () => {
            Dom = { source: document.getElementById('sourceText'), kwInput: document.getElementById('kwList'), editor: document.getElementById('editor'), density: document.getElementById('densityPanel'), loc: document.getElementById('locPanel'), floatMenu: document.getElementById('mobileFloatMenu'), synonymBtn: document.getElementById('synonymBtn'), aiModal: document.getElementById('aiModal'), aiContent: document.getElementById('aiContent'), countTotal: document.getElementById('countTotal'), countSel: document.getElementById('countSel'), btnPunc: document.getElementById('btnPunc'), puncIcon: document.getElementById('puncIcon'), themeIcon: document.getElementById('themeIcon') };

            if(Storage.get('fluo_src')) Dom.source.value = Storage.get('fluo_src');
            if(Storage.get('fluo_kw')) Dom.kwInput.value = Storage.get('fluo_kw');
            const cachedHtml = Storage.get('fluo_html');
            if(cachedHtml) { Dom.editor.innerHTML = cachedHtml; if(Dom.editor.innerText.replace(/\n/g,'').trim()!==Dom.source.value.replace(/\n/g,'').trim()) App.state.isAutoSync=false; } else { App.Core.runSync(true); }
            if(Storage.get('fluo_theme')==='dark') { document.body.setAttribute('data-theme','dark'); App.UI.updateThemeIcon(true); }
            
            Dom.source.addEventListener('input', App.Handlers.onInput); Dom.kwInput.addEventListener('input', App.Handlers.onInput); Dom.editor.addEventListener('input', App.Handlers.onEditorInput); document.addEventListener('selectionchange', App.UI.updateStats);
            App.Core.analyze(); App.UI.updateStats();
        },
        Handlers: {
            onInput: () => { if(App.state.isAutoSync) { clearTimeout(App.state.syncTimer); App.state.syncTimer = setTimeout(()=>App.Core.runSync(true),500); } else { App.Core.analyze(); } App.Core.triggerSave(); App.UI.updateStats(); },
            onEditorInput: () => { if(App.state.isAutoSync) App.state.isAutoSync=false; App.Core.triggerSave(); App.UI.updateStats(); }
        },
        Core: {
            runSync: (silent=false) => {
                if(!App.state.isAutoSync) return;
                let text = Dom.source.value; if(!text) { if(!silent) Dom.editor.innerHTML=''; return; }
                const uniqueKws = [...new Set(Dom.kwInput.value.split('\n').map(k=>k.trim()).filter(k=>k))];
                let html = text.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");
                uniqueKws.forEach(kw => { html = html.replace(new RegExp(`(${App.Utils.escapeRegExp(kw)})`,'gi'), `<span class="kw-highlight" data-kw="${kw.toLowerCase()}" style="color: #BF1E33; font-weight: 700;">$1</span>`); });
                Dom.editor.innerHTML = html.split(/\n\s*\n/).map(p=>p.trim()?`<p style="margin-bottom: 12pt;">${p.replace(/\n/g,'<br>')}</p>`:'').join('');
                App.Core.analyze(); App.Core.triggerSave();
            },
            analyze: () => {
                const text = Dom.source.value; const len = text.length;
                if(len === 0) { Dom.density.innerHTML='<span class="text-xs text-gray-400">ÁÑ°ÂÖßÂÆπ</span>'; return; }
                const uniqueKws = [...new Set(Dom.kwInput.value.split('\n').map(k=>k.trim()).filter(k=>k))];
                let html = '';
                uniqueKws.forEach(kw => {
                    const count = (text.match(new RegExp(App.Utils.escapeRegExp(kw),'gi'))||[]).length;
                    const density = ((count*kw.length/len)*100).toFixed(1);
                    let cls = count===0?'missing':(density>0.5&&density<5?'good':'');
                    html += `<div class="kw-tag ${cls}" onmouseenter="App.UI.hlKw('${kw}',true)" onmouseleave="App.UI.hlKw('${kw}',false)">${kw} <span class="count">${count}</span> <span style="font-size:9px; opacity:0.7">(${density}%)</span></div>`;
                });
                Dom.density.innerHTML = html||'<span class="text-xs text-gray-400">ÁÑ°ÈóúÈçµÂ≠ó</span>';
                let locHtml = '';
                for(const [bad,good] of Object.entries(Config.locDict)) { if(text.includes(bad)) locHtml+=`<div class="loc-item">‚ö†Ô∏è Âª∫Ë≠∞Â∞á <b>${bad}</b> <span class="loc-arrow">‚ûî</span> <b>${good}</b></div>`; }
                Dom.loc.style.display=locHtml?'block':'none'; if(locHtml) Dom.loc.innerHTML='<div style="font-weight:700; margin-bottom:4px; color:#D97706">Âú®Âú∞ÂåñÊèêÈÜí (TW)</div>'+locHtml;
            },
            triggerSave: () => { clearTimeout(App.state.saveTimer); App.state.saveTimer = setTimeout(() => { Storage.save('fluo_src',Dom.source.value); Storage.save('fluo_kw',Dom.kwInput.value); Storage.save('fluo_html',Dom.editor.innerHTML); }, 800); },
            forceSync: () => { App.state.isAutoSync=true; App.Core.runSync(); if(window.innerWidth<768) App.UI.switchTab('preview'); },
            restore: () => { if(confirm('Â∞áÈ†êË¶ΩÂçÄÂÖßÂÆπÈÇÑÂéüÂà∞Ëº∏ÂÖ•Ê°ÜÔºü')) { Dom.source.value=Dom.editor.innerText; App.Core.forceSync(); }},
            copyToDocs: async () => {
                const wrapper = document.createElement('div'); 
                // üü¢ Á¢∫‰øùÊ®£ÂºèÂØ´ÂÖ• wrapper
                wrapper.style.cssText = "font-family: 'Noto Sans TC', sans-serif; font-size: 12pt; line-height: 1.6; color: #303133; text-align: justify; background: white;";
                const clone = Dom.editor.cloneNode(true);
                clone.querySelectorAll('.kw-highlight').forEach(el=>{el.classList.remove('kw-highlight','highlight-pulse');el.removeAttribute('data-kw');});
                const apply = (n) => {
                    if(n.nodeType===1) {
                        if(n.tagName==='H2') n.style.cssText="font-family:'Noto Sans TC',sans-serif;font-size:18pt;font-weight:700;color:#2B4B65;border-bottom:1px solid #E0E0E0;padding-bottom:8px;margin:24px 0 16px 0;line-height:1.4;";
                        else if(n.tagName==='H3') n.style.cssText="font-family:'Noto Sans TC',sans-serif;font-size:14pt;font-weight:700;color:#303133;border-left:4px solid #BF1E33;padding-left:10px;margin:20px 0 12px 0;line-height:1.4;";
                        else if(n.tagName==='P') n.style.cssText="margin-bottom:12pt;line-height:1.6;";
                    } n.childNodes.forEach(apply);
                }; apply(clone); wrapper.innerHTML = clone.innerHTML;
                try { await navigator.clipboard.write([new ClipboardItem({'text/html': new Blob([wrapper.outerHTML],{type:'text/html'}), 'text/plain': new Blob([Dom.editor.innerText],{type:'text/plain'})})]); alert('‚ú® Â∑≤Ë§áË£ΩÊ®ôÊ∫ñÊ†ºÂºèÔºÅ\nÂåÖÂê´Ôºö12pt Â≠óÁ¥ö, 1.6 ÂÄçË°åÈ´ò, Ê≠£ÈªëÈ´î'); } catch(e) { alert('Ë§áË£ΩÂ§±Êïó'); }
            }
        },
        UI: {
            hlKw: (kw, active) => Dom.editor.querySelectorAll(`span[data-kw="${kw.toLowerCase()}"]`).forEach(sp => active?sp.classList.add('highlight-pulse'):sp.classList.remove('highlight-pulse')),
            updateStats: () => {
                const text = Dom.editor.innerText; const sel = window.getSelection(); const selText = sel.toString();
                Dom.countTotal.innerText = App.Utils.count(text);
                if(selText) {
                    document.getElementById('selCountGroup').style.opacity='1'; Dom.countSel.innerText = App.Utils.count(selText);
                    if(window.innerWidth<768) App.UI.showFloatMenu(sel, selText);
                } else {
                    document.getElementById('selCountGroup').style.opacity='0.5'; Dom.countSel.innerText = '0';
                    Dom.floatMenu.classList.remove('show');
                }
            },
            showFloatMenu: (sel, text) => {
                const range = sel.getRangeAt(0); const rect = range.getBoundingClientRect();
                let top = rect.top - 60; let left = rect.left + (rect.width/2) - 90;
                if(left<10) left=10; if(top<60) top=rect.bottom+10;
                Dom.floatMenu.style.top=`${top}px`; Dom.floatMenu.style.left=`${left}px`; Dom.floatMenu.classList.add('show');
                const syns = Config.synonyms[text.trim()];
                if(syns) { Dom.synonymBtn.classList.remove('hidden'); Dom.synonymBtn.onclick = (e) => { e.preventDefault(); alert(`üí° ÊõøÊèõÂª∫Ë≠∞Ôºö\n${syns.join('„ÄÅ')}`); }; } 
                else { Dom.synonymBtn.classList.add('hidden'); }
            },
            togglePunctuation: () => { App.state.includePunctuation=!App.state.includePunctuation; if(App.state.includePunctuation){Dom.btnPunc.classList.add('active');Dom.puncIcon.style.color='green';}else{Dom.btnPunc.classList.remove('active');Dom.puncIcon.style.color='#DDD';} App.UI.updateStats(); },
            toggleTheme: () => { const isDark=document.body.getAttribute('data-theme')==='dark'; if(isDark){document.body.removeAttribute('data-theme');Storage.save('fluo_theme','light');App.UI.updateThemeIcon(false);}else{document.body.setAttribute('data-theme','dark');Storage.save('fluo_theme','dark');App.UI.updateThemeIcon(true);} },
            updateThemeIcon: (isDark) => { Dom.themeIcon.innerHTML = isDark ? '<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>' : '<circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>'; },
            switchTab: (tab) => { const input = document.getElementById('sectionInput'); const preview = document.getElementById('sectionPreview'); if(tab==='input'){input.classList.remove('mobile-hidden');preview.classList.add('mobile-hidden');}else{input.classList.add('mobile-hidden');preview.classList.remove('mobile-hidden');} }
        },
        Format: {
            cmd: (c,v) => { document.execCommand(c,false,v); if(App.state.isAutoSync) App.state.isAutoSync=false; App.UI.updateStats(); },
            // üü¢ Fix: More robust font sizing using span
            size: (pt) => { 
               const sel = window.getSelection();
               if (!sel.isCollapsed) {
                  document.execCommand('fontSize', false, '7'); // ÂÖàÁî® execCommand Ë®≠ÁÇ∫ÊúÄÂ§ß
                  const fontElements = Dom.editor.querySelectorAll('font[size="7"]');
                  fontElements.forEach(el => {
                     el.removeAttribute('size');
                     el.style.fontSize = pt;
                  });
               } else { alert('Ë´ãÂÖàÈÅ∏ÂèñÊñáÂ≠ó'); }
               if(App.state.isAutoSync)App.state.isAutoSync=false; App.UI.updateStats(); 
            },
            color: (h) => App.Format.cmd('foreColor',h),
            highlight: (h) => { if(!document.execCommand('hiliteColor',false,h)) document.execCommand('backColor',false,h); if(App.state.isAutoSync)App.state.isAutoSync=false; },
            remove: () => { document.execCommand('removeFormat',false,null); document.execCommand('backColor',false,'transparent'); if(App.state.isAutoSync)App.state.isAutoSync=false; App.UI.updateStats(); }
        },
        AI: {
            generate: () => {
                const text=Dom.source.value; if(text.length<50){alert('ÂÖßÂÆπÂ§™Â∞ë');return;}
                const raw=Dom.kwInput.value.split('\n').map(k=>k.trim()).filter(k=>k); let topKw=raw.length>0?raw[0]:"ÊÇ®ÁöÑ‰∏ªÈ°å";
                const clean=text.replace(/<[^>]*>/g,'').replace(/\s+/g,' ').trim();
                let meta=clean.substring(0,85); if(meta.length>=85)meta+="..."; meta+=` Êú¨ÊñáÂ∞áÊ∑±ÂÖ•Êé¢Ë®é ${topKw} ÁöÑÊ†∏ÂøÉËßÄÂøµËàáÊáâÁî®ÊäÄÂ∑ßÔºåÁ´ãÂç≥ÈªûÊìäÈñ±ËÆÄÂÆåÊï¥ÂÖßÂÆπÔºÅ`;
                let html=`<div class="ai-label">SEO Ê®ôÈ°åÂª∫Ë≠∞</div>`; Config.titles(topKw).forEach(t=>{html+=`<div class="ai-result-item" onclick="App.AI.copy('${t}')">${t}</div>`;});
                html+=`<div class="ai-label mt-4">Meta Description Âª∫Ë≠∞</div><div class="ai-result-item" onclick="App.AI.copy('${meta}')">${meta}</div>`;
                Dom.aiContent.innerHTML=html; Dom.aiModal.style.display='flex';
            },
            close: () => Dom.aiModal.style.display='none',
            copy: (t) => navigator.clipboard.writeText(t).then(()=>alert('Â∑≤Ë§áË£Ω'))
        },
        Utils: {
            escapeRegExp: (s) => s.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'),
            count: (s) => App.state.includePunctuation?s.replace(/[\n\r]/g,'').length:s.replace(/[^\w\u4e00-\u9fa5]/g,'').length
        }
    };
    
    document.addEventListener('DOMContentLoaded', App.Init);
    window.App=App; window.removeFormatting=App.Format.remove; window.applyColor=App.Format.color; window.applyHighlight=App.Format.highlight; window.execCmd=App.Format.cmd; window.changeFontSize=App.Format.size; window.toggleTheme=App.UI.toggleTheme; window.togglePunctuation=App.UI.togglePunctuation; window.switchTab=App.UI.switchTab; window.copyToClipboard=App.Core.copyToDocs; window.forceSync=App.Core.forceSync; window.clearData=Storage.clear; window.restoreFromPreview=App.Core.restore; window.generateAI=App.AI.generate; window.closeAiModal=App.AI.close;
  </script>
</body>
</html>
