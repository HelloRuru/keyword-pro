<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>è›å…‰ãƒšãƒ³ PRO - SEOæ–‡æ¡ˆæ•¸ä½å·¥å…·</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Shippori+Mincho:wght@400;500;700&family=Zen+Kaku+Gothic+New:wght@300;400;500&display=swap" rel="stylesheet">

<style>
  /* --- æ ¸å¿ƒè®Šæ•¸è¨­å®š --- */
  :root {
    --bg-canvas: #F5F4F0;
    --bg-sidebar: #FCFCFA;
    --color-ink: #333333;
    --color-sub: #7A7A7A;
    --color-accent: #A83636;
    --color-accent-hover: #8A2525;
    --status-saved: #059669;
    --noise: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.04'/%3E%3C/svg%3E");
  }

  /* å…¨å±€ä½ˆå±€é–å®š */
  body {
    background-color: var(--bg-canvas);
    color: var(--color-ink);
    font-family: 'Zen Kaku Gothic New', sans-serif;
    height: 100vh; /* å¼·åˆ¶å…¨è¢å¹•é«˜åº¦ */
    overflow: hidden; /* ç¦æ­¢æ»‘å‹• */
    display: flex;
    flex-direction: column;
  }

  .bg-noise { position: fixed; inset: 0; background-image: var(--noise); pointer-events: none; z-index: -1; }
  .font-serif { font-family: 'Shippori Mincho', serif; }
  .icon-line { width: 18px; height: 18px; stroke-width: 1.5px; stroke: currentColor; fill: none; stroke-linecap: round; stroke-linejoin: round; }

  /* è¼¸å…¥æ¡†æ¨£å¼ */
  .input-field {
    width: 100%; background: #FFFFFF;
    border: 1px solid transparent; border-bottom: 1px dashed #CCC;
    padding: 12px; font-size: 14px; color: var(--color-ink);
    transition: all 0.3s ease; resize: none; border-radius: 4px; outline: none;
  }
  .input-field:focus { background: #FFFFFF; border-bottom-color: var(--color-accent); box-shadow: 0 0 0 3px rgba(168, 54, 54, 0.05); }

  /* æŒ‰éˆ•æ¨£å¼ */
  .btn-tile {
    display: flex; align-items: center; justify-content: center; gap: 4px;
    padding: 6px 10px; background: #FFFFFF; border: 1px solid #EAEAEA; border-radius: 6px;
    color: var(--color-sub); font-size: 12px; font-weight: 500; cursor: pointer;
    box-shadow: 0 1px 2px rgba(0,0,0,0.03); transition: all 0.2s; user-select: none; flex-shrink: 0;
  }
  .btn-tile:active { transform: translateY(1px); background: #F9F9F9; }
  
  .btn-primary {
    width: 100%; background: var(--color-accent); color: white; border: none; padding: 12px;
    border-radius: 8px; font-family: 'Shippori Mincho', serif; letter-spacing: 0.05em; font-weight: bold;
    cursor: pointer; box-shadow: 0 4px 10px rgba(168, 54, 54, 0.2); transition: 0.2s;
    display: flex; align-items: center; justify-content: center; gap: 8px;
  }
  .btn-primary:active { transform: scale(0.98); }

  .btn-secondary {
    flex: 1; background: transparent; border: 1px solid #DDD; color: #666;
    padding: 8px; border-radius: 6px; font-size: 12px; cursor: pointer;
    display: flex; align-items: center; justify-content: center; gap: 6px;
  }

  /* ğŸŸ¢ Mobile Tab Bar (æ‰‹æ©Ÿç‰ˆåˆ‡æ›æ¨™ç±¤) */
  .mobile-tab-bar {
    display: flex; padding: 8px 16px; background: #F5F4F0;
    border-bottom: 1px solid #E0E0E0; gap: 10px; flex-shrink: 0;
  }
  .tab-btn {
    flex: 1; padding: 10px; border-radius: 8px; text-align: center;
    font-size: 13px; font-weight: bold; color: #999; cursor: pointer;
    transition: all 0.2s; background: rgba(255,255,255,0.5); border: 1px solid transparent;
    display: flex; align-items: center; justify-content: center; gap: 6px;
  }
  .tab-btn.active {
    background: #FFFFFF; color: var(--color-accent);
    border-color: #E0E0E0; box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  }

  /* éš±è—é‚è¼¯ (çµ•å°éš±è—) */
  .d-none { display: none !important; }
  
  /* é›»è…¦ç‰ˆå¼·åˆ¶è¦†è“‹ (Reset Layout) */
  @media (min-width: 768px) {
    .mobile-tab-bar { display: none !important; } /* é›»è…¦ç‰ˆä¸é¡¯ç¤º Tab */
    .desktop-flex { display: flex !important; }   /* é›»è…¦ç‰ˆå¼·åˆ¶é¡¯ç¤ºå…©æ¬„ */
    #sectionInput { width: 340px !important; display: flex !important; }
    #sectionPreview { flex: 1 !important; display: flex !important; }
  }

  /* ç·¨è¼¯ç´™å¼µ */
  .editor-paper {
    width: 100%; max-width: 820px; min-height: 80vh;
    background: #FFFFFF; padding: 80px; box-shadow: 0 10px 40px rgba(0,0,0,0.04);
    outline: none;
    font-family: "Microsoft JhengHei", "å¾®è»Ÿæ­£é»‘é«”", sans-serif !important;
    font-size: 12pt !important; line-height: 2.0 !important; color: #333;
  }
  @media (max-width: 768px) { .editor-paper { padding: 40px 24px; min-height: 65vh; } }

  .no-scrollbar::-webkit-scrollbar { display: none; }
  .color-dot { width: 20px; height: 20px; border-radius: 50%; border: 2px solid white; box-shadow: 0 0 0 1px #EEE; cursor: pointer; flex-shrink: 0; }

  /* Modal */
  .modal-backdrop {
    position: fixed; inset: 0; background: rgba(245, 244, 240, 0.9); backdrop-filter: blur(4px);
    z-index: 100; display: none; align-items: center; justify-content: center;
  }
  .modal-card {
    background: white; padding: 24px; border-radius: 12px; width: 90%; max-width: 320px;
    text-align: center; border: 1px solid #EEE; box-shadow: 0 20px 50px rgba(0,0,0,0.15);
  }
</style>
</head>
<body>
  <div class="bg-noise"></div>

  <header class="h-14 flex items-center px-4 md:px-6 border-b border-[#E0E0E0] bg-white flex-shrink-0 justify-between z-50 relative shadow-sm">
     <span class="font-serif font-bold text-lg tracking-widest text-gray-800 flex items-center gap-2">
       <svg class="icon-line text-[#A83636]" viewBox="0 0 24 24"><path d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg>
       è›å…‰ãƒšãƒ³ <span class="text-xs bg-gray-100 px-1.5 py-0.5 rounded text-gray-500 font-sans tracking-normal">PRO</span>
     </span>
     <span class="text-[10px] text-gray-400 font-serif hidden md:block">Â© 2025 Kaoru Tsai</span>
  </header>

  <div class="mobile-tab-bar md:hidden">
    <div id="tabInput" class="tab-btn active" onclick="switchTab('input')">
      <svg class="icon-line" viewBox="0 0 24 24"><path d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
      åŸæ–‡è¼¸å…¥
    </div>
    <div id="tabPreview" class="tab-btn" onclick="switchTab('preview')">
      <svg class="icon-line" viewBox="0 0 24 24"><path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
      é è¦½äº¤ä»˜
    </div>
  </div>

  <div class="flex-1 flex flex-col md:flex-row overflow-hidden relative">

    <aside id="sectionInput" class="w-full bg-[var(--bg-sidebar)] border-r border-[#EAEAEA] flex flex-col z-20 flex-shrink-0 h-full overflow-hidden">
      <div class="p-5 flex flex-col h-full overflow-y-auto">
         <div class="flex-col flex min-h-[160px] flex-shrink-0 mb-4">
           <div class="flex items-center gap-2 mb-2">
             <span class="font-bold text-sm text-gray-600 tracking-wide">åŸæ–‡è¼¸å…¥</span>
             <span class="text-[10px] text-gray-400 font-serif">DRAFT</span>
           </div>
           <textarea id="sourceText" class="input-field flex-1 min-h-[150px]" placeholder="è«‹åœ¨æ­¤è²¼ä¸Šè‰ç¨¿..."></textarea>
         </div>
         <div class="flex-col flex flex-shrink-0 mb-4">
            <div class="flex items-center gap-2 mb-2">
              <span class="font-bold text-sm text-gray-600 tracking-wide">SEO é—œéµå­—</span>
            </div>
            <textarea id="kwList" class="input-field h-24" placeholder="æ¯è¡Œä¸€å€‹..."></textarea>
         </div>
         <div class="mt-auto pt-2 pb-6 md:pb-0">
           <button onclick="runAutoMark()" class="btn-primary mb-3">
             <svg class="icon-line" style="stroke: white;" viewBox="0 0 24 24"><path d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
             æ³¨å…¥æ¨£å¼ (Inject)
           </button>
           <div class="flex gap-3">
             <button onclick="downloadTxt()" class="btn-secondary">ä¸‹è¼‰ .txt</button>
             <button onclick="openResetModal()" class="btn-secondary hover:text-red-600">æ¸…ç©ºé‡ç½®</button>
           </div>
           <div class="text-[10px] text-gray-300 text-center mt-4 md:hidden">Â© 2025 Kaoru Tsai.</div>
         </div>
      </div>
    </aside>

    <main id="sectionPreview" class="flex-1 flex-col bg-[#F5F4F0] relative min-w-0 h-full d-none md:flex">
      
      <div class="h-14 flex items-center px-4 flex-shrink-0 z-30 bg-[#F5F4F0]/95 backdrop-blur border-b border-[#E0E0E0] overflow-x-auto no-scrollbar">
        <div class="flex items-center gap-2 pr-4 min-w-max">
          <button onclick="applyStyle('h1')" class="btn-tile">H1</button>
          <button onclick="applyStyle('h2')" class="btn-tile">H2</button>
          <button onclick="applyStyle('p')" class="btn-tile">å…§æ–‡</button>
          <div class="w-px h-5 bg-gray-300 mx-1"></div>
          <button onclick="applyStyle('red')" class="btn-tile text-[#A83636] bg-[#FFF5F5]">é‡é»</button>
          <div class="w-px h-5 bg-gray-300 mx-1"></div>
          <button onclick="execCmd('undo')" class="btn-tile"><svg class="icon-line w-4 h-4" viewBox="0 0 24 24"><path d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"></path></svg></button>
          <button onclick="execCmd('redo')" class="btn-tile"><svg class="icon-line w-4 h-4" viewBox="0 0 24 24"><path d="M21 10h-10a8 8 0 00-8 8v2M21 10l-6 6m6-6l-6-6"></path></svg></button>
          <div class="w-px h-5 bg-gray-300 mx-1"></div>
          <div class="flex gap-2">
            <div onclick="applyColor('#333333')" class="color-dot bg-[#333]"></div>
            <div onclick="applyColor('#192F60')" class="color-dot bg-[#192F60]"></div>
            <div onclick="applyColor('#B93A32')" class="color-dot bg-[#B93A32]"></div>
            <div onclick="applyHighlight('#FFF2CC')" class="color-dot bg-[#FFF2CC]"></div>
          </div>
          <div class="w-px h-5 bg-gray-300 mx-1"></div>
          <button onclick="copyToDocs()" class="btn-tile text-black font-bold border-gray-400">è¤‡è£½</button>
        </div>
      </div>

      <div class="flex-1 overflow-y-auto flex flex-col items-center pb-20 scroll-smooth relative p-4 md:p-0">
        <div id="editor" contenteditable="true" class="editor-paper mt-2 md:mt-6 mb-6 text-justify rounded-sm shadow-sm" placeholder="é è¦½å€..."></div>
        <div class="w-full max-w-[820px] flex justify-between items-center text-[11px] text-gray-400 px-2 pb-8">
           <div class="font-serif flex items-center gap-2">
             <span id="charCount">0 å­—</span>
             <span>|</span>
             <span id="saveStatus" class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-gray-300"></span> å¾…æ©Ÿ</span>
           </div>
        </div>
      </div>
    </main>

  </div>

  <div id="resetModal" class="modal-backdrop" onclick="closeResetModal(event)">
    <div class="modal-card">
      <h3 class="font-bold text-lg mb-4 text-gray-800">æ¸…ç©ºè³‡æ–™ç¢ºèª</h3>
      <button onclick="execReset('source')" class="w-full py-3 mb-2 border rounded-lg text-sm text-gray-600">æ¸…é™¤åŸæ–‡è‰ç¨¿</button>
      <button onclick="execReset('kw')" class="w-full py-3 mb-2 border rounded-lg text-sm text-gray-600">æ¸…é™¤é—œéµå­—</button>
      <button onclick="execReset('all')" class="w-full py-3 border border-red-200 bg-red-50 text-[#A83636] font-bold mt-2">å…¨éƒ¨é‚„åŸ</button>
    </div>
  </div>

  <div id="toast" class="fixed top-16 left-1/2 -translate-x-1/2 bg-white border border-gray-200 px-6 py-2 rounded-full shadow-xl text-sm opacity-0 transition-opacity z-[99] pointer-events-none flex items-center gap-2">
    <span id="toastIcon"></span> <span id="toastMsg"></span>
  </div>

  <script>
    // --- æ ¸å¿ƒä¿®å¾©ï¼šæ‰‹æ©Ÿç‰ˆ Tab åˆ‡æ›é‚è¼¯ ---
    const tabInput = document.getElementById('tabInput');
    const tabPreview = document.getElementById('tabPreview');
    const sectionInput = document.getElementById('sectionInput');
    const sectionPreview = document.getElementById('sectionPreview');

    function switchTab(tab) {
      if (window.innerWidth >= 768) return; // é›»è…¦ç‰ˆç•¥é

      if(tab === 'input') {
        sectionInput.classList.remove('d-none');
        sectionPreview.classList.add('d-none');
        tabInput.classList.add('active');
        tabPreview.classList.remove('active');
      } else {
        sectionInput.classList.add('d-none');
        sectionPreview.classList.remove('d-none');
        tabInput.classList.remove('active');
        tabPreview.classList.add('active');
      }
    }

    // --- æ—¢æœ‰é‚è¼¯ ---
    const editor = document.getElementById('editor');
    const source = document.getElementById('sourceText');
    const kwListArea = document.getElementById('kwList');
    const resetModal = document.getElementById('resetModal');
    const statusLabel = document.getElementById('saveStatus');
    const FONT_FAMILY = "font-family: 'Microsoft JhengHei', 'å¾®è»Ÿæ­£é»‘é«”', sans-serif;";
    const BASE_STYLE = `${FONT_FAMILY} font-size: 12pt; line-height: 2.0; color: #333;`;

    // Init & Auto-Save
    window.addEventListener('DOMContentLoaded', () => {
      if(localStorage.getItem('fluo_draft_source')) source.value = localStorage.getItem('fluo_draft_source');
      if(localStorage.getItem('fluo_draft_kw')) kwListArea.value = localStorage.getItem('fluo_draft_kw');
      if(localStorage.getItem('fluo_draft_content')) editor.innerHTML = localStorage.getItem('fluo_draft_content');
      else if(!editor.innerText.trim()) editor.innerHTML = `<span style="${BASE_STYLE}"><br></span>`;
      updateCounts();
    });

    let saveTimeout;
    function triggerSave() {
      updateStatus('saving'); clearTimeout(saveTimeout);
      saveTimeout = setTimeout(() => {
        localStorage.setItem('fluo_draft_source', source.value);
        localStorage.setItem('fluo_draft_kw', kwListArea.value);
        localStorage.setItem('fluo_draft_content', editor.innerHTML);
        updateStatus('saved');
      }, 800);
    }
    source.addEventListener('input', triggerSave);
    kwListArea.addEventListener('input', triggerSave);
    editor.addEventListener('input', () => { triggerSave(); updateCounts(); });

    function updateStatus(state) {
      statusLabel.innerHTML = state === 'saving' 
        ? `<span class="w-2 h-2 rounded-full bg-orange-500 animate-pulse"></span> å„²å­˜ä¸­` 
        : `<span class="w-2 h-2 rounded-full bg-green-600"></span> å·²å„²å­˜`;
    }

    // Actions
    function runAutoMark() {
      const kws = kwListArea.value.split('\n').filter(k => k.trim());
      let text = source.value;
      if(!text) { showToast('error', 'è«‹è¼¸å…¥å…§å®¹'); return; }
      text = text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
      kws.forEach(kw => {
        text = text.replace(new RegExp(`(${kw})`, 'gi'), `<span style="${FONT_FAMILY} color: #B93A32; font-weight: bold;">$1</span>`);
      });
      text = text.replace(/\n/g, '<br>');
      editor.innerHTML = `<span style="${BASE_STYLE}">${text}</span>`;
      showToast('success', 'æ³¨å…¥å®Œæˆï¼è«‹æŸ¥çœ‹é è¦½');
      triggerSave(); updateCounts();
      
      // æ‰‹æ©Ÿç‰ˆè‡ªå‹•åˆ‡æ›åˆ°é è¦½
      if(window.innerWidth < 768) switchTab('preview');
    }

    // Helpers
    function applyStyle(type) {
      let css = "";
      switch(type) {
        case 'h1': css = `${FONT_FAMILY} font-size: 24pt; font-weight: bold; line-height: 1.5; color: #111; display: block; margin: 24px 0 12px 0;`; break;
        case 'h2': css = `${FONT_FAMILY} font-size: 18pt; font-weight: bold; line-height: 1.5; color: #222; display: block; margin: 20px 0 10px 0;`; break;
        case 'p': css = BASE_STYLE + " display: block; margin-bottom: 12px; font-weight: normal;"; break;
        case 'red': wrapSelection(`${FONT_FAMILY} color: #B93A32; font-weight: bold;`); return;
      }
      wrapSelection(css); triggerSave();
    }
    function applyColor(hex) { wrapSelection(`${FONT_FAMILY} color: ${hex};`); triggerSave(); }
    function applyHighlight(hex) { wrapSelection(`${FONT_FAMILY} background-color: ${hex};`); triggerSave(); }
    
    function wrapSelection(styleString) {
      const sel = window.getSelection();
      if (!sel.rangeCount || sel.isCollapsed) { showToast('error', 'è«‹å…ˆé¸å–æ–‡å­—'); return; }
      const span = document.createElement('span'); span.style.cssText = styleString;
      try { sel.getRangeAt(0).surroundContents(span); } catch(e) { document.execCommand('styleWithCSS', false, true); }
    }

    function execCmd(cmd) { document.execCommand(cmd, false, null); triggerSave(); }

    async function copyToDocs() {
      const wrapper = document.createElement('div');
      wrapper.style.cssText = `${BASE_STYLE} background-color: white;`;
      wrapper.innerHTML = editor.innerHTML;
      wrapper.querySelectorAll('*').forEach(el => { if(!el.style.fontFamily) el.style.fontFamily = "'Microsoft JhengHei', 'å¾®è»Ÿæ­£é»‘é«”', sans-serif"; });
      try {
        await navigator.clipboard.write([new ClipboardItem({'text/html': new Blob([wrapper.outerHTML], {type: 'text/html'}), 'text/plain': new Blob([editor.innerText], {type: 'text/plain'})})]);
        showToast('success', 'å·²è¤‡è£½ï¼');
      } catch(e) { showToast('error', 'è¤‡è£½å¤±æ•—'); }
    }

    function downloadTxt() {
      const a = document.createElement("a"); a.href = URL.createObjectURL(new Blob([editor.innerText], {type: "text/plain"}));
      a.download = `draft_${new Date().toISOString().slice(0,10)}.txt`; a.click();
    }
    function openResetModal() { resetModal.style.display = 'flex'; }
    function closeResetModal(e) { if(e.target === resetModal) resetModal.style.display = 'none'; }
    function execReset(mode) {
      if(mode==='source') { source.value=""; localStorage.removeItem('fluo_draft_source'); }
      else if(mode==='kw') { kwListArea.value=""; localStorage.removeItem('fluo_draft_kw'); }
      else { localStorage.clear(); source.value=""; kwListArea.value=""; editor.innerHTML=""; }
      showToast('success', 'å·²é‡ç½®'); resetModal.style.display='none'; triggerSave();
    }
    function updateCounts() { document.getElementById('charCount').innerText = `${(editor.innerText||"").length} å­—`; }
    function showToast(type, msg) {
      const t = document.getElementById('toast');
      document.getElementById('toastIcon').innerHTML = type==='success' ? 'ğŸŸ¢' : 'ğŸ”´';
      document.getElementById('toastMsg').innerText = msg;
      t.style.opacity = '1'; setTimeout(() => t.style.opacity = '0', 2000);
    }
  </script>
</body>
</html>
